<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Map</title>
    <url>/2025/09/16/Golang/2025-09-16-Map/</url>
    <content><![CDATA[<blockquote>
<p>mapæ˜¯Goè¯­è¨€æä¾›çš„ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œå®ƒè¡¨ç¤ºä¸€ç»„æ— åºçš„é”®å€¼å¯¹ã€‚mapå¯¹valueçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯å¯¹keyçš„ç±»å‹æœ‰ä¸¥æ ¼è¦æ±‚ï¼škeyçš„ç±»å‹åº”è¯¥ä¸¥æ ¼å®šä¹‰äº†ä½œä¸ºâ€œ &#x3D;&#x3D; â€å’Œâ€œ !&#x3D; â€ä¸¤ä¸ªæ“ä½œç¬¦çš„æ“ä½œæ•°æ—¶çš„è¡Œä¸ºï¼Œå› æ­¤å‡½æ•°ã€mapã€åˆ‡ç‰‡ä¸èƒ½ä½œä¸ºmapçš„keyç±»å‹ã€‚</p>
</blockquote>
<h3><span id="go-map-de-di-ceng-ji-zhi">Go Map çš„åº•å±‚æœºåˆ¶</span></h3><p>Goè¿è¡Œæ—¶ä½¿ç”¨ä¸€å¼ å“ˆå¸Œè¡¨æ¥å®ç°æŠ½è±¡çš„mapç±»å‹ã€‚è¿è¡Œæ—¶å®ç°äº†mapæ“ä½œçš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ã€éå†ç­‰ã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒGoç¼–è¯‘å™¨ä¼šå°†è¯­æ³•å±‚é¢çš„mapæ“ä½œé‡å†™æˆè¿è¡Œæ—¶å¯¹åº”çš„å‡½æ•°è°ƒç”¨ã€‚è¿™é‡Œå…ˆä»‹ç»è€ç‰ˆæœ¬çš„mapå®ç°ï¼ˆGo 1.23 æ ¹æ® Google çš„ SwissTable ç†å¿µè®¾è®¡å‡ºäº†æ–°çš„å“ˆå¸Œå®ç° SwissMapï¼Œè¯¦æƒ…å¯é˜…è¯»æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/runtime/map_noswiss.go</span><br><br><span class="hljs-comment">// ä»¥ä¸‹æ˜¯ map_noswiss.go ä¸­çš„å‡½æ•°ç­¾å</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makemap</span><span class="hljs-params">(t *maptype, hint <span class="hljs-type">int</span>, h *hmap)</span></span> *hmap<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapaccess1</span><span class="hljs-params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> unsafe.Pointer<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapassign</span><span class="hljs-params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> unsafe.Pointer<br><br><span class="hljs-comment">// ä»¥ä¸‹æ˜¯å‡ ç§ map æ“ä½œèƒŒåçš„å‡½æ•°è½¬æ¢</span><br>m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[keyType]valType, capacityhint)<br>m := runtime.makemap(maptype, capacityhint, m)<br><br>v := m[<span class="hljs-string">&quot;key]</span><br><span class="hljs-string">v := runtime.mapaccess1(maptype, m, &quot;</span>key)<br><br>m[<span class="hljs-string">&quot;key] = &quot;</span>value<span class="hljs-string">&quot;</span><br><span class="hljs-string">v := runtime.mapassign(maptype, m, &quot;</span>key)  <span class="hljs-comment">// v æ˜¯ç”¨äºåç»­å­˜å‚¨ value çš„ç©ºé—´çš„åœ°å€</span><br></code></pre></td></tr></table></figure>

<h4><span id="he-xin-jie-gou-hmap">æ ¸å¿ƒç»“æ„ - hmap</span></h4><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> hmap <span class="hljs-keyword">struct</span> &#123;<br>	count       <span class="hljs-type">int</span>             <span class="hljs-comment">// å½“å‰ map ä¸­å…ƒç´ çš„æ•°é‡ï¼Œlen()çš„è¿”å›å€¼</span><br>	flags       <span class="hljs-type">uint8</span><br>	B           <span class="hljs-type">uint8</span>           <span class="hljs-comment">// æ¡¶çš„æ•°é‡å¤šå¯¹æ•°</span><br>	noverflow   <span class="hljs-type">uint16</span>          <span class="hljs-comment">// æº¢å‡ºæ¡¶çš„å¤§æ¦‚æ•°é‡</span><br>	hash0       <span class="hljs-type">uint32</span>          <span class="hljs-comment">// å“ˆå¸Œç§å­ï¼Œä¸ºå“ˆå¸Œå‡½æ•°å¼•å…¥éšæœºæ€§</span><br>	<br>	buckets     unsafe.Pointer  <span class="hljs-comment">// æŒ‡å‘ 2^B ä¸ªæ¡¶çš„æ•°ç»„çš„æŒ‡é’ˆ</span><br>	oldbuckets  unsafe.Pointer  <span class="hljs-comment">// æ‰©å®¹æ—¶æŒ‡å‘æ—§æ¡¶æ•°ç»„çš„æŒ‡é’ˆ</span><br>	nevacuate   uintper         <span class="hljs-comment">// æ‰©å®¹è¿›åº¦è®¡æ•°å™¨</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4><span id="tong-jie-gou-bmap">æ¡¶ç»“æ„ - bmap</span></h4><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> bmap <span class="hljs-keyword">struct</span> &#123;<br>    tophash [bucketCnt]<span class="hljs-type">uint8</span>     <span class="hljs-comment">// å­˜å‚¨é”®å“ˆå¸Œçš„é«˜8ä½ï¼Œç”¨äºå¿«é€Ÿæ¯”è¾ƒ</span><br>    keys    [bucketCnt]keyType   <span class="hljs-comment">// é”®æ•°ç»„</span><br>    values  [bucketCnt]valueType <span class="hljs-comment">// å€¼æ•°ç»„</span><br>    overflow *bmap               <span class="hljs-comment">// æŒ‡å‘æº¢å‡ºæ¡¶çš„é“¾è¡¨</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ¯ä¸ªæ¡¶é€šå¸¸å¯ä»¥å­˜å‚¨ 8 ä¸ªé”®å€¼å¯¹</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// src/runtime/map_noswiss.go</span><br><span class="hljs-keyword">const</span>(<br>	<span class="hljs-comment">// Maximum number of key/elem pairs a bucket can hold.</span><br>	bucketCntBits = abi.OldMapBucketCountBits<br>)<br></code></pre></td></tr></table></figure>

<ul>
<li>å½“æ¡¶å·²æ»¡æ—¶ï¼Œä¼šé€šè¿‡<code>overfolw</code>æŒ‡é’ˆå¼è¿æ¥æ–°çš„æº¢å‡ºæ¡¶</li>
</ul>
<h4><span id="gong-zuo-ji-zhi">å·¥ä½œæœºåˆ¶</span></h4><h5><span id="a-ha-xi-yu-ding-wei">a) å“ˆå¸Œä¸å®šä½ï¼š</span></h5><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// è®¡ç®—å¥åº”è¯¥æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­</span><br>hash := hashFunc(key, h.hash0)<br>bucketIndex := hash &amp; (<span class="hljs-number">2</span>^h.B - <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ç®—å‡ºçš„ hash çš„ä½ä½åŒºçš„å€¼ç”¨äºé€‰æ‹©æ¡¶ï¼Œé«˜ä½åŒºçš„å€¼ç”¨äºç¡®å®šæ¡¶ä¸­ key çš„ä½ç½®</p>
<h5><span id="b-jie-jue-ha-xi-chong-tu">b)è§£å†³å“ˆå¸Œå†²çªï¼š</span></h5><ul>
<li><strong>é“¾åœ°å€æ³•</strong>ï¼šæ¯ä¸ªæ¡¶æ˜¯ä¸€ä¸ªé“¾è¡¨å¤´ï¼Œæº¢å‡ºæ¡¶é€šè¿‡æŒ‡é’ˆé“¾æ¥</li>
<li><strong>å¼€æ”¾å¯»å€</strong>ï¼šåœ¨æ¡¶å†…çº¿æ€§æ¢æµ‹å¯»æ‰¾ç©ºä½<br>gon</li>
</ul>
<h5><span id="c-kuo-rong-ji-zhi">c)æ‰©å®¹æœºåˆ¶ï¼š</span></h5><ul>
<li>å¢é‡æ‰©å®¹ï¼šå½“<code>count &gt; 6.5 * 2^B</code> ï¼ˆè´Ÿè½½å› å­è¿‡é«˜ï¼‰æ—¶è§¦å‘,æ­¤æ—¶è¿è¡Œæ—¶ä¼šå»ºç«‹ä¸€ä¸ªä¸¤å€äºç°æœ‰è§„æ¨¡çš„bucketæ•°ç»„ï¼Œä½†çœŸæ­£çš„æ’ç©ºå’Œè¿ç§»å·¥ä½œæ˜¯åœ¨è¿›è¡Œ<code>assign</code> å’Œ <code>delete</code> æ“ä½œæ—¶é€æ­¥è¿›è¡Œçš„ã€‚åŸ bucket æ•°ç»„ä¼šæŒ‚åœ¨ hmap çš„ oldbuckets æŒ‡é’ˆä¸‹é¢ï¼Œç›´åˆ°åŸ buckets æ•°ç»„ä¸­æ‰€æœ‰æ•°æ®éƒ½è¿ç§»åˆ°æ–°æ•°ç»„ï¼ŒåŸ bucktes æ•°ç»„æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li>
<li>ç­‰é‡æ‰©å®¹ï¼šå½“æº¢å‡ºæ¡¶å¤ªå¤šæ—¶ï¼Œé‡æ–°æ’åˆ—å‡å°‘æº¢å‡ºæ¡¶</li>
<li>æ‰©å®¹æ—¶æ¸è¿‘å¼çš„ï¼Œæ¯æ¬¡æ“ä½œæ—§æ¡¶æ—¶è¿ç§»1-2ä¸ªæ¡¶åˆ°æ–°æ¡¶</li>
</ul>
<h3><span id="bing-fa-map-de-shi-xian-fang-an">å¹¶å‘Mapçš„å®ç°æ–¹æ¡ˆ</span></h3><p>é™¤äº†ç®€å•çš„å…¨å±€é”ï¼ˆ<code>sync.RWMutex</code>ï¼‰ï¼ŒåŸºäºæ¡¶çš„å¹¶å‘Mapä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§é«˜çº§å®ç°æ–¹å¼ï¼š</p>
<h4><span id="1-fen-pian-suo-sharded-locking">1.åˆ†ç‰‡é”ï¼ˆSharded Lockingï¼‰</span></h4><p>å°†ä¸€ä¸ªå¤§çš„ Mapåˆ†æˆå¤šä¸ªå° Mapï¼ˆåˆ†ç‰‡ï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡æœ‰è‡ªå·±çš„é”</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;sync&quot;</span><br><br><span class="hljs-comment">// åˆ†ç‰‡å¹¶å‘Map</span><br><span class="hljs-keyword">type</span> ConcurrentMap <span class="hljs-keyword">struct</span> &#123;<br>	shards []*MapShard<br>	shardMask <span class="hljs-type">uint32</span><br>&#125;<br><br><span class="hljs-keyword">type</span> MapShard <span class="hljs-keyword">struct</span> &#123;<br>	sync.RWMutex<br>	data <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºå¹¶å‘Map</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewConcurrentMap</span><span class="hljs-params">(shardCount <span class="hljs-type">int</span>)</span></span> *ConcurrentMap &#123;<br>	<span class="hljs-comment">// ä¸ºäº†æ–¹ä¾¿ä½è¿ç®—ï¼Œä¼ å…¥çš„shardCountéœ€è¦ä¸º2çš„å¹‚æ¬¡</span><br>	<span class="hljs-keyword">if</span> shardCount &lt;= <span class="hljs-number">0</span>&#123;<br>		shardCount = <span class="hljs-number">32</span>  <span class="hljs-comment">// é»˜è®¤32ä¸ªåˆ†ç‰‡</span><br>	&#125;<br>	<br>	cm := &amp;COncurrentMap&#123;<br>		shards: <span class="hljs-built_in">make</span>([]*MapShard, shardCount),<br>		shardMask: <span class="hljs-type">uint32</span>(shardCount - <span class="hljs-number">1</span>)<br>	&#125;<br>	<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> cm.shards &#123;<br>		cm.shards[i] = &amp;MapShard&#123;<br>			data: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> cm<br>&#125;<br><br><span class="hljs-comment">// è·å–é”®å¯¹åº”çš„åˆ†ç‰‡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cm *ConcurrentMap)</span></span> getShard(key <span class="hljs-type">string</span>) *MapShard &#123;<br>	hash := fnv32(key)<br>	<span class="hljs-keyword">return</span> cm.shards[hash &amp; cm.shardMask]<br>&#125;<br><br><span class="hljs-comment">// å“ˆå¸Œå‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fnv32</span><span class="hljs-params">(key <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">uint32</span>&#123;<br>	hash := <span class="hljs-type">uint32</span>(<span class="hljs-number">2166136261</span>)<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(key); i ++ &#123;<br>		hash *= <span class="hljs-number">16777619</span><br>		hash ^= <span class="hljs-type">uint32</span>(key[i])<br>	&#125;<br>	<span class="hljs-keyword">return</span> hash<br>&#125;<br><br><span class="hljs-comment">// è¯»å–</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cm *ConcurrentMap)</span></span> Get(key <span class="hljs-type">string</span>) (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">bool</span>) &#123;<br>	shard := cm.getShard(key)<br>	shard.RLock()<br>	<span class="hljs-keyword">defer</span> shard.RUnlock()<br>	value, exists := shard.data[key]<br>	<span class="hljs-keyword">return</span> value, exists<br>&#125;<br><br><span class="hljs-comment">// å†™å…¥</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cm *ConcurrentMap)</span></span> Set(key <span class="hljs-type">string</span>, value <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>	shard := cm.getShard(key)<br>	shard.Lock()<br>	<span class="hljs-keyword">defer</span> shard.Unlock()<br>	shard.data[key] = value<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>è¯»å†™æ“ä½œé™åˆ¶åœ¨å•ä¸ªåˆ†ç‰‡ä¸Šç«äº‰ï¼Œå¤§å¹…å‡å°‘å†²çª</li>
<li>å®ç°ç›¸å¯¹ç®€å•ï¼Œæ€§èƒ½æ¥è¿‘æ— é”ç»“æ„</li>
</ul>
<h4><span id="2-du-xie-suo-kao-bei-xie-copy-on-write">2.è¯»å†™é” + æ‹·è´å†™ ï¼ˆCopy-On-Writeï¼‰</span></h4><p>è¯»æ“ä½œå®Œå…¨æ— é”ï¼Œå†™æ“ä½œé€šè¿‡åŸå­æ›¿æ¢æ•´ä¸ª map å®ç°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;sync/atomic&quot;</span><br><br><span class="hljs-keyword">type</span> CopyOnWriteMap <span class="hljs-keyword">struct</span> &#123;<br>	mu sync.Mutex<br>	data atomic.Value<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *CopyOnWriteMap)</span></span> Get(key <span class="hljs-type">string</span>) (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">bool</span>) &#123;<br>	data := m.data.Load().(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)<br>	value, exsit := data[key]<br>	<span class="hljs-keyword">return</span> value, exists<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *CopyOnWriteMap)</span></span> Set(key <span class="hljs-type">string</span>, value <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>	m.mu.Lock()<br>	dafer m.mu.Unlock()<br>	<br>	oldData := m.data.Load().(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)<br>	newData := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-built_in">len</span>(oldData) + <span class="hljs-number">1</span>)<br>	<br>	<span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> oldData &#123;<br>		newData[k] = v<br>	&#125;<br>	newData[key] = value<br>	<br>	m.data.Store(newData)<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>é€‚ç”¨äºè¯»å¤šå†™å°‘ï¼Œä¸”å†™æ“ä½œä¸å¤æ‚çš„åœºæ™¯</li>
<li>é€‚ç”¨äº Map å°ºå¯¸ä¸å¤§çš„åœºæ™¯ï¼ˆå¦åˆ™æ‹·è´çš„å¼€é”€å°†ä¸å¯æ‰¿å—ï¼‰</li>
</ul>
<p>æœ€åï¼ŒGoæ ‡å‡†åº“å·²ç»æä¾›äº† <code>sync.Map</code> ï¼Œæ¥æ”¯æŒ Map çš„å¹¶å‘è¯»å†™ï¼›æ­¤å¤–ï¼Œä¹Ÿæœ‰ç¬¬ä¸‰æ–¹åº“ github.com&#x2F;orcaman&#x2F;concurrent-map æä¾›äº†åˆ†ç‰‡ Map çš„å®ç°ã€‚</p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>Slice</title>
    <url>/2025/09/16/Golang/2025-09-16-Slice/</url>
    <content><![CDATA[<blockquote>
<p><strong>Sliceï¼ˆåˆ‡ç‰‡ï¼‰æ˜¯å¯¹åº•å±‚æ•°ç»„çš„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œå¯ä»¥ç§°å…¶ä¸ºæ•°ç»„çš„â€œæè¿°ç¬¦</strong>ã€‚å®ƒä¸ºæˆ‘ä»¬æä¾›äº†åŠ¨æ€å¤§å°çš„ã€çµæ´»çš„è§†å›¾ï¼Œä½†åŒæ—¶åˆåœ¨æ€§èƒ½ä¸Šæ¥è¿‘äºæ•°ç»„ã€‚</p>
</blockquote>
<h3><span id="slice-de-di-ceng-shu-ju-jie-gou">Sliceçš„åº•å±‚æ•°æ®ç»“æ„</span></h3><p>åœ¨ Go çš„è¿è¡Œæ—¶ä¸­ï¼Œä¸€ä¸ª Slice æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå­—æ®µçš„ç»“æ„ä½“ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span> &#123;<br>	array unsafe.Pointer <span class="hljs-comment">// æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ</span><br>	<span class="hljs-built_in">len</span>   <span class="hljs-type">int</span>            <span class="hljs-comment">// å½“å‰åˆ‡ç‰‡çš„é•¿åº¦</span><br>	<span class="hljs-built_in">cap</span>   <span class="hljs-type">int</span>            <span class="hljs-comment">// å½“å‰åˆ‡ç‰‡çš„å®¹é‡</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>array</code>: ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘Sliceåœ¨åº•å±‚çœŸæ­£ä½¿ç”¨çš„æ•°ç»„ï¼Œæ•°æ®å­˜å‚¨åœ¨è¿™ä¸ªæ•°ç»„ä¸­</li>
<li><code>len</code>: è¿™ä¸ª Slice å¯è§å’Œå¯è®¿é—®çš„å…ƒç´ ä¸ªæ•°ï¼Œslice[len - 1] æ˜¯æœ€åä¸€ä¸ªæœ‰æ•ˆå…ƒç´ </li>
<li><code>cap</code>: ä» array æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®å¼€å§‹ï¼Œåˆ°åº•å±‚æ•°ç»„æœ«å°¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå®ƒå†³å®šäº†è¿™ä¸ª Slice æœ€å¤§èƒ½æ‰©å±•å¤šé•¿è€Œæ— éœ€åˆ†é…å†…å­˜</li>
</ul>
<h3><span id="qie-pian-ji-zhi-de-you-shi">åˆ‡ç‰‡æœºåˆ¶çš„ä¼˜åŠ¿</span></h3><h4><span id="1-dong-tai-kuo-rong">1.åŠ¨æ€æ‰©å®¹</span></h4><p>å½“ä½¿ç”¨ <code>append</code> å‘ Slice æ·»åŠ å…ƒç´ ï¼Œå¹¶ä¸”è¶…è¿‡å…¶å½“å‰å®¹é‡ï¼ˆ<code>len == cap</code>ï¼‰æ—¶ï¼ŒGo çš„è¿è¡Œæ—¶ä¼šè‡ªåŠ¨è§¦å‘æ‰©å®¹æœºåˆ¶ï¼š</p>
<ul>
<li>åˆ†é…ä¸€å—æ–°çš„ã€æ›´å¤§çš„å†…å­˜ç©ºé—´</li>
<li>å°† Slice åŸæœ‰çš„æ‰€æœ‰å…ƒç´ å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­å»</li>
<li>å°†æ–°å…ƒç´ è¿½åŠ åˆ°æ–°æ•°ç»„çš„æœ«å°¾</li>
<li><code>array</code> æŒ‡é’ˆæŒ‡å‘æ–°æ•°ç»„ï¼Œ<code>len</code> é•¿åº¦å¢åŠ ï¼Œ<code>cap</code> è®¾ç½®ä¸ºæ–°æ•°ç»„é•¿åº¦</li>
</ul>
<p><strong>æ‰©å®¹ç­–ç•¥</strong>ï¼ˆé˜ˆå€¼è§†ç‰ˆæœ¬è€Œå®šï¼Œå…·ä½“éœ€è¦æŸ¥é˜…æºç  <code>//$GOROOT/src/runtime/slice.go</code> ä¸­çš„å®šä¹‰ï¼‰</p>
<ul>
<li>è‹¥åŸåˆ‡ç‰‡çš„å®¹é‡å°äº 1024ï¼Œæ–°å®¹é‡ä¼šç¿»å€</li>
<li>è‹¥åŸåˆ‡ç‰‡çš„å®¹é‡å¤§äº 1024ï¼Œæ–°å®¹é‡ä¼šä»¥ 1.25 å€çš„é€Ÿåº¦å¢é•¿ï¼Œç›´åˆ°æ»¡è¶³éœ€æ±‚</li>
</ul>
<h4><span id="2-gao-xiao-de-nei-cun-gong-xiang-he-shi-tu">2.é«˜æ•ˆçš„å†…å­˜å…±äº«å’Œè§†å›¾</span></h4><p>ç”±äº Slice åªæ˜¯å¯¹åº•å±‚æ•°ç»„çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥åˆ›å»ºæ–°çš„åˆ‡ç‰‡ï¼ˆè¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼‰ä¼šéå¸¸é«˜æ•ˆï¼Œåº”ä¸ºå®ƒä¸ä¼šå¤åˆ¶åº•å±‚çš„æ•°æ®ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go">originArr := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br>silce1 := originArr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]  <span class="hljs-comment">// len=3, cap=4 =&gt; [2, 3, 4]</span><br>slice2 := slice1[:<span class="hljs-number">2</span>]      <span class="hljs-comment">// len=2, cap=4 =&gt; [2, 3]</span><br></code></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>originArr</code>ã€ <code>slice1</code>ã€ <code>slice2</code> å…±äº«åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªåˆ‡ç‰‡çš„å…ƒç´ ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰å…±äº«è¯¥åº•å±‚æ•°ç»„çš„å…¶ä»–åˆ‡ç‰‡å’Œæ•°ç»„ã€‚</p>
<p>è¿™å¸¦æ¥äº†ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>é¿å…å¤§å—æ•°ç»„å¤åˆ¶</strong>ï¼šå½“åˆ‡ç‰‡ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œå®é™…ä¼ é€’çš„æ˜¯ä¸Šé¢çš„ç»“æ„ä½“å®ä¾‹ï¼Œå› æ­¤æ— è®ºåˆ‡ç‰‡æè¿°çš„åº•å±‚æ•°ç»„æœ‰å¤šå¤§ï¼Œåˆ‡ç‰‡ä½œä¸ºå‚æ•°ä¼ é€’å¸¦æ¥çš„æ€§èƒ½æŸè€—éƒ½æ˜¯æå°ä¸”æ’å®šçš„ã€‚</li>
<li><strong>å¿«é€Ÿåˆ›å»ºæ•°æ®è§†å›¾</strong>ï¼šå¯ä»¥å¯¹åˆ‡ç‰‡è¿›è¡Œ <code>reslice</code> ï¼Œå°±åƒä¸Šé¢çš„ slice2ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†ä¸€ä¸ªæ”¶åˆ°çš„ç½‘ç»œæŠ¥æ–‡æ—¶ï¼Œå¯ä»¥è¿…é€Ÿåˆ‡å‡ºåè®®å¤´ã€æŠ¥æ–‡ä½“ç­‰éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œè€Œä¸éœ€è¦å¤åˆ¶æ•°æ®ã€‚</li>
</ul>
<h3><span id="3-ling-huo-de-nei-cun-bu-ju-kong-zhi">3.çµæ´»çš„å†…å­˜å¸ƒå±€æ§åˆ¶</span></h3><p>å¯ä»¥é€šè¿‡ <code>make</code> å‡½æ•°ç²¾ç¡®çš„æ§åˆ¶ Slice çš„åˆå§‹é•¿åº¦å’Œå®¹é‡</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 3ï¼Œå®¹é‡ä¸º 5 çš„æ•´å‹åˆ‡ç‰‡</span><br>s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment">// s =&gt; [0, 0, 0], len=3, cap=5</span><br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä½¿ç”¨ä¸€ä¸ªåŸºå‡†æµ‹è¯•æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;testing&quot;</span>  <br>  <br><span class="hljs-keyword">const</span> sliceSize = <span class="hljs-number">10000</span>  <br>  <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkSliceInitWithoutCap</span><span class="hljs-params">(b *testing.B)</span></span> &#123;  <br>    <span class="hljs-keyword">for</span> n := <span class="hljs-number">0</span>; n &lt; b.N; n++ &#123;  <br>       sl := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>)  <br>       <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; sliceSize; i++ &#123;  <br>          sl = <span class="hljs-built_in">append</span>(sl, i)  <br>       &#125;  <br>    &#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkSliceInitWithCap</span><span class="hljs-params">(b *testing.B)</span></span> &#123;  <br>    <span class="hljs-keyword">for</span> n := <span class="hljs-number">0</span>; n &lt; b.N; n++ &#123;  <br>       sl := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, sliceSize)  <br>       <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; sliceSize; i++ &#123;  <br>          sl = <span class="hljs-built_in">append</span>(sl, i)  <br>       &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">(base) xuyuyang % go <span class="hljs-built_in">test</span> -benchmem -bench=. slice_benchmark_test.go<br>goos: darwin<br>goarch: arm64<br>cpu: Apple M3<br>BenchmarkSliceInitWithoutCap-8             <br>51662             22170 ns/op          357629 B/op         19 allocs/op<br>BenchmarkSliceInitWithCap-8               <br>210564              5757 ns/op           81920 B/op          1 allocs/op<br>PASS<br>ok      command-line-arguments  3.039s<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>BenchmarkSliceInitWithoutCap-8</code></strong>:</p>
<ul>
<li><p>æ‰§è¡Œäº† 51,662 æ¬¡ï¼Œæ¯æ¬¡æ“ä½œå¹³å‡è€—æ—¶Â <strong>22,170 ns</strong>Â (çº¦ 0.022 ms)</p>
</li>
<li><p>æ¯æ¬¡æ“ä½œåˆ†é…äº†çº¦Â <strong>357.6 KB</strong>Â çš„å†…å­˜</p>
</li>
<li><p>æ¯æ¬¡æ“ä½œå‘ç”Ÿäº†Â <strong>19 æ¬¡</strong>Â å†…å­˜åˆ†é… (allocs)</p>
</li>
</ul>
</li>
<li><p><strong><code>BenchmarkSliceInitWithCap-8</code></strong>:</p>
<ul>
<li><p>æ‰§è¡Œäº† 210,564 æ¬¡ï¼Œæ¯æ¬¡æ“ä½œå¹³å‡è€—æ—¶Â <strong>5,757 ns</strong>Â (çº¦ 0.006 ms)Â <strong>-&gt; å¿« 3.85 å€ï¼</strong></p>
</li>
<li><p>æ¯æ¬¡æ“ä½œåˆ†é…äº†çº¦Â <strong>81.9 KB</strong>Â çš„å†…å­˜Â <strong>-&gt; å†…å­˜å‡å°‘ 77%ï¼</strong></p>
</li>
<li><p>æ¯æ¬¡æ“ä½œå‘ç”Ÿäº†Â <strong>1 æ¬¡</strong>Â å†…å­˜åˆ†é… (allocs)Â <strong>-&gt; åˆ†é…æ¬¡æ•°å‡å°‘ 94%ï¼</strong></p>
</li>
</ul>
</li>
</ul>
<h3><span id="zhu-yi-shi-xiang">æ³¨æ„äº‹é¡¹</span></h3><ul>
<li><strong>æ„å¤–çš„ä¿®æ”¹</strong>ï¼šå¤šä¸ªåˆ‡ç‰‡å¯èƒ½å…±äº«åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œå› æ­¤åœ¨ä¿®æ”¹åˆ‡ç‰‡å…ƒç´ æ—¶éœ€è¦æ³¨æ„æ˜¯å¦ä¼šå½±å“å…¶ä»–åˆ‡ç‰‡ã€‚è‹¥ä¸å¸Œæœ›å¯¹å…¶ä»–åˆ‡ç‰‡äº§ç”Ÿå½±å“ï¼Œéœ€è¦ä½¿ç”¨<code>copy</code> å‡½æ•°è¿›è¡Œæ˜¾ç¤ºå¤åˆ¶ã€‚</li>
<li><strong>â€å†…å­˜æ³„éœ²â€œ</strong>ï¼šä¸€ä¸ªå¼•ç”¨ç€å¾ˆå¤§åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡å¯èƒ½åªä½¿ç”¨å…¶ä¸­çš„å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œä½†åˆ‡ç‰‡çš„å¼•ç”¨ä¼šå¯¼è‡´è¿™ä¸ªæ•°ç»„æ— æ³•è¢«GCã€‚å› æ­¤å¯ä»¥åœ¨ä½¿ç”¨å®Œå¤§æ•°ç»„åï¼Œå°†éœ€è¦çš„æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªç‹¬ç«‹çš„åˆ‡ç‰‡ä¸­è¿›è¡Œä½¿ç”¨ã€‚</li>
<li><strong>æ‰©å®¹å¯¼è‡´çš„â€æ–­é“¾â€œ</strong>ï¼š<code>append</code> æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ‰©å®¹ï¼Œæ‰©å®¹åä¼šä½¿ç”¨ä¸€ä¸ªå…¨æ–°çš„åº•å±‚æ•°ç»„ã€‚æ­¤æ—¶ï¼Œæ–°çš„åˆ‡ç‰‡ä¸ä¹‹å‰åŸºäºæ—§æ•°ç»„çš„åˆ‡ç‰‡å°±ä¸å†å…±äº«åŒä¸€åº•å±‚æ•°ç»„äº†ã€‚å¯¹å®ƒä»¬çš„ä¿®æ”¹å°†äº’ä¸å½±å“ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>pydantic-æ•°æ®éªŒè¯å’Œè§£æ</title>
    <url>/2025/08/01/Python/2025-08-01-pydantic-%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E5%92%8C%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>pytest-æµ‹è¯•æ¡†æ¶</title>
    <url>/2025/08/03/Python/2025-08-11-pytest-%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<blockquote>
<p>pytest æ˜¯ Python é¢†åŸŸä½¿ç”¨æœ€å¹¿æ³›ã€åŠŸèƒ½æœ€ä¸°å¯Œçš„ <strong>ç¬¬ä¸‰æ–¹</strong> å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆUnit Test Frameworkï¼‰ã€‚å®ƒç§‰æ‰¿â€œè®©æµ‹è¯•å˜å¾—æ›´ç®€å•â€çš„ç†å¿µï¼Œè¯­æ³•ç®€æ´ã€æ’ä»¶ç”Ÿæ€åºå¤§ï¼Œå‡ ä¹å·²ç»æˆä¸º Python äº‹å®ä¸Šçš„æµ‹è¯•æ ‡å‡†ã€‚</p>
</blockquote>
<h2><span id="yi-an-zhuang">ä¸€ã€å®‰è£…</span></h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pip install pytest<br></code></pre></td></tr></table></figure>

<h2><span id="er-zui-xiao-ke-yun-xing-shi-li">äºŒã€æœ€å°å¯è¿è¡Œç¤ºä¾‹</span></h2><p>è¿™é‡Œä»¥åšä¸»çš„demoä½œä¸ºä¾‹å­</p>
<h3><span id="1-jian-li-mu-lu-jie-gou">1. å»ºç«‹ç›®å½•ç»“æ„</span></h3><figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">demo<span class="hljs-symbol">/</span><br>â”œâ”€â”€ src<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ ¸å¿ƒé¢†åŸŸæ¨¡å‹</span><br>â”‚   â””â”€â”€ entities.py            <span class="hljs-comment"># Chemical/Hazardç­‰æ ¸å¿ƒç±»å®šä¹‰</span><br>â”‚<br>â””â”€â”€ tests<span class="hljs-symbol">/</span>                     <span class="hljs-comment"># æµ‹è¯•å¥—ä»¶</span><br>    â””â”€â”€ test_entities.py.      <span class="hljs-comment"># entities.pyæµ‹è¯•ä»£ç </span><br></code></pre></td></tr></table></figure>

<h3><span id="2-bei-ce-dai-ma-src-entities-py">2. è¢«æµ‹ä»£ç Â <code>src/entities.py</code></span></h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, validator<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chemical</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;åŒ–å­¦å“æ ¸å¿ƒå®ä½“&quot;&quot;&quot;</span>  <br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span>  <br>    name: <span class="hljs-built_in">str</span><br>    en_name: <span class="hljs-built_in">str</span><br>    cas: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>    un: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <br>  <br><span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">&#x27;cas&#x27;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_cas</span>(<span class="hljs-params">cls, v</span>):<br>        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&#x27;^\d&#123;2,7&#125;-\d&#123;2&#125;-\d$&#x27;</span>, v):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid CAS number format&quot;</span>)<br>        <span class="hljs-keyword">return</span> v <br></code></pre></td></tr></table></figure>

<h3><span id="3-ce-shi-dai-ma-tests-test-entities-py">3. æµ‹è¯•ä»£ç Â <code>tests/test_entities.py</code></span></h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> ValidationError<br><span class="hljs-keyword">from</span> core.entities <span class="hljs-keyword">import</span> Chemical<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestChemical</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_valid_chemical</span>(<span class="hljs-params">self</span>):  <br>        chem = Chemical(<br>            <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CHEM001&quot;</span>,<br>            name=<span class="hljs-string">&quot;æ°´&quot;</span>,<br>            en_name=<span class="hljs-string">&quot;Water&quot;</span>,<br>            cas=<span class="hljs-string">&quot;7732-18-5&quot;</span>,  <span class="hljs-comment"># æœ‰æ•ˆCAS</span><br>        )<br>        <span class="hljs-keyword">assert</span> chem.cas == <span class="hljs-string">&quot;7732-18-5&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_cas_validation</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-keyword">with</span> pytest.raises(ValidationError):<br>            Chemical(<br>                <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CHEM002&quot;</span>,<br>                name=<span class="hljs-string">&quot;æµ‹è¯•&quot;</span>,<br>                en_name=<span class="hljs-string">&quot;test&quot;</span>,<br>                cas=<span class="hljs-string">&quot;abc-de-f&quot;</span>,  <span class="hljs-comment"># æ— æ•ˆæ ¼å¼</span><br>            )<br></code></pre></td></tr></table></figure>

<h3><span id="4-yun-xing-ce-shi">4. è¿è¡Œæµ‹è¯•</span></h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š<code>pytest</code>, pytest ä¼šé€’å½’æŸ¥æ‰¾ä»¥ <code>test_*.py</code> æˆ– <code>*_test.py</code> å‘½åçš„æ–‡ä»¶ï¼Œæ‰§è¡Œå…¶ä¸­ä»¥ <code>test_</code> å¼€å¤´çš„å‡½æ•°&#x2F;ç±»&#x2F;æ–¹æ³•ã€‚</p>
<h2><span id="san-he-xin-te-xing-su-lan">ä¸‰ã€æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ</span></h2><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ–­è¨€è¯­å¥</strong></td>
<td>ä»…ä½¿ç”¨åŸç”Ÿ <code>assert</code></td>
<td><code>assert chem.cas == &quot;7732-18-5&quot;</code></td>
</tr>
<tr>
<td><strong>è‡ªåŠ¨å‘ç°</strong></td>
<td>é»˜è®¤è§„åˆ™ï¼šæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;ç±»ä»¥ <code>test_</code> å¼€å¤´</td>
<td>æ— éœ€æ‰‹åŠ¨æ³¨å†Œ</td>
</tr>
<tr>
<td><strong>å¤¹å…·ï¼ˆfixtureï¼‰</strong></td>
<td>æµ‹è¯•å‰ç½®&#x2F;åç½®é€»è¾‘å¤ç”¨</td>
<td><code>@pytest.fixture</code></td>
</tr>
<tr>
<td><strong>å‚æ•°åŒ–</strong></td>
<td>ä¸€æ¡æµ‹è¯•è·‘å¤šç»„è¾“å…¥</td>
<td><code>@pytest.mark.parametrize</code></td>
</tr>
<tr>
<td><strong>æ ‡è®°ï¼ˆmarkï¼‰</strong></td>
<td>ç»™æµ‹è¯•æ‰“æ ‡ç­¾ï¼Œé€‰æ‹©æ€§è¿è¡Œ</td>
<td><code>@pytest.mark.slow</code></td>
</tr>
<tr>
<td><strong>æ’ä»¶ä½“ç³»</strong></td>
<td>1000+ æ’ä»¶ï¼Œå¦‚ <code>pytest-cov</code></td>
<td><code>pip install pytest-cov</code></td>
</tr>
</tbody></table>
<h2><span id="si-fixture-ke-fu-yong-de-ce-shi-zi-yuan">å››ã€fixtureï¼šå¯å¤ç”¨çš„æµ‹è¯•èµ„æº</span></h2><p>åœ¨ pytest é‡Œï¼Œ<strong>fixture</strong> å°±æ˜¯â€œæµ‹è¯•ç”¨çš„èµ„æºå·¥å‚â€ã€‚<br>å®ƒè´Ÿè´£ï¼š</p>
<ol>
<li><p><strong>åˆ›å»º</strong>ï¼ˆsetupï¼‰â€”â€” æµ‹è¯•å‰æŠŠç¯å¢ƒã€æ•°æ®ã€è¿æ¥å‡†å¤‡å¥½ï¼›</p>
</li>
<li><p><strong>æä¾›</strong>ï¼ˆyield &#x2F; returnï¼‰â€”â€” æŠŠèµ„æºäº¤ç»™æµ‹è¯•å‡½æ•°ï¼›</p>
</li>
<li><p><strong>æ¸…ç†</strong>ï¼ˆteardownï¼‰â€”â€” æµ‹è¯•åè‡ªåŠ¨é‡Šæ”¾ã€å›æ»šã€æ–­å¼€ã€‚</p>
</li>
</ol>
<p>å†™ä¸€æ¬¡ï¼Œåˆ°å¤„ç”¨ï¼›pytest ä¼šè‡ªåŠ¨æŒ‰éœ€è°ƒåº¦ã€‚</p>
<hr>
<h3><span id="1-zui-xiao-fixture-mo-ban">1. æœ€å° fixture æ¨¡æ¿</span></h3><p>å®šä¹‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sample_list</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;è¿”å›ä¸€ä¸ªå¯å¤ç”¨çš„åˆ—è¡¨ï¼Œæµ‹è¯•åè‡ªåŠ¨æ¸…ç©ºã€‚&quot;&quot;&quot;</span><br>    data = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">yield</span> data           <span class="hljs-comment"># æŠŠèµ„æºäº¤ç»™æµ‹è¯•ç”¨ä¾‹</span><br>    data.clear()         <span class="hljs-comment"># æµ‹è¯•ç»“æŸåæ‰§è¡Œ</span><br></code></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_len</span>(<span class="hljs-params">sample_list</span>):<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(sample_list) == <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>

<p>è¿è¡Œé¡ºåºï¼š</p>
<p><code>fixture setup</code> â†’ <code>test_len</code> â†’ <code>fixture teardown</code></p>
<h3><span id="2-zuo-yong-yu-scope-shi-me-shi-hou-chuang-jian-xiao-hui">2. ä½œç”¨åŸŸï¼ˆscopeï¼‰â€”â€” ä»€ä¹ˆæ—¶å€™åˆ›å»ºã€é”€æ¯</span></h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;function&quot;</span></span>)   </span><span class="hljs-comment"># é»˜è®¤å€¼ï¼šæ¯ä¸ªæµ‹è¯•å‡½æ•°ä¸€æ¬¡</span><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)      </span><span class="hljs-comment"># æ¯ä¸ªæµ‹è¯•ç±»ä¸€æ¬¡</span><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>)     </span><span class="hljs-comment"># æ•´ä¸ª test_*.py ä¸€æ¬¡</span><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;package&quot;</span></span>)    </span><span class="hljs-comment"># æ•´ä¸ªåŒ…ä¸€æ¬¡</span><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)    </span><span class="hljs-comment"># æ•´ä¸ª pytest ä¼šè¯ä¸€æ¬¡</span><br></code></pre></td></tr></table></figure>

<h3><span id="3-nei-zhi-x2f-chang-yong-fixture-su-cha">3. å†…ç½®&#x2F;å¸¸ç”¨ fixture é€ŸæŸ¥</span></h3><table>
<thead>
<tr>
<th>å†…ç½® fixture</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>tmp_path</code></td>
<td>æä¾› <code>pathlib.Path</code> ä¸´æ—¶ç›®å½•ï¼Œå‡½æ•°çº§</td>
</tr>
<tr>
<td><code>tmp_path_factory</code></td>
<td>åŒä¸Šï¼Œä½†å¯è·¨ä½œç”¨åŸŸ</td>
</tr>
<tr>
<td><code>monkeypatch</code></td>
<td>å®‰å…¨åœ°æ‰“è¡¥ä¸ï¼ˆç¯å¢ƒå˜é‡ã€æ¨¡å—å±æ€§ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>capsys</code> &#x2F; <code>capfd</code></td>
<td>æ•è· stdout&#x2F;stderr æˆ–æ–‡ä»¶æè¿°ç¬¦</td>
</tr>
<tr>
<td><code>request</code></td>
<td>æä¾›æµ‹è¯•ä¸Šä¸‹æ–‡ï¼ˆæ¨¡å—åã€é…ç½®ã€å‚æ•°ï¼‰</td>
</tr>
</tbody></table>
<h2><span id="wu-can-shu-hua-yi-tiao-ce-shi-duo-zu-shu-ju">äº”ã€å‚æ•°åŒ–ï¼šä¸€æ¡æµ‹è¯•å¤šç»„æ•°æ®</span></h2><p>å°†ä¸Šé¢çš„<code>tests/test_entities.py</code>æ”¹é€ ä¸ºå¯ä»¥ä¸€æ¬¡æµ‹è¯•å¤šç»„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">from</span> core.entities <span class="hljs-keyword">import</span> Chemical<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestChemicalEntity</span>:  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_valid_chemical</span>(<span class="hljs-params">self</span>):  <br>        chem = Chemical(  <br>            <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CHEM001&quot;</span>,  <br>            name=<span class="hljs-string">&quot;ç¡«é…¸&quot;</span>,  <br>            en_name=<span class="hljs-string">&quot;Sulfuric Acid&quot;</span>,  <br>            cas=<span class="hljs-string">&quot;7664-93-9&quot;</span>,  <br>        )  <br>        <span class="hljs-keyword">assert</span> chem.cas == <span class="hljs-string">&quot;7664-93-9&quot;</span>   <br>  <br><span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;cas_num, is_valid&quot;</span>, [  </span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;7732-18-5&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># æ°´çš„CASå·  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;64-17-5&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># ä¹™é†‡  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;123-45-6&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># æ ¼å¼æ­£ç¡®ï¼ˆè™½ç„¶å¯èƒ½ä¸å­˜åœ¨ï¼‰  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;1-23-4&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬ä¸€éƒ¨åˆ†å¤ªçŸ­  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;12345678-90-1&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬ä¸€éƒ¨åˆ†å¤ªé•¿  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;123-456-7&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬äºŒéƒ¨åˆ†åº”ä¸º2ä½  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;abc-de-f&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># åŒ…å«éæ•°å­—å­—ç¬¦  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-literal">None</span>, <span class="hljs-literal">True</span></span>)  <span class="hljs-comment"># å…è®¸ä¸ºç©º  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">    ]</span>)  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_cas_validation</span>(<span class="hljs-params">self, cas_num, is_valid</span>):  <br>        <span class="hljs-keyword">if</span> is_valid:  <br>            chem = Chemical(  <br>                <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;TEST&quot;</span>,  <br>                name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                en_name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                cas=cas_num,  <br>            )  <br>            <span class="hljs-keyword">assert</span> chem.cas == cas_num  <br>        <span class="hljs-keyword">else</span>:  <br>            <span class="hljs-keyword">with</span> pytest.raises(ValidationError):  <br>                Chemical(  <br>                    <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;TEST&quot;</span>,  <br>                    name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                    en_name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                    cas=cas_num,  <br>                )<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œæ—¶ä¼šç”Ÿæˆ 8 ä¸ªç‹¬ç«‹çš„æµ‹è¯•èŠ‚ç‚¹ï¼Œå¤±è´¥äº’ä¸å½±å“ã€‚</p>
<h2><span id="liu-biao-ji-fen-lei-ce-shi">å…­ã€æ ‡è®°ï¼šåˆ†ç±»æµ‹è¯•</span></h2><h3><span id="1-ding-yi-biao-ji">1. å®šä¹‰æ ‡è®°</span></h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.mark.slow</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_chemical</span>():<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<h3><span id="2-yun-xing-zhi-ding-biao-ji">2. è¿è¡ŒæŒ‡å®šæ ‡è®°</span></h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pytest -m <span class="hljs-string">&quot;slow&quot;</span><br>pytest -m <span class="hljs-string">&quot;not slow&quot;</span><br></code></pre></td></tr></table></figure>

<h2><span id="qi-chang-yong-cli-xuan-xiang">ä¸ƒã€å¸¸ç”¨ CLI é€‰é¡¹</span></h2><table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>-v</code> &#x2F; <code>--verbose</code></td>
<td>è¯¦ç»†è¾“å‡º</td>
</tr>
<tr>
<td><code>-q</code> &#x2F; <code>--quiet</code></td>
<td>æç®€è¾“å‡º</td>
</tr>
<tr>
<td><code>-k EXPRESSION</code></td>
<td>æŒ‰åå­—è¿‡æ»¤æµ‹è¯•ï¼Œæ”¯æŒè¡¨è¾¾å¼ï¼ˆ<code>&quot;test_add or test_sub&quot;</code>ï¼‰</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>é¦–æ¬¡å¤±è´¥å³åœæ­¢</td>
</tr>
<tr>
<td><code>--tb=short/line/no</code></td>
<td>æ§åˆ¶å›æº¯æ ¼å¼</td>
</tr>
<tr>
<td><code>--lf</code></td>
<td>ä»…è¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•</td>
</tr>
<tr>
<td><code>--cov=src</code></td>
<td>ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆéœ€ <code>pytest-cov</code>ï¼‰</td>
</tr>
</tbody></table>
<h2><span id="ba-cha-jian-tui-jian">å…«ã€æ’ä»¶æ¨è</span></h2><table>
<thead>
<tr>
<th>æ’ä»¶</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>pytest-cov</code></td>
<td>ä»£ç è¦†ç›–ç‡</td>
</tr>
<tr>
<td><code>pytest-xdist</code></td>
<td>å¹¶å‘è¿è¡Œï¼ˆ<code>-n auto</code>ï¼‰</td>
</tr>
<tr>
<td><code>pytest-mock</code></td>
<td>é›†æˆ <code>unittest.mock</code> å¹¶æä¾› <code>mocker</code> fixture</td>
</tr>
<tr>
<td><code>pytest-django</code></td>
<td>Django é›†æˆ</td>
</tr>
<tr>
<td><code>pytest-asyncio</code></td>
<td>åŸç”Ÿæ”¯æŒ <code>async/await</code></td>
</tr>
<tr>
<td><code>pytest-html</code></td>
<td>ç”Ÿæˆæ¼‚äº® HTML æŠ¥å‘Š</td>
</tr>
<tr>
<td><code>pytest-timeout</code></td>
<td>è®¾ç½®è¶…æ—¶</td>
</tr>
</tbody></table>
<h2><span id="jiu-zui-jia-shi-jian-xiao-jie">ä¹ã€æœ€ä½³å®è·µå°ç»“</span></h2><ol>
<li><p>é¡¹ç›®æ ¹ç›®å½•æ”¾ <code>tests/</code> æ–‡ä»¶å¤¹ï¼Œä¿æŒä¸ <code>src/</code> å¹³çº§ã€‚</p>
</li>
<li><p>æ¯ä¸ªæµ‹è¯•æ–‡ä»¶ä¸“æ³¨ä¸€ä¸ªå°æ¨¡å—ï¼Œå‘½å <code>test_&lt;module&gt;.py</code>ã€‚</p>
</li>
<li><p>ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ <code>assert</code>ï¼Œè¶³å¤Ÿç›´è§‚ã€‚</p>
</li>
<li><p>æŠŠ <strong>ç¯å¢ƒå‡†å¤‡&#x2F;æ¸…ç†</strong> å†™æˆ fixtureï¼Œæé«˜å¤ç”¨æ€§ã€‚</p>
</li>
<li><p>ç”¨ <code>@pytest.mark.parametrize</code> å‡å°‘é‡å¤ç”¨ä¾‹ã€‚</p>
</li>
<li><p>ç”¨æ ‡è®°åˆ†ç±»â€œæ…¢æµ‹è¯•â€â€œé›†æˆæµ‹è¯•â€ç­‰ï¼ŒCI&#x2F;CD ä¸­é€‰æ‹©æ€§è¿è¡Œã€‚</p>
</li>
<li><p>ç»™å…¬å…± fixture åŠ  <code>scope=&quot;session&quot;</code> å‡å°‘è€—æ—¶ã€‚</p>
</li>
<li><p>åˆç†é…ç½® <code>pytest.ini</code>&#x2F;<code>pyproject.toml</code>ï¼Œé›†ä¸­ç®¡ç†é€‰é¡¹å’Œæ ‡è®°ã€‚</p>
</li>
</ol>
<h2><span id="can-kao-lian-jie">å‚è€ƒé“¾æ¥</span></h2><ul>
<li><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.pytest.org/">https://docs.pytest.org/</a></p>
</li>
<li><p>æ’ä»¶åˆ—è¡¨ï¼š<a href="https://docs.pytest.org/en/stable/reference/plugin_list.html">https://docs.pytest.org/en/stable/reference/plugin_list.html</a></p>
</li>
<li><p>Awesome pytestï¼š<a href="https://github.com/augustogoulart/awesome-pytest">https://github.com/augustogoulart/awesome-pytest</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>åšå®¢æ­å»ºæ–°æ€è·¯ï¼šå€ŸåŠ©å¤§æ¨¡å‹æç¤ºè¯å¼€å¯é«˜æ•ˆä¹‹æ—…</title>
    <url>/2025/07/27/%E6%9D%82%E8%B0%88/2025-07-27-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%B0%E6%80%9D%E8%B7%AF%EF%BC%9A%E5%80%9F%E5%8A%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%BC%80%E5%90%AF%E9%AB%98%E6%95%88%E5%88%9B%E4%BD%9C%E4%B9%8B%E6%97%85/</url>
    <content><![CDATA[<blockquote>
<p>ä½¿ç”¨ Hexo æ¡†æ¶åœ¨ GitHub Pages ä¸Šæ­å»ºä¸ªäººåšå®¢ç«™ç‚¹ï¼Œå¹¶é€šè¿‡ NameSilo è´­ä¹°åŸŸåï¼Œæ‰˜ç®¡åœ¨ Cloudflare ä¸Šï¼Œå°†åŸŸåé‡å®šå‘åˆ° GitHub Pages ç«™ç‚¹ã€‚åŒæ—¶ï¼Œé€‰æ‹© Nextæˆ–Fliud ä½œä¸ºç½‘ç«™ä¸»é¢˜ï¼Œå¹¶ä½¿ç”¨ Obsidian ä½œä¸ºåšå®¢ç®¡ç†å’Œæ’°å†™å·¥å…·ï¼Œæ‰“é€ é«˜æ•ˆèˆ’é€‚çš„å·¥ä½œæµã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªä¿¡æ¯è¿‡è½½çš„æ—¶ä»£ï¼Œæˆ‘åŸæœ¬è®¡åˆ’æ’°å†™ä¸€ç¯‡è¯¦å°½çš„Hexoåšå®¢æ­å»ºæ•™ç¨‹ï¼Œç›´åˆ°ä¸€ç¯‡çŸ¥ä¹ä¸“æ ç‚¹é†’äº†æˆ‘â€”â€”å½“ç›®å½•éƒ½è®©äººæœ›è€Œç”Ÿç•æ—¶ï¼Œè¿™æ ·çš„å†…å®¹çœŸçš„è¿˜æœ‰ä»·å€¼å—ï¼Ÿäºæ˜¯ï¼Œæˆ‘å†³å®šæä¾›æ›´é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯ï¼Œè®©AIæˆä¸ºä½ çš„æŠ€æœ¯é¡¾é—®ï¼Œå¸¦ä½ å¿«é€Ÿå®Œæˆä»é›¶åˆ°ä¸€çš„åšå®¢æ­å»ºã€‚</p>
<h4><span id="wei-shi-me-xu-yao-ti-shi-ci-ce-lue">ä¸ºä»€ä¹ˆéœ€è¦æç¤ºè¯ç­–ç•¥ï¼Ÿ</span></h4><p>ä½ å¯èƒ½ä¼šé—®ï¼šç›´æ¥è¯¢é—®GPTä¸å°±å¥½äº†ï¼Ÿä½†å®è·µè¿‡çš„äººéƒ½çŸ¥é“ï¼Œé›¶æ•£çš„æé—®ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><p>åå¤è¸©å‘æ¶ˆè€—å¯¹è¯è½®æ•°</p>
</li>
<li><p>ä¸Šä¸‹æ–‡æ–­è£‚éœ€è¦ä¸æ–­æ€»ç»“</p>
</li>
<li><p>è§£å†³æ–¹æ¡ˆç¼ºä¹ç³»ç»Ÿæ€§</p>
</li>
</ol>
<p>é€šè¿‡è¿™å¥—ç»“æ„åŒ–æç¤ºè¯ä½“ç³»ï¼Œä½ å¯ä»¥ï¼š</p>
<ul>
<li><p>è·å¾—å®Œæ•´çš„æŠ€æœ¯è·¯å¾„</p>
</li>
<li><p>é¢„åˆ¤å¹¶è§„é¿å¸¸è§é™·é˜±</p>
</li>
<li><p>å»ºç«‹é«˜æ•ˆçš„å·¥ä½œæµé—­ç¯</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å…·ä½“æ“ä½œæ€»ç»“ä¸ºæ™ºèƒ½æ­å»ºäº”éƒ¨æ›²ï¼š<br><em>0. åŸºç¡€å‡†å¤‡ï¼ˆç§‘å­¦ä¸Šç½‘æ–¹æ¡ˆï¼‰</em><br><em>1. Hexoæ ¸å¿ƒæ­å»º</em><br><em>2. åŸŸåç³»ç»Ÿä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰</em><br><em>3. ä¸»é¢˜æ·±åº¦å®šåˆ¶</em><br><em>4. Obsidianå†…å®¹ç®¡ç†</em></p>
<p><strong>0. åŸºç¡€å‡†å¤‡ï¼ˆç§‘å­¦ä¸Šç½‘æ–¹æ¡ˆï¼‰</strong><br>æ—¢ç„¶ä½¿ç”¨äº†githubï¼Œé‚£â€œç§‘å­¦ä¸Šç½‘â€å°±æ˜¯é€ƒä¸å¼€çš„è¯é¢˜ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æç¤ºè¯ï¼š<br>â€œæˆ‘åœ¨ä¸­å›½å¤§é™†ï¼Œéœ€è¦ç¨³å®šè®¿é—®GitHubè¿›è¡Œåšå®¢æ­å»ºï¼Œè¯·æ¨èä¸‰ç§å¯è¡Œçš„ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œè¦æ±‚ï¼š</p>
<ol>
<li>åŒ…å«å…·ä½“é…ç½®æ­¥éª¤</li>
<li>æ³¨æ˜å„æ–¹æ¡ˆä¼˜ç¼ºç‚¹</li>
<li>æä¾›éªŒè¯è¿æ¥æˆåŠŸçš„æ–¹æ³•â€</li>
</ol>
<p><strong>1. Hexoæ ¸å¿ƒæ­å»º</strong><br>è¦æƒ³ä½¿ç”¨hexoï¼Œä½ è¿˜éœ€è¦ä¸‹è½½Node.jsã€npmã€Gitå¹¶é…ç½®sshè¿æ¥ï¼Œå› ä¸ºä½¿ç”¨HTTPè¿æ¥ä¼šå‡ºç°å¾ˆå¤šç½‘ç»œé—®é¢˜ï¼Œä½ å¯ä»¥å‚è€ƒä»¥ä¸‹çš„æç¤ºè¯ï¼š<br>â€œä½œä¸ºå‰ç«¯æ–°æ‰‹ï¼Œæˆ‘éœ€è¦é€šè¿‡Hexo+GitHub Pagesæ­å»ºåšå®¢ï¼Œè¯·ï¼š</p>
<ol>
<li>åˆ†æ­¥æŒ‡å¯¼Node.js&#x2F;npm&#x2F;Gitç¯å¢ƒé…ç½®</li>
<li>æä¾›SSHå¯†é’¥ç”Ÿæˆä¸GitHubé…ç½®çš„å®Œæ•´å‘½ä»¤</li>
<li>åŒ…å«éªŒè¯å„ç¯èŠ‚æˆåŠŸçš„æ£€æµ‹å‘½ä»¤</li>
<li>è§£é‡Š.gitignoreçš„æœ€ä½³å®è·µé…ç½®â€</li>
</ol>
<p><strong>2. åŸŸåç³»ç»Ÿä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰</strong><br>å¦‚æœæƒ³è¦è´­ä¹°ç§æœ‰åŸŸåå¹¶éƒ¨ç½²ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æç¤ºè¯ï¼ˆæ³¨æ„å°†example.comæ›¿æ¢æˆè‡ªå·±å¿ƒä»ªçš„åŸŸåå“¦ï¼‰ï¼š<br>â€œè®¡åˆ’åœ¨NameSiloè´­ä¹°example.comåŸŸåå¹¶é€šè¿‡Cloudflareæ‰˜ç®¡ï¼Œè¦æ±‚ï¼š</p>
<ol>
<li>åŸŸåè§£æçš„å®Œæ•´DNSé…ç½®æµç¨‹</li>
<li>HTTPSå¼ºåˆ¶è·³è½¬è®¾ç½®</li>
<li>GitHub Pagesçš„CNAMEé…ç½®</li>
<li>å¸¸è§SSLè¯ä¹¦é—®é¢˜çš„è§£å†³æ–¹æ¡ˆâ€</li>
</ol>
<p><strong>3. ä¸»é¢˜æ·±åº¦å®šåˆ¶</strong><br>ä½ çš„åšå®¢å¾€å¾€éœ€è¦ä¸€ä¸ªä¸»é¢˜æ‰èƒ½æ›´å¥½çœ‹ï¼Œä»¥åŠè¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ï¼š<br>â€œä¸ºHexoé€‰æ‹©Fluidä¸»é¢˜åï¼Œæˆ‘éœ€è¦ï¼š</p>
<ol>
<li>ä¿®æ”¹ä¸»é¢˜è‰²ä¸º#2C3E50</li>
<li>æ·»åŠ è±†ç“£é˜…è¯»æ’ä»¶</li>
<li>å®ç°ç›®å½•é”šç‚¹è·³è½¬</li>
<li>ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºæ•ˆæœ<br>è¯·ç»™å‡ºå…·ä½“é…ç½®ä»£ç åŠè§£é‡Šâ€<br>åšå®¢ä¸»é¢˜çš„ä¸ªæ€§åŒ–å®šåˆ¶æ˜¯ä¸ªæ— åº•æ´ï¼Œè¿™é‡Œå»ºè®®å…ˆè¿›è¡Œç®€å•çš„é…ç½®ï¼Œä¹‹åä¸€è¾¹ç†è§£ä¸€è¾¹æ…¢æ…¢æ·»åŠ ä¿®æ”¹ã€‚</li>
</ol>
<p><strong>4. Obsidianå†…å®¹ç®¡ç†</strong><br>è¿™åº”è¯¥æ˜¯é™¤äº†é…ç½®ç§æœ‰åŸŸåå¤–æœ€å®¹æ˜“è¸©å‘çš„åœ°æ–¹äº†ï¼Œä¸‹é¢çš„æç¤ºè¯ä¹Ÿåªèƒ½ä½œä¸ºå‚è€ƒï¼Œå„ä½å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µè¿›è¡Œåˆ æ”¹ï¼Œå½“ç„¶æˆ‘æ›´å»ºè®®ä»¥obsidianä¸hexoä½œä¸ºå…³é”®è¯è¿›è¡Œæ£€ç´¢ï¼Œæ‰¾ä¸€ä¸ªåˆé€‚çš„æ¨¡ç‰ˆï¼Œé’ˆå¯¹è¯¥æ¨¡ç‰ˆè¿›è¡Œæé—®ä¸é…ç½®ã€‚<br>â€œéœ€è¦å»ºç«‹Obsidian+Hexoçš„å†™ä½œç³»ç»Ÿï¼š</p>
<ol>
<li>æ–‡ä»¶æ ‘è‡ªåŠ¨æ˜ å°„ä¸ºåšå®¢åˆ†ç±»</li>
<li>æ¨¡æ¿åŒ…å«Front-matterè‡ªåŠ¨å¡«å……</li>
<li>ä¸€é”®éƒ¨ç½²è„šæœ¬é›†æˆ</li>
<li>å›¾ç‰‡èµ„æºè‡ªåŠ¨åŒ–å¤„ç†æ–¹æ¡ˆ<br>è¯·ç»™å‡ºMarkdownæ¨¡æ¿ç¤ºä¾‹å’ŒVaulté…ç½®å»ºè®®â€</li>
</ol>
<p>å¥½äº†ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¤§æ¦‚ç‡å·²ç»å°†ä½ çš„åšå®¢éƒ¨ç½²å®Œæˆï¼Œå½“ç„¶ï¼Œé‡åˆ°é—®é¢˜ä¹Ÿä¸å¿…æƒŠæ…Œï¼Œå°†æŠ¥é”™å¤åˆ¶ä¸‹æ¥ä¸¢ç»™ä½ çš„å¤§æ¨¡å‹è€å¸ˆå°±è¡Œäº†ã€‚ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„æ›´æ–°ç»´æŠ¤æ–¹æ³•ï¼š<br>1.é¢„è§ˆä½ çš„åšå®¢ï¼š<br>hexo c &amp;&amp; hexo g &amp;&amp; hexo s<br>2.éƒ¨ç½²ä½ çš„åšå®¢:<br>hexo c &amp;&amp; hexo g &amp;&amp; hexo d<br>æŠ€æœ¯è¯´æ˜ï¼ˆå‘½ä»¤å¯ç®€å†™ä¸ºé¦–å­—æ¯ï¼‰ï¼š</p>
<ul>
<li><p><code>clean</code>ï¼šæ¸…é™¤<code>public</code>å’Œ<code>db.json</code>ç¼“å­˜</p>
</li>
<li><p><code>generate</code>ï¼šç”Ÿæˆé™æ€HTMLåˆ°publicç›®å½•</p>
</li>
<li><p><code>server</code>ï¼šå¯åŠ¨æœ¬åœ°4000ç«¯å£æœåŠ¡</p>
</li>
<li><p><code>deploy</code>ï¼šè‡ªåŠ¨æ¨é€è‡³GitHub Pages</p>
</li>
</ul>
<h4><span id="bo-ke-xie-zuo-de-xian-dai-yi-yi">åšå®¢å†™ä½œçš„ç°ä»£æ„ä¹‰</span></h4><p>åœ¨è¿™ä¸ªAIé‡æ„çŸ¥è¯†è·å–æ–¹å¼çš„æ—¶ä»£ï¼Œåšå®¢çš„ä»·å€¼æ­£åœ¨è½¬å‘ï¼š</p>
<ul>
<li><p>ğŸ§  ä¸ªäººçŸ¥è¯†æ™¶ä½“åŒ–å·¥å…·</p>
</li>
<li><p>ğŸ”„ è´¹æ›¼å­¦ä¹ æ³•çš„å®è·µåœºåŸŸ</p>
</li>
<li><p>ğŸ¨ æ•°å­—èº«ä»½çš„å¯è§†åŒ–åç‰‡</p>
</li>
</ul>
<p>æ­£å¦‚ç¼–ç¨‹ä»è®°å¿†è¯­æ³•è½¬å‘é—®é¢˜æ±‚è§£ï¼Œåšå®¢æ­å»ºä¹Ÿåº”å½“ä»æŠ€æœ¯å®ç°è½¬å‘ä»·å€¼åˆ›é€ ã€‚ç°åœ¨ï¼Œä½ éœ€è¦çš„ä¸æ˜¯åˆä¸€ç¯‡æ•™ç¨‹ï¼Œè€Œæ˜¯ç«‹å³åˆ›å»ºä½ çš„<code>first_post.md</code>â€”â€”å› ä¸ºæœ€å¥½çš„å­¦ä¹ ï¼Œæ°¸è¿œå‘ç”Ÿåœ¨ä½ æŒ‰ä¸‹å‘å¸ƒæŒ‰é’®çš„é‚£ä¸€åˆ»ã€‚</p>
]]></content>
      <categories>
        <category>æ‚è°ˆ</category>
      </categories>
  </entry>
  <entry>
    <title>CSSé€‰æ‹©å™¨ä¸XPath</title>
    <url>/2025/07/30/%E7%88%AC%E8%99%AB/2025-07-30-CSS%E9%80%89%E6%8B%A9%E5%99%A8%E4%B8%8EXPath/</url>
    <content><![CDATA[<blockquote>
<p>åšä¸»æœ€è¿‘åœ¨æ„å»ºä¸€ä¸ªç”¨äºå±é™©åŒ–å­¦å“æ£€æµ‹çš„å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±ï¼Œç”±äºæ²¡æœ‰å¼€æºçš„æ•°æ®é›†ï¼Œé‚åªèƒ½è‡ªè¡Œè¿›è¡Œæ•°æ®çš„çˆ¬å–ã€‚è€Œæƒ³è¦è¿›è¡Œç½‘ç»œèµ„æºçš„æŠ“å–ï¼Œå¯¹äºæ–‡æ¡£å…ƒç´ çš„å®šä½æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ã€‚æ­£åˆ™è¡¨è¾¾å¼ç”±äºå†™æ³•è¿‡äºå†—æ‚ï¼Œä¸åœ¨åšä¸»çš„è€ƒè™‘ä¹‹ä¸­ï¼Œæ¥ä¸‹æ¥ä¸»è¦ä¸ºå¤§å®¶ä»‹ç»CSSé€‰æ‹©å™¨ä¸XPathä¸¤ç§æ–¹æ³•ã€‚</p>
</blockquote>
<h3><span id="css-xuan-ze-qi">CSSé€‰æ‹©å™¨</span></h3><p>CSSæ˜¯å±‚å æ ·å¼è¡¨çš„ç®€ç§°ï¼Œå¾ˆå¤šçš„ç½‘é¡µéƒ½ä½¿ç”¨äº†è¿™ä¸ªæŠ€æœ¯ï¼Œå› æ­¤ï¼Œè¦ç”¨äºHTMLæ–‡æ¡£çš„æ ·å¼åº”ç”¨CSSé€‰æ‹©å™¨ï¼Œä¹Ÿè¢«å¹¿æ³›ç”¨äºWebæŠ“å–å’Œå‰ç«¯æµ‹è¯•ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
  </entry>
  <entry>
    <title>SeleniumåŠ¨æ€ç½‘é¡µçˆ¬å–æŠ€æœ¯è¯¦è§£</title>
    <url>/2025/07/31/%E7%88%AC%E8%99%AB/2025-07-30-Selenium%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E7%88%AC%E5%8F%96%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œè¶Šæ¥è¶Šå¤šçš„ç½‘ç«™é‡‡ç”¨åŠ¨æ€åŠ è½½æŠ€æœ¯ï¼Œä¼ ç»Ÿçˆ¬è™«éš¾ä»¥è·å–å®Œæ•´æ•°æ®ã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨Seleniumè¿›è¡ŒåŠ¨æ€ç½‘é¡µçˆ¬å–ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªåŒ–å­¦æ•°æ®çˆ¬å–çš„å®æˆ˜æ¡ˆä¾‹å±•ç¤ºå®Œæ•´æµç¨‹ã€‚</p>
</blockquote>
<h2><span id="ling-wei-shi-me-yao-shi-yong-selenium">é›¶ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Selenium</span></h2><p>åšä¸»åœ¨è¿›è¡Œçˆ¬è™«å®æˆ˜æ—¶é‡åˆ°äº†ä¸å°‘éšœç¢ï¼ŒçŸ¥å·±çŸ¥å½¼æ–¹èƒ½å…‹æ•Œåˆ¶èƒœã€‚é¦–å…ˆä»‹ç»ä¸€äº›å¸¸è§çš„åçˆ¬æ‰‹æ®µï¼š</p>
<ol>
<li><p><strong>AJAXå¼‚æ­¥åŠ è½½</strong>ï¼šæ•°æ®é€šè¿‡å¤šæ¬¡è¯·æ±‚å¼‚æ­¥åŠ è½½</p>
</li>
<li><p><strong>JavaScriptæ¸²æŸ“</strong>ï¼šæ•°æ®è¢«ç‰¹æ®Šæ ¼å¼éšè—åœ¨æºç ä¸­</p>
</li>
<li><p><strong>è¯·æ±‚å¤´æ£€æµ‹</strong>ï¼šå¯¹User-Agentå’ŒåŠ¨æ€å­—æ®µçš„éªŒè¯</p>
</li>
<li><p><strong>æµè§ˆå™¨ç‰¹å¾æ£€æµ‹</strong>ï¼šé€šè¿‡DOMæŒ‡çº¹è¯†åˆ«çˆ¬è™«</p>
</li>
<li><p><strong>IPæ£€æµ‹</strong>ï¼šåŸºäºIPè®¿é—®é¢‘ç‡çš„å°é”æœºåˆ¶</p>
</li>
<li><p><strong>éªŒè¯ç³»ç»Ÿ</strong>ï¼šç™»å½•éªŒè¯å’ŒäººæœºéªŒè¯</p>
</li>
</ol>
<p>é¢å¯¹è¿™ç§æƒ…å†µï¼Œç®€å•çš„è®¾ç½®ä»£ç†ã€æ·»åŠ Cookieã€è®¾ç½®çˆ¬å–é¢‘ç‡ç­‰æ‰‹æ®µå·²ç»æ‰è¥Ÿè§è‚˜ã€‚å³ä½¿å¯ä»¥è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œä¹Ÿä¼šå‡ºç°case by caseï¼Œä¹Ÿå°±æ˜¯é¢å¯¹æ¯ä¸ªç½‘ç«™éƒ½éœ€è¦é‡æ„è‡ªå·±çˆ¬è™«ç³»ç»Ÿçš„çª˜å¢ƒï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ä¸ªç›¸å¯¹æ¥è¯´æ›´ç®€å•é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿæˆ‘è®¤ä¸ºSeleniumé€šè¿‡æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸ºï¼Œæä¾›äº†ä¸€å¥—ç›¸å¯¹é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2><span id="yi-selenium-ji-chu-gai-nian">ä¸€ã€SeleniumåŸºç¡€æ¦‚å¿µ</span></h2><h3><span id="1-shi-me-shi-selenium">1. ä»€ä¹ˆæ˜¯Selenium</span></h3><p>Seleniumæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œä½†ä¹Ÿè¢«å¹¿æ³›ç”¨äºç½‘é¡µçˆ¬å–ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ï¼š</p>
<ul>
<li><p>éœ€è¦JavaScriptæ¸²æŸ“çš„é¡µé¢</p>
</li>
<li><p>åŸºäºAJAXåŠ¨æ€åŠ è½½çš„å†…å®¹</p>
</li>
<li><p>éœ€è¦äº¤äº’æ“ä½œæ‰èƒ½è·å–çš„æ•°æ®</p>
</li>
</ul>
<h3><span id="2-he-xin-zu-jian">2. æ ¸å¿ƒç»„ä»¶</span></h3><table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>åŠŸèƒ½è¯´æ˜</th>
<th>å…¸å‹åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>WebDriver</td>
<td>æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¥å£</td>
<td>æ”¯æŒChromeã€Firefoxç­‰ä¸»æµæµè§ˆå™¨</td>
</tr>
<tr>
<td>WebElement</td>
<td>DOMå…ƒç´ å¯¹è±¡</td>
<td>é¡µé¢å…ƒç´ å®šä½å’Œæ“ä½œ</td>
</tr>
<tr>
<td>Waitæœºåˆ¶</td>
<td>åŠ¨æ€åŠ è½½ç­‰å¾…ç­–ç•¥</td>
<td>å¤„ç†AJAXå†…å®¹åŠ è½½</td>
</tr>
<tr>
<td>Action Chains</td>
<td>å¤æ‚ç”¨æˆ·æ“ä½œæ¨¡æ‹Ÿ</td>
<td>æ‹–æ‹½ã€é¼ æ ‡æ‚¬åœç­‰äº¤äº’</td>
</tr>
</tbody></table>
<h2><span id="er-dong-tai-pa-qu-guan-jian-ji-zhu">äºŒã€åŠ¨æ€çˆ¬å–å…³é”®æŠ€æœ¯</span></h2><p>è¿™é‡Œåšä¸»ä¸å¯¹æ¯ä¸ªæŠ€æœ¯è¿›é•¿ç¯‡å¤§è®ºï¼Œåªç»™å‡ºæ¯ç§æŠ€æœ¯çš„ä½¿ç”¨åœºæ™¯åŠæç¤ºè¯ã€‚</p>
<h3><span id="he-xin-cao-zuo-lei">æ ¸å¿ƒæ“ä½œç±»</span></h3><h4><span id="1-yuan-su-ding-wei">1. å…ƒç´ å®šä½</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œç”¨Pythonçš„Seleniumç¼–å†™ä»£ç ï¼Œä½¿ç”¨{å®šä½æ–¹å¼}å®šä½ä»¥ä¸‹å…ƒç´ ï¼š</p>
<ul>
<li><p>å…ƒç´ ç‰¹å¾æè¿°ï¼š{å¯è§æ–‡æœ¬&#x2F;ID&#x2F;Class&#x2F;XPathè·¯å¾„ç­‰}</p>
</li>
<li><p>ç‰¹æ®Šè¦æ±‚ï¼š{å¦‚éœ€è¦ç­‰å¾…&#x2F;å¤„ç†iframe&#x2F;æ’é™¤éšè—å…ƒç´ ç­‰}<br>  è¿”å›å®Œæ•´çš„å®šä½ä»£ç ç¤ºä¾‹ï¼ŒåŒ…å«å¼‚å¸¸å¤„ç†â€</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br>â€œç”¨Pythonçš„Seleniumç¼–å†™ä»£ç ï¼Œä½¿ç”¨CSSé€‰æ‹©å™¨å®šä½classåŒ…å«â€™product-itemâ€™ä¸”ä¸åŒ…å«â€™out-of-stockâ€™çš„divå…ƒç´ ï¼Œè¦æ±‚å…ˆç­‰å¾…å…ƒç´ å¯è§ï¼Œè¿”å›å®Œæ•´ä»£ç â€</p>
<p><em>æ³¨ï¼šå¸¸ç”¨å®šä½æ–¹å¼æœ‰ï¼šidå®šä½ã€cssé€‰æ‹©å™¨ã€XPathã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</em></p>
<h4><span id="2-dong-tai-deng-dai">2. åŠ¨æ€ç­‰å¾…</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œä¸ºSeleniumç¼–å†™ä¸€ä¸ªæ˜¾å¼ç­‰å¾…å‡½æ•°ï¼Œè¦æ±‚ï¼š</p>
<ul>
<li><p>ç­‰å¾…æ¡ä»¶ï¼š{å…ƒç´ å‡ºç°&#x2F;å¯è§&#x2F;å¯ç‚¹å‡»&#x2F;æ–‡æœ¬åŒ…å«&#x2F;å…ƒç´ æ¶ˆå¤±ç­‰}</p>
</li>
<li><p>è¶…æ—¶æ—¶é—´ï¼š{ç§’æ•°}</p>
</li>
<li><p>å®¹é”™æœºåˆ¶ï¼š{è¶…æ—¶åæ“ä½œ}<br>  è¾“å‡ºå¸¦æ³¨é‡Šçš„Pythonä»£ç â€</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br>â€œä¸ºSeleniumç¼–å†™ä¸€ä¸ªæ˜¾å¼ç­‰å¾…å‡½æ•°ï¼Œç­‰å¾…IDä¸ºâ€™ajax-contentâ€™çš„divå†…å‡ºç°è‡³å°‘3ä¸ªå­å…ƒç´ ï¼Œè¶…æ—¶10ç§’ï¼Œå¤±è´¥åè‡ªåŠ¨æˆªå›¾ï¼Œè¿”å›å®Œæ•´ä»£ç â€</p>
<hr>
<h3><span id="fan-fan-pa-ce-lue-lei">ååçˆ¬ç­–ç•¥ç±»</span></h3><h4><span id="3-zhi-wen-wei-zhuang">3. æŒ‡çº¹ä¼ªè£…</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œç”Ÿæˆå®Œæ•´çš„Seleniumæµè§ˆå™¨é…ç½®ä»£ç ï¼Œå®ç°ï¼š</p>
<ol>
<li><p>éšè—è‡ªåŠ¨åŒ–ç‰¹å¾ï¼ˆå¦‚webdriverå±æ€§ï¼‰</p>
</li>
<li><p>éšæœºUser-Agentè½®æ¢</p>
</li>
<li><p>ç¦ç”¨WebRTCæ³„æ¼<br> åŒ…å«å¼‚å¸¸å¤„ç†å’Œæ³¨é‡Šè¯´æ˜â€</p>
</li>
</ol>
<h4><span id="4-yan-zheng-ma-rao-guo">4. éªŒè¯ç ç»•è¿‡</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œè®¾è®¡ä¸€ä¸ªå¤„ç†Seleniumä¸­å¸¸è§éªŒè¯ç çš„æ–¹æ¡ˆï¼Œè¦æ±‚ï¼š</p>
<ul>
<li><p>è¯†åˆ«ç±»å‹ï¼š{å›¾ç‰‡éªŒè¯ç &#x2F;æ»‘å—&#x2F;reCAPTCHAç­‰}</p>
</li>
<li><p>å·¥å…·é€‰æ‹©ï¼š{ç¬¬ä¸‰æ–¹API&#x2F;æœ¬åœ°OCR&#x2F;æ‰‹åŠ¨ä»‹å…¥ç­‰}<br>  è¾“å‡ºåˆ†æ­¥éª¤çš„Pythonå®ç°é€»è¾‘â€</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br>â€œè®¾è®¡ä¸€ä¸ªé€šè¿‡2CaptchaæœåŠ¡è‡ªåŠ¨è§£å†³Seleniumä¸­reCAPTCHA v2çš„æ–¹æ¡ˆï¼ŒåŒ…å«ï¼š</p>
<ol>
<li><p>æ£€æµ‹éªŒè¯ç å‡ºç°</p>
</li>
<li><p>è°ƒç”¨APIæµç¨‹</p>
</li>
<li><p>ç»“æœè‡ªåŠ¨å¡«å……<br> è¿”å›å¸¦é”™è¯¯é‡è¯•æœºåˆ¶çš„ä»£ç â€</p>
</li>
</ol>
<p><em>æ³¨ï¼šå¯¹äºå®æ—¶æ€§è¦æ±‚ä¸é«˜çš„çˆ¬è™«é¡¹ç›®ï¼Œå¯ä»¥è€ƒè™‘è°ƒå¤§wait_timeçš„æ—¶é—´ï¼Œæ‰‹åŠ¨è¿›è¡ŒéªŒè¯</em></p>
<hr>
<h3><span id="xing-neng-you-hua-lei">æ€§èƒ½ä¼˜åŒ–ç±»</span></h3><h4><span id="5-bing-xing-chu-li">5. å¹¶è¡Œå¤„ç†</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œç”¨Pythonå®ç°å¤šçº¿ç¨‹Seleniumçˆ¬è™«ï¼Œè¦æ±‚ï¼š</p>
<ul>
<li><p>çº¿ç¨‹æ•°ï¼š{N}</p>
</li>
<li><p>ä»»åŠ¡åˆ†é…ï¼š{URLé˜Ÿåˆ—&#x2F;åŠ¨æ€ä»»åŠ¡åˆ†å‘}</p>
</li>
<li><p>æ•°æ®åˆå¹¶ï¼š{å»é‡&#x2F;ç»Ÿä¸€å­˜å‚¨}<br>  é¿å…èµ„æºç«äº‰å’Œæµè§ˆå™¨å®ä¾‹å†²çªçš„å®Œæ•´æ–¹æ¡ˆâ€</p>
</li>
</ul>
<h4><span id="6-huan-cun-li-yong">6. ç¼“å­˜åˆ©ç”¨</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œç¼–å†™Seleniumç¼“å­˜ç®¡ç†å·¥å…·ï¼Œå®ç°ï¼š</p>
<ul>
<li><p>è‡ªåŠ¨å¤ç”¨å·²æœ‰ç™»å½•çŠ¶æ€</p>
</li>
<li><p>é¡µé¢é™æ€èµ„æºç¼“å­˜</p>
</li>
<li><p>æ”¯æŒå¼ºåˆ¶åˆ·æ–°æ¡ä»¶<br>  è¾“å‡ºé…ç½®ä»£ç å’Œä½¿ç”¨ç¤ºä¾‹â€</p>
</li>
</ul>
<hr>
<h3><span id="gao-ji-gong-neng-lei">é«˜çº§åŠŸèƒ½ç±»</span></h3><h4><span id="7-wang-luo-jian-kong">7. ç½‘ç»œç›‘æ§</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œé€šè¿‡Selenium CDPåè®®ç›‘æ§æ‰€æœ‰XHRè¯·æ±‚ï¼Œè¦æ±‚ï¼š</p>
<ul>
<li><p>æ•è·è¯·æ±‚URLå’Œå“åº”ä½“</p>
</li>
<li><p>è¿‡æ»¤æ¡ä»¶ï¼š{åŸŸå&#x2F;è¯·æ±‚ç±»å‹ç­‰}</p>
</li>
<li><p>å¼‚å¸¸è¯·æ±‚é‡è¯•æœºåˆ¶<br>  è¿”å›å¯ç›´æ¥è¿è¡Œçš„ä»£ç ç‰‡æ®µâ€</p>
</li>
</ul>
<h4><span id="8-yi-dong-duan-mo-ni">8. ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œç”Ÿæˆç§»åŠ¨ç«¯è®¾å¤‡æ¨¡æ‹Ÿçš„Seleniumé…ç½®ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li><p>è®¾å¤‡å‹å·ï¼š{iPhone 14&#x2F;Galaxy S22ç­‰}</p>
</li>
<li><p>è§¦æ‘¸äº‹ä»¶æ¨¡æ‹Ÿ</p>
</li>
<li><p>ç½‘ç»œèŠ‚æµè®¾ç½®<br>  è¾“å‡ºå®Œæ•´è®¾å¤‡å‚æ•°åˆ—è¡¨å’Œåˆå§‹åŒ–ä»£ç â€</p>
</li>
</ul>
<hr>
<h3><span id="diao-shi-yu-yi-chang-lei">è°ƒè¯•ä¸å¼‚å¸¸ç±»</span></h3><h4><span id="9-zhi-neng-diao-shi">9. æ™ºèƒ½è°ƒè¯•</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œä¸ºä»¥ä¸‹SeleniumæŠ¥é”™æä¾›è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>é”™è¯¯ä¿¡æ¯ï¼š{å®Œæ•´é”™è¯¯æ—¥å¿—}</p>
</li>
<li><p>ä¸Šä¸‹æ–‡ï¼š{æ“ä½œæ­¥éª¤&#x2F;ç›®æ ‡ç½‘ç«™}<br>  è¦æ±‚ç»™å‡ºï¼š</p>
</li>
</ul>
<ol>
<li><p>é”™è¯¯åŸå› åˆ†æ</p>
</li>
<li><p>ä¸‰ç§å¯èƒ½çš„è§£å†³æ–¹å¼</p>
</li>
<li><p>æ¨èæ–¹æ¡ˆä»£ç å®ç°â€</p>
</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br>â€œä¸ºSeleniumæŠ¥é”™â€™ElementClickInterceptedExceptionâ€™æä¾›è§£å†³æ–¹æ¡ˆï¼Œå‘ç”Ÿåœ¨ç‚¹å‡»æµ®åŠ¨å¹¿å‘Šåçš„é¡µé¢å…ƒç´ æ—¶ï¼Œè¦æ±‚ç»™å‡ºä¸‰ç§å¤„ç†æ–¹å¼å¹¶æ¯”è¾ƒä¼˜ç¼ºç‚¹â€</p>
<hr>
<h3><span id="fu-he-chang-jing-mo-ban">å¤åˆåœºæ™¯æ¨¡æ¿</span></h3><h4><span id="10-wan-zheng-pa-chong-she-ji">10. å®Œæ•´çˆ¬è™«è®¾è®¡</span></h4><p><strong>Promptæ¨¡æ¿</strong>ï¼š<br>â€œè®¾è®¡ä¸€ä¸ªå®Œæ•´çš„Seleniumçˆ¬è™«é¡¹ç›®ï¼Œéœ€æ±‚ï¼š</p>
<ul>
<li><p>ç›®æ ‡ç½‘ç«™ï¼š{ç½‘ç«™ç±»å‹&#x2F;ç¤ºä¾‹URL}</p>
</li>
<li><p>æ•°æ®è¦æ±‚ï¼š{é‡‡é›†å­—æ®µ&#x2F;é¢‘ç‡&#x2F;å­˜å‚¨æ ¼å¼}</p>
</li>
<li><p>ç‰¹æ®ŠæŒ‘æˆ˜ï¼š{ç™»å½•&#x2F;éªŒè¯ç &#x2F;åŠ¨æ€åŠ è½½ç­‰}<br>  è¾“å‡ºï¼š</p>
</li>
</ul>
<ol>
<li><p>æŠ€æœ¯é€‰å‹è¯´æ˜</p>
</li>
<li><p>æ ¸å¿ƒä»£ç æ¶æ„</p>
</li>
<li><p>å¼‚å¸¸å¤„ç†æµç¨‹å›¾â€</p>
</li>
</ol>
<hr>
<h3><span id="shi-yong-jian-yi">ä½¿ç”¨å»ºè®®ï¼š</span></h3><ol>
<li><p><strong>ç²¾ç¡®æè¿°</strong>ï¼šåŒ…å«å…·ä½“å‚æ•°ï¼ˆè¶…æ—¶æ—¶é—´ã€å…ƒç´ ç‰¹å¾ç­‰ï¼‰</p>
</li>
<li><p><strong>åˆ†æ­¥è¯·æ±‚</strong>ï¼šå¤æ‚åœºæ™¯æ‹†è§£ä¸ºå¤šä¸ªPrompt</p>
</li>
<li><p><strong>ç¤ºä¾‹å‚è€ƒ</strong>ï¼šæä¾›ç±»ä¼¼ä»£ç ç‰‡æ®µåŠ é€Ÿç”Ÿæˆ</p>
</li>
<li><p><strong>é™åˆ¶æ¡ä»¶</strong>ï¼šæ˜ç¡®è¦æ±‚ï¼ˆå¦‚â€ä¸ç”¨ç¬¬ä¸‰æ–¹åº“â€ï¼‰</p>
</li>
</ol>
<p><strong>æ•ˆæœæœ€å¥½çš„Promptç»“æ„</strong>ï¼š<br>â€œä»¥{ç¼–ç¨‹è¯­è¨€}ç¼–å†™{åŠŸèƒ½æè¿°}ä»£ç ï¼Œè¦æ±‚{å…·ä½“éœ€æ±‚}ï¼Œé¿å…{å¸¸è§é—®é¢˜}ï¼Œè¾“å‡ºæ ¼å¼ï¼š{ä»£ç &#x2F;æµç¨‹å›¾&#x2F;æ­¥éª¤è¯´æ˜}ï¼Œç¤ºä¾‹å‚è€ƒï¼š{ç±»ä¼¼ä»£ç ç‰‡æ®µ}â€</p>
<p>è¿™äº›Promptç»è¿‡å®é™…æµ‹è¯•ï¼Œèƒ½æœ‰æ•ˆå¼•å¯¼LLMç”Ÿæˆå¯è¿è¡Œçš„Seleniumä»£ç è§£å†³æ–¹æ¡ˆã€‚</p>
<h2><span id="san-shi-zhan-an-li-hua-xue-shu-ju-pa-qu">ä¸‰ã€å®æˆ˜æ¡ˆä¾‹ï¼šåŒ–å­¦æ•°æ®çˆ¬å–</span></h2><h3><span id="1-ye-mian-fen-xi-ji-qiao">1. é¡µé¢åˆ†ææŠ€å·§</span></h3><p><strong>å¼€å‘è€…å·¥å…·ä½¿ç”¨</strong>ï¼š</p>
<ol>
<li><p>F12æ‰“å¼€å¼€å‘è€…å·¥å…·</p>
</li>
<li><p>Networké¢æ¿ç›‘æ§XHRè¯·æ±‚</p>
</li>
<li><p>Elementsé¢æ¿åˆ†æDOMç»“æ„</p>
</li>
</ol>
<h3><span id="2-wan-zheng-pa-qu-liu-cheng">2. å®Œæ•´çˆ¬å–æµç¨‹</span></h3><p>é¦–å…ˆè®¾ç½®ä¸€ä¸ª CONFIG è¿›è¡Œå‚æ•°é…ç½®ï¼Œä¸‹é¢å¯¹å…·ä½“å‚æ•°è¿›è¡Œç®€å•ä»‹ç»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é…ç½®å‚æ•°  </span><br>	CONFIG = &#123;  <br>	    <span class="hljs-string">&#x27;login_url&#x27;</span>: <span class="hljs-string">&#x27;https://example.com/login/,  </span><br><span class="hljs-string">	    &#x27;</span>base_url<span class="hljs-string">&#x27;: &#x27;</span>https://example.com/<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">	    &#x27;</span>username<span class="hljs-string">&#x27;: &#x27;</span>stackecho<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">	    &#x27;</span>password<span class="hljs-string">&#x27;: &#x27;</span><span class="hljs-number">123456</span><span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">	    &#x27;</span>output_di<span class="hljs-string">r&#x27;: &#x27;</span>chemical_data<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">	    &#x27;</span>start_page<span class="hljs-string">&#x27;: 1,  </span><br><span class="hljs-string">	    &#x27;</span>end_page<span class="hljs-string">&#x27;: 201,  </span><br><span class="hljs-string">	    &#x27;</span>wait_time<span class="hljs-string">&#x27;: 3  </span><br><span class="hljs-string">	&#125;</span><br></code></pre></td></tr></table></figure>

<ol>
<li><p>â€œlogin_urlâ€, â€˜usernameâ€, â€œpasswordâ€ ä¸‰ä¸ªå­—æ®µåˆ†åˆ«ä¸ºç™»é™†ç•Œé¢çš„URLï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚</p>
</li>
<li><p>â€œbase_urlâ€, â€œstart_pageâ€, â€œend_pageâ€ ä¸‰ä¸ªå­—æ®µæ˜¯å¯¹è¦çˆ¬å–çš„ç½‘é¡µURLçš„æ‹†è§£ã€‚</p>
</li>
<li><p>â€œoutput_dirâ€ å­—æ®µç”¨äºæŒ‡æ˜çˆ¬å–å†…å®¹çš„å­˜å‚¨ä½ç½®</p>
</li>
<li><p>â€œwait_timeâ€ å­—æ®µç”¨äºæ§åˆ¶çˆ¬è™«çš„çˆ¬å–é¢‘ç‡</p>
</li>
</ol>
<p>è¿™é‡Œå¯¹å‰ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œä¸€äº›é¢å¤–çš„è¡¥å……ï¼š</p>
<ol>
<li><p>å¦‚æœè¦çˆ¬å–çš„ç½‘ç«™æ²¡æœ‰ç™»é™†è¦æ±‚ï¼Œå¯ä»¥çœå»è¿™ä¸ªæ­¥éª¤ï¼›</p>
</li>
<li><p>å¯¹äºè¿ç»­çš„å¤šä¸ªé¡µé¢ï¼Œç½‘ç«™URLé€šå¸¸ä¼šä»¥ â€˜<a href="https://example.com/?pageNum=1">https://example.com/?pageNum=1</a>â€˜ çš„å½¢å¼ç»„ç»‡ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡éå†æœ€åçš„æ•°å­—å¾—åˆ°æ‰€æœ‰éœ€è¦çˆ¬å–çš„ç½‘ç«™åœ°å€ã€‚</p>
</li>
<li><p>ä½†è‹¥ç½‘ç«™ä¸ä»¥è¿™ç§å½¢å¼æŒ‡å®šURLï¼Œæˆ–è€…ä½ éœ€è¦ç»§ç»­è®¿é—®å½“å‰é¡µé¢ä¸­æä¾›çš„URLï¼Œåˆ™å¯ä»¥åªä¿ç•™ â€œbase_urlâ€ å­—æ®µï¼Œé€šè¿‡ç‚¹å‡»äº‹ä»¶ï¼Œå¾—åˆ°ä¸‹ä¸€ä¸ªè¦çˆ¬å–çš„URLã€‚</p>
</li>
</ol>
<hr>
<p>æ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸ª ChemicalScraper ç±»æ§åˆ¶æ•´ä¸ªçˆ¬è™«ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver  <br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By  <br><span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service<br><span class="hljs-keyword">from</span> webdriver_manager.chrome <span class="hljs-keyword">import</span> ChromeDriverManager<br><span class="hljs-keyword">from</span> selenium.webdriver.support <span class="hljs-keyword">import</span> expected_conditions <span class="hljs-keyword">as</span> EC<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChemicalScraper</span>:  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-variable language_">self</span>.driver = <span class="hljs-variable language_">self</span>.init_driver()  <br>        <span class="hljs-variable language_">self</span>.wait = WebDriverWait(<span class="hljs-variable language_">self</span>.driver, <span class="hljs-number">30</span>)  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_driver</span>(<span class="hljs-params">self</span>):  <br>        service = Service(ChromeDriverManager().install())  <br>        options = webdriver.ChromeOptions()  <br>        options.add_argument(<span class="hljs-string">&#x27;--disable-gpu&#x27;</span>)  <br>        <span class="hljs-keyword">return</span> webdriver.Chrome(service=service, options=options)  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£åœ¨ç™»å½•...&quot;</span>)  <br>        <span class="hljs-variable language_">self</span>.driver.get(CONFIG[<span class="hljs-string">&#x27;login_url&#x27;</span>])  <br>        <span class="hljs-keyword">try</span>:  <br>            username = <span class="hljs-variable language_">self</span>.driver.find_element(<br>            By.CSS_SELECTOR, <span class="hljs-string">&#x27;input[type=&quot;text&quot;]&#x27;</span>)  <br>            password = <span class="hljs-variable language_">self</span>.driver.find_element(<br>            By.CSS_SELECTOR, <span class="hljs-string">&#x27;input[type=&quot;password&quot;]&#x27;</span>)  <br>            username.send_keys(CONFIG[<span class="hljs-string">&#x27;username&#x27;</span>])  <br>            password.send_keys(CONFIG[<span class="hljs-string">&#x27;password&#x27;</span>])  <br>            <span class="hljs-variable language_">self</span>.driver.find_element(By.CSS_SELECTOR, <span class="hljs-string">&#x27;button.btn&#x27;</span>).click()  <br>            <span class="hljs-variable language_">self</span>.wait.until(EC.url_contains(<span class="hljs-string">&#x27;pageNum&#x27;</span>))  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>)  <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç™»å½•å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>            <span class="hljs-variable language_">self</span>.save_screenshot(<span class="hljs-string">&#x27;login_error.png&#x27;</span>)  <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>

<p>åšä¸»åœ¨è¿™é‡Œæ¨¡æ‹Ÿäº†Chromeæµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨optionså¯¹æµè§ˆå™¨çš„ä¸€äº›è¡Œä¸ºè¿›è¡Œé…ç½®ï¼Œæœ€åæ‹¿åˆ°driverå¹¶é€šè¿‡å®ƒè¿›è¡Œåç»­çš„æ¨¡æ‹Ÿæ“ä½œã€‚</p>
<p>ç™»é™†å‡½æ•°çš„è¡Œä¸ºå¦‚ä¸‹ï¼Œé¦–å…ˆé€šè¿‡driver.get()æ–¹æ³•è¿›å…¥ç™»é™†é¡µåœ°å€ï¼Œç„¶åé€šè¿‡cssé€‰æ‹©å™¨æ‹¿åˆ°ç”¨æˆ·åå’Œå¯†ç çš„è¾“å…¥æ¡†ï¼Œå†å°†CONFIGä¸­è®¾ç½®å¥½çš„ç”¨æˆ·åä¸å¯†ç é€šè¿‡send_keys()æ–¹æ³•å¡«å…¥ï¼Œæœ€åç”¨cssé€‰æ‹©å™¨å¾—åˆ°ç™»é™†çš„ç‚¹å‡»æŒ‰é’®ï¼Œä½¿ç”¨click()ç‚¹å‡»å®Œæˆç™»é™†ã€‚</p>
<p>æœ€åéœ€è¦ä½¿ç”¨waitæœºåˆ¶å’Œexpected_conditionsï¼ˆä»¥ä¸‹ç®€ç§°ECï¼‰æ¥åˆ¤æ–­æ˜¯å¦ç™»é™†æˆåŠŸï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°urlä¸­åŒ…å«äº†ç™»é™†æˆåŠŸåè·³è½¬çš„é¡µé¢çš„å…ƒç´ ã€‚</p>
<hr>
<p>ä¸‡äº‹å…·å¤‡ï¼Œç»ˆäºå¯ä»¥è¿›è¡Œæ•°æ®çš„çˆ¬å–äº†ï¼Œä»¥ä¸‹å°±æ˜¯çˆ¬å–é€»è¾‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scrape_page</span>(<span class="hljs-params">self, page_num</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;çˆ¬å–å•ä¸ªé¡µé¢&quot;&quot;&quot;</span>  <br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;CONFIG[<span class="hljs-string">&#x27;base_url&#x27;</span>]&#125;</span>?pageNum=<span class="hljs-subst">&#123;page_num&#125;</span>&quot;</span>  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ­£åœ¨çˆ¬å–ç¬¬ <span class="hljs-subst">&#123;page_num&#125;</span> é¡µ...&quot;</span>)  <br>    <span class="hljs-variable language_">self</span>.driver.get(url)  <br>  <br>    <span class="hljs-keyword">try</span>:  <br>        <span class="hljs-variable language_">self</span>.wait.until(EC.presence_of_element_located(<br>        (By.CSS_SELECTOR, <span class="hljs-string">&#x27;.relative&#x27;</span>)))  <br>        time.sleep(<span class="hljs-number">2</span>)  <br>  <br>        elements = <span class="hljs-variable language_">self</span>.driver.find_elements(  <br>            By.CSS_SELECTOR, <br>            <span class="hljs-string">&#x27;.relative .whitespace-pre-wrap.overflow-hidden&#x27;</span>)  <br>        raw_items = [&#123;  <br>            <span class="hljs-string">&quot;page&quot;</span>: page_num,  <br>            <span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">f&quot;item_<span class="hljs-subst">&#123;idx + <span class="hljs-number">1</span>&#125;</span>&quot;</span>,  <br>            <span class="hljs-string">&quot;content&quot;</span>: elem.text.strip()  <br>        &#125; <span class="hljs-keyword">for</span> idx, elem <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(elements)]  <br>  <br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.process_page_data(raw_items)  <br>  <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;çˆ¬å–ç¬¬ <span class="hljs-subst">&#123;page_num&#125;</span> é¡µæ—¶å‡ºé”™: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>        <span class="hljs-variable language_">self</span>.save_screenshot(<span class="hljs-string">f&#x27;page_<span class="hljs-subst">&#123;page_num&#125;</span>_error.png&#x27;</span>)  <br>        <span class="hljs-keyword">return</span> []<br></code></pre></td></tr></table></figure>

<p>å…ˆå°†ä¼ å…¥çš„page_numä¸CONFIGé‡Œé…ç½®çš„base_urlæ‹¼æ¥å¾—åˆ°ç›®æ ‡é¡µé¢çš„åœ°å€ï¼Œå†ä½¿ç”¨get()æ–¹æ³•è¿›å…¥é¡µé¢ã€‚ç”±äºç½‘é¡µçš„å…ƒç´ æ˜¯åŠ¨æ€åŠ è½½çš„ï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„waitæœºåˆ¶ç­‰å¾…å…¶åŠ è½½å®Œæ¯•ï¼ŒåŒæ—¶ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘ä»¬åœ¨åŠ è½½å®Œæ¯•åä»¤çˆ¬è™«ä¼‘çœ 2ç§’ã€‚</p>
<p>é¢å¯¹åŠ è½½å®Œæˆçš„é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ƒç´ å®šä½ç­–ç•¥å®šä½éœ€è¦çˆ¬å–çš„å…ƒç´ å¹¶è¿›è¡Œçˆ¬å–äº†ã€‚è¿™é‡Œä½¿ç”¨äº†pipelineçš„æ€æƒ³ï¼Œå…ˆå°†æ•°æ®çˆ¬å–ä¸‹æ¥ï¼Œå†ä¼ å…¥process_page_data()å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†å¤„ç†åçš„æ•°æ®ä¿å­˜ä¸‹æ¥ã€‚è¿™æ ·ï¼Œé¢å¯¹ä¸åŒçš„çˆ¬å–éœ€æ±‚ï¼Œåªéœ€è¦åœ¨å¯¹åº”çš„æ¿å—ä¸­è¿›è¡Œä¿®æ”¹æ›¿æ¢ï¼Œè€Œä¸ç”¨æ‹…å¿ƒç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚</p>
<hr>
<p>åœ¨æ­£å¼è®²è§£æ•°æ®å¤„ç†æµç¨‹å‰ï¼Œå…ˆæ¥è¯´è¯´åšä¸»çš„ä¸€æ¬¡é”™è¯¯å®è·µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é”™è¯¯å®è·µ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_raw_data</span>(<span class="hljs-params">raw_items</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;å¤„ç†åŸå§‹æ•°æ®ï¼Œè½¬æ¢ä¸ºç»“æ„åŒ–æ ¼å¼&quot;&quot;&quot;</span>  <br>    structured_data = []  <br>  <br>    <span class="hljs-comment"># æ¯5ä¸ªæ¡ç›®ä¸ºä¸€ç»„ï¼ˆè·³è¿‡åºå·ï¼Œå–åé¢4ä¸ªï¼‰  </span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(raw_items), <span class="hljs-number">5</span>):  <br>        group = raw_items[i:i + <span class="hljs-number">5</span>]  <br>  <br>        <span class="hljs-comment"># ç¡®ä¿æœ‰å®Œæ•´çš„4ä¸ªæ•°æ®é¡¹ï¼ˆè·³è¿‡åºå·ï¼‰  </span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(group) &gt;= <span class="hljs-number">5</span>:  <span class="hljs-comment"># 1ä¸ªåºå· + 4ä¸ªæ•°æ®  </span><br>            <span class="hljs-keyword">try</span>:  <br>                <span class="hljs-comment"># è·³è¿‡åºå·ï¼ˆgroup[0]ï¼‰ï¼Œå–åé¢4ä¸ª  </span><br>                cas = group[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">if</span> group[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;N/A&quot;</span>  <br>                en_name = group[<span class="hljs-number">2</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">if</span> group[<span class="hljs-number">2</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;N/A&quot;</span>  <br>                cn_name = group[<span class="hljs-number">3</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">if</span> group[<span class="hljs-number">3</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;N/A&quot;</span>  <br>                un = group[<span class="hljs-number">4</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">if</span> group[<span class="hljs-number">4</span>][<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;N/A&quot;</span>  <br>  <br>                structured_data.append(&#123;  <br>                    <span class="hljs-string">&quot;cas&quot;</span>: cas,  <br>                    <span class="hljs-string">&quot;en_name&quot;</span>: en_name,  <br>                    <span class="hljs-string">&quot;cn_name&quot;</span>: cn_name,  <br>                    <span class="hljs-string">&quot;un&quot;</span>: un  <br>                &#125;)  <br>            <span class="hljs-keyword">except</span> IndexError:  <br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¸å®Œæ•´çš„æ•°æ®ç»„: <span class="hljs-subst">&#123;group&#125;</span>&quot;</span>)  <br>                <span class="hljs-keyword">continue</span>  <br>  <br>    <span class="hljs-keyword">return</span> structured_data<br></code></pre></td></tr></table></figure>
<p>è¿™æ®µæ•°æ®å¤„ç†çš„é€»è¾‘æ˜¯ï¼Œè™½ç„¶ç»è¿‡ç®€å•åŒ¹é…classå±æ€§çš„scrape_page()ä¼šä¼ å…¥ä¸€äº›æ— ç”¨çš„é¡µé¢å…ƒç´ ï¼Œä½†æˆ‘è¦çˆ¬å–çš„æ˜¯ç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯æ¡æ•°æ®ä¸­éƒ½åº”è¯¥åŒ…å«[æ¡ç›®å·ï¼Œcasç¼–å·ï¼Œè‹±æ–‡ç‰©è´¨åï¼Œä¸­æ–‡ç‰©è´¨åï¼Œunç¼–å·]ã€‚å› æ­¤æˆ‘åªéœ€è¦åˆ¤æ–­éå†çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å«ä»¥ä¸Š5ä¸ªæ•°æ®é¡¹ï¼Œå¹¶å»æ‰æ¡ç›®å·ï¼Œå°†å‰©ä¸‹çš„æ•°æ®å­˜å‚¨ä¸‹æ¥ï¼Œäº¤ç”±å­˜å‚¨å‡½æ•°è¿›è¡Œå­˜å‚¨ã€‚</p>
<p>ä½†è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè‡´å‘½çš„æ¼æ´ï¼Œå­˜åœ¨æ²¡æœ‰casç¼–å·æˆ–unç¼–å·çš„ç‰©è´¨ï¼Œä¸Šé¢çš„é€»è¾‘ä¼šå¯¼è‡´æ¼æ£€å’Œkey-valueé”™é…ã€‚åœ¨æ£€æŸ¥çˆ¬å–çš„æ•°æ®åï¼Œåšä¸»æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å¯¹å‡½æ•°è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¾—åˆ°äº†ä¸‹é¢çš„v2ç‰ˆæœ¬å¹¶å®Œæˆäº†æ­¤æ¬¡çˆ¬è™«çš„æ•°æ®å¤„ç†ä»»åŠ¡ã€‚</p>
<hr>
<p>ä¸‹é¢ä»‹ç»åšä¸»çš„ç¬¬äºŒç‰ˆé¡µé¢æ•°æ®å¤„ç†æµç¨‹ï¼Œå¤§å®¶å¯ä»¥ç”¨ä½œå‚è€ƒ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-meta">@staticmethod  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">identify_field</span>(<span class="hljs-params">content</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;æ™ºèƒ½è¯†åˆ«å­—æ®µç±»å‹&quot;&quot;&quot;</span>  <br>    content = <span class="hljs-built_in">str</span>(content).strip()  <br>  <br>    <span class="hljs-comment"># è¯†åˆ«UNå·ï¼ˆ4ä½æ•°å­—ï¼‰  </span><br>    <span class="hljs-keyword">if</span> re.fullmatch(<span class="hljs-string">r&#x27;^\d&#123;4&#125;$&#x27;</span>, content):  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;un&#x27;</span>  <br>  <br>    <span class="hljs-comment"># è¯†åˆ«CASå·ï¼ˆæ ‡å‡†æ ¼å¼ï¼šNNNNN-NN-Nï¼‰  </span><br>    <span class="hljs-keyword">if</span> re.fullmatch(<span class="hljs-string">r&#x27;^\d&#123;1,7&#125;-\d&#123;2&#125;-\d$&#x27;</span>, content):  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;cas&#x27;</span>  <br>  <br>    <span class="hljs-comment"># è¯†åˆ«ä¸­æ–‡ï¼ˆåŒ…å«ä¸­æ–‡å­—ç¬¦ï¼‰  </span><br>    <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r&#x27;[\u4e00-\u9fff]&#x27;</span>, content):  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;cn_name&#x27;</span>  <br>  <br>    <span class="hljs-comment"># è¯†åˆ«è‹±æ–‡ï¼ˆæ’é™¤çº¯æ•°å­—ï¼‰  </span><br>    <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&#x27;^[a-zA-Z].*&#x27;</span>, content):  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;en_name&#x27;</span>  <br>  <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <br>  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_page_data</span>(<span class="hljs-params">self, raw_items</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;å¤„ç†é¡µé¢æ•°æ®v2&quot;&quot;&quot;</span>  <br>    structured_data = []  <br>    i = <span class="hljs-number">0</span>  <br>  <br>    <span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(raw_items):  <br>        <span class="hljs-comment"># è·³è¿‡åºå·é¡¹  </span><br>        <span class="hljs-keyword">if</span> raw_items[i][<span class="hljs-string">&#x27;content&#x27;</span>].strip().isdigit():  <br>            i += <span class="hljs-number">1</span>  <br>            <span class="hljs-keyword">continue</span>  <br>  <br>        record = &#123;<span class="hljs-string">&quot;cas&quot;</span>: <span class="hljs-string">&quot;NA&quot;</span>, <span class="hljs-string">&quot;en_name&quot;</span>: <span class="hljs-string">&quot;NA&quot;</span>, <span class="hljs-string">&quot;cn_name&quot;</span>: <span class="hljs-string">&quot;NA&quot;</span>, <span class="hljs-string">&quot;un&quot;</span>: <span class="hljs-string">&quot;NA&quot;</span>&#125;  <br>        used_indices = <span class="hljs-built_in">set</span>()  <br>  <br>        <span class="hljs-comment"># ç¬¬ä¸€è½®ï¼šç²¾ç¡®åŒ¹é…  </span><br>        <span class="hljs-keyword">for</span> offset <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">min</span>(<span class="hljs-number">4</span>, <span class="hljs-built_in">len</span>(raw_items) - i)):  <br>            <span class="hljs-keyword">if</span> i + offset <span class="hljs-keyword">in</span> used_indices:  <br>                <span class="hljs-keyword">continue</span>  <br>  <br>            content = raw_items[i + offset][<span class="hljs-string">&#x27;content&#x27;</span>].strip()  <br>            field_type = <span class="hljs-variable language_">self</span>.identify_field(content)  <br>  <br>            <span class="hljs-keyword">if</span> field_type <span class="hljs-keyword">and</span> record[field_type] == <span class="hljs-string">&quot;NA&quot;</span>:  <br>                record[field_type] = content  <br>                used_indices.add(i + offset)  <br>  <br>        <span class="hljs-comment"># ç¬¬äºŒè½®ï¼šå¤„ç†å‰©ä½™æœªè¯†åˆ«å†…å®¹  </span><br>        remaining = [j <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, <span class="hljs-built_in">min</span>(i + <span class="hljs-number">4</span>, <span class="hljs-built_in">len</span>(raw_items))) <br>        <span class="hljs-keyword">if</span> j <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> used_indices]  <br>        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> remaining:  <br>            content = raw_items[idx][<span class="hljs-string">&#x27;content&#x27;</span>].strip()  <br>  <br>            <span class="hljs-comment"># æŒ‰ä¼˜å…ˆçº§å°è¯•å¡«å……ç©ºç¼ºå­—æ®µ  </span><br>            <span class="hljs-keyword">if</span> record[<span class="hljs-string">&#x27;cas&#x27;</span>] == <span class="hljs-string">&quot;NA&quot;</span> <span class="hljs-keyword">and</span> (<span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-keyword">in</span> content <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(content) &gt; <span class="hljs-number">6</span>):  <br>                record[<span class="hljs-string">&#x27;cas&#x27;</span>] = content  <br>            <span class="hljs-keyword">elif</span> record[<span class="hljs-string">&#x27;un&#x27;</span>] == <span class="hljs-string">&quot;NA&quot;</span> <span class="hljs-keyword">and</span> content.isdigit():  <br>                record[<span class="hljs-string">&#x27;un&#x27;</span>] = content  <br>            <span class="hljs-keyword">elif</span> record[<span class="hljs-string">&#x27;cn_name&#x27;</span>] == <span class="hljs-string">&quot;NA&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> re.<span class="hljs-keyword">match</span>(<br>            <span class="hljs-string">r&#x27;^[a-zA-Z0-9\s\-\.]+$&#x27;</span>, content):  <br>                record[<span class="hljs-string">&#x27;cn_name&#x27;</span>] = content  <br>            <span class="hljs-keyword">elif</span> record[<span class="hljs-string">&#x27;en_name&#x27;</span>] == <span class="hljs-string">&quot;NA&quot;</span>:  <br>                record[<span class="hljs-string">&#x27;en_name&#x27;</span>] = content  <br>  <br>        <span class="hljs-comment"># éªŒè¯è‡³å°‘æœ‰ä¸¤ä¸ªæœ‰æ•ˆå­—æ®µ  </span><br>        valid_fields = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> record.values() <span class="hljs-keyword">if</span> v != <span class="hljs-string">&quot;NA&quot;</span>)  <br>        <span class="hljs-keyword">if</span> valid_fields &gt;= <span class="hljs-number">2</span>:  <br>            structured_data.append(record)  <br>            i += <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(used_indices))  <span class="hljs-comment"># è‡³å°‘å‰è¿›1æ­¥  </span><br>        <span class="hljs-keyword">else</span>:  <br>            i += <span class="hljs-number">1</span>  <br>  <br>    <span class="hljs-keyword">return</span> structured_data<br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªidentify_field()å‡½æ•°ï¼Œç”¨äºè¯†åˆ«å¤„ç†æ•°æ®é¡¹çš„å­—æ®µç±»å‹ã€‚</p>
<p>ç„¶åæ˜¯æ•°æ®å¤„ç†å‡½æ•°process_page_data()ï¼Œè¿™é‡Œé€‰æ‹©å…ˆå£°æ˜ä¸€ä¸ªç©ºçš„recordè€Œä¸æ˜¯åœ¨å¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¸­å¾€structured_dataé‡Œæ·»åŠ è®°å½•ï¼Œæ˜¯ä¸ºäº†åœ¨ä¹‹åçš„ä¸¤é˜¶æ®µåŒ¹é…ä¸­å¯ä»¥æ ¹æ®keyå€¼åŒ¹é…æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å‰æ¬¡å¤„ç†çš„æ®‹ç•™æ•°æ®å½±å“å½“å‰è®°å½•ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªåŒé˜¶æ®µçš„å¤„ç†ï¼Œå…ˆè¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œå°†å‡†ç¡®è¯†åˆ«åˆ°çš„å†…å®¹å¡«å…¥recordä¸­ï¼Œè€Œåå¯¹å‰©ä½™çš„æœªåŒ¹é…å†…å®¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰è¿›è¡Œå¯å‘å¼åŒ¹é…ã€‚</p>
<p>æœ€åå¯¹recordä¸­çš„å­—æ®µè¿›è¡Œæ ¡éªŒï¼Œè¿™æ˜¯åŸºäºä»¥ä¸‹é€»è¾‘ï¼šå³ä½¿å­˜åœ¨ä¸€ä¸ªåŒ–å­¦å“æ—¢æ²¡æœ‰caså·ï¼Œä¹Ÿæ²¡æœ‰unå·ï¼Œä½†å…¶è‡³å°‘æœ‰ä¸­è‹±æ–‡åç§°ã€‚</p>
<hr>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å°†å¤„ç†å¥½çš„æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œè¿™é‡Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œç›´æ¥ä½¿ç”¨jsonå­˜å‚¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_data</span>(<span class="hljs-params">self, data, filename=<span class="hljs-string">&#x27;chemicals.json&#x27;</span></span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;ä¿å­˜æ•°æ®&quot;&quot;&quot;</span>  <br>    os.makedirs(CONFIG[<span class="hljs-string">&#x27;output_dir&#x27;</span>], exist_ok=<span class="hljs-literal">True</span>)  <br>    filepath = os.path.join(CONFIG[<span class="hljs-string">&#x27;output_dir&#x27;</span>], filename)  <br>  <br>    <span class="hljs-keyword">try</span>:  <br>        existing_data = []  <br>        <span class="hljs-keyword">if</span> os.path.exists(filepath):  <br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:  <br>                existing_data = json.load(f)  <br>  <br>        combined_data = existing_data + data  <br>  <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:  <br>            json.dump(combined_data, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)  <br>  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å·²ä¿å­˜ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span> æ¡è®°å½•åˆ° <span class="hljs-subst">&#123;filepath&#125;</span> (æ€»è®¡ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(combined_data)&#125;</span> æ¡)&quot;</span>)  <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¿å­˜æ•°æ®æ—¶å‡ºé”™: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<hr>
<p>æœ€åï¼Œå®šä¹‰ä¸€ä¸ªrunå‡½æ•°è°ƒç”¨ä¸Šé¢çš„æ¨¡å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;è¿è¡Œçˆ¬è™«&quot;&quot;&quot;</span>  <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.login():  <br>        <span class="hljs-keyword">return</span>  <br>  <br>    all_data = []  <br>    <span class="hljs-keyword">try</span>:  <br>        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(CONFIG[<span class="hljs-string">&#x27;start_page&#x27;</span>], CONFIG[<span class="hljs-string">&#x27;end_page&#x27;</span>]+<span class="hljs-number">1</span>):  <br>            <span class="hljs-keyword">try</span>:  <br>                page_data = <span class="hljs-variable language_">self</span>.scrape_page(page)  <br>                <span class="hljs-keyword">if</span> page_data:  <br>                    all_data.extend(page_data)  <br>                    <span class="hljs-variable language_">self</span>.save_data(page_data)  <br>  <br>                time.sleep(CONFIG[<span class="hljs-string">&#x27;wait_time&#x27;</span>])  <br>  <br>            <span class="hljs-keyword">except</span> KeyboardInterrupt:  <br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nç”¨æˆ·ä¸­æ–­ï¼Œæ­£åœ¨ä¿å­˜æ•°æ®...&quot;</span>)  <br>                <span class="hljs-keyword">break</span>  <br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¤„ç†ç¬¬ <span class="hljs-subst">&#123;page&#125;</span> é¡µæ—¶å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>                <span class="hljs-keyword">continue</span>  <br>  <br>    <span class="hljs-keyword">finally</span>:  <br>        <span class="hljs-variable language_">self</span>.save_data(all_data, <span class="hljs-string">&quot;final_chemicals.json&quot;</span>)  <br>        <span class="hljs-variable language_">self</span>.driver.quit()  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¬å–å®Œæˆ&quot;</span>)<br></code></pre></td></tr></table></figure>

<hr>
<p>å¯¹äº†ï¼Œåˆ«å¿˜äº†å†™ä¸Šmainå‡½æ•°è®©çˆ¬è™«è·‘èµ·æ¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:  <br>    scraper = ChemicalScraper()  <br>    scraper.run()<br></code></pre></td></tr></table></figure>

<h2><span id="si-pa-chong-kai-fa-de-xin-lu-li-cheng-yu-jing-yan-zong-jie">å››ã€çˆ¬è™«å¼€å‘çš„å¿ƒè·¯å†ç¨‹ä¸ç»éªŒæ€»ç»“</span></h2><p>å›é¡¾æˆ‘çš„çˆ¬è™«å¼€å‘å†ç¨‹ï¼Œå¯ä»¥è¯´æ˜¯ä¸€æ®µä¸æ–­çªç ´æŠ€æœ¯ç“¶é¢ˆçš„æˆé•¿ä¹‹æ—…ã€‚æœ€åˆæˆ‘é€‰æ‹©ä½¿ç”¨Golangç›´æ¥å‘èµ·HTTPè¯·æ±‚è¿›è¡Œé¡µé¢è§£æï¼Œè¿™ç§æ–¹æ¡ˆè™½ç„¶æ€§èƒ½ä¼˜å¼‚ï¼Œä½†åœ¨é¢å¯¹ç°ä»£ç½‘ç«™å¤æ‚çš„åçˆ¬æœºåˆ¶æ—¶å´æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚å³ä½¿æˆ‘å»ºç«‹äº†å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œé¢å¯¹åŠ¨æ€æ¸²æŸ“ã€è¡Œä¸ºéªŒè¯ç­‰é«˜çº§åçˆ¬æ‰‹æ®µæ—¶ï¼Œä»ç„¶éš¾ä»¥ç²¾å‡†å®šä½é—®é¢˜æ ¹æºã€‚</p>
<p>éšåæˆ‘è½¬å‘äº†Scrapyæ¡†æ¶ï¼Œè¿™ä¸ªé€‰æ‹©ç¡®å®è§£å†³äº†ä¸å°‘åŸºç¡€é—®é¢˜ã€‚Scrapyçš„å¼ºå¤§ä¸­é—´ä»¶ç³»ç»Ÿå’Œå†…ç½®çš„Shellè°ƒè¯•å·¥å…·ç¡®å®æé«˜äº†å¼€å‘æ•ˆç‡ã€‚ä½†ä¸å¾—ä¸æ‰¿è®¤ï¼Œåœ¨å¯è§†åŒ–è°ƒè¯•å’ŒåŠ¨æ€äº¤äº’æ–¹é¢ï¼ŒScrapyçš„å·¥ä½œæµå§‹ç»ˆæ— æ³•æ»¡è¶³æˆ‘å¯¹å¼€å‘ä½“éªŒçš„è¿½æ±‚â€”â€”ç‰¹åˆ«æ˜¯åœ¨å¤„ç†JavaScripté‡åº¦ä¾èµ–çš„é¡µé¢æ—¶ï¼Œè°ƒè¯•è¿‡ç¨‹å¾€å¾€å˜å¾—å¼‚å¸¸ç¹çã€‚</p>
<p>æœ€ç»ˆé€‰æ‹©Seleniumå¯è°“æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ã€‚è¿™ä¸ªå†³å®šä¸ä»…è§£å†³äº†å‰ä¸¤ç§æ–¹æ¡ˆçš„æ ¸å¿ƒç—›ç‚¹ï¼Œè¿˜å¸¦æ¥äº†æ„æƒ³ä¸åˆ°çš„æ”¶è·ï¼š</p>
<ol>
<li><p><strong>æ‰€è§å³æ‰€å¾—çš„è°ƒè¯•ä½“éªŒ</strong>ï¼šå¯ä»¥ç›´è§‚åœ°è§‚å¯Ÿæ¯ä¸ªæ“ä½œæ­¥éª¤çš„é¡µé¢å˜åŒ–</p>
</li>
<li><p><strong>çœŸå®ç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿ</strong>ï¼šæœ‰æ•ˆç»•è¿‡å¤§å¤šæ•°åŸºäºè¡Œä¸ºåˆ†æçš„é˜²å¾¡æœºåˆ¶</p>
</li>
<li><p><strong>çµæ´»çš„å¼‚å¸¸å¤„ç†</strong>ï¼šç»“åˆæˆªå›¾åŠŸèƒ½å®ç°ç²¾å‡†çš„é—®é¢˜å®šä½</p>
</li>
</ol>
<p>ä½†Seleniumçš„é‡‡ç”¨ä¹Ÿå¹¶éä¸€å¸†é£é¡ºã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»ç„¶éœ€è¦è§£å†³ç½‘ç«™è®¾ç½®çš„å¤šé‡éšœç¢ï¼š</p>
<ul>
<li><p>åŠ¨æ€åŠ è½½å…ƒç´ çš„ç²¾å‡†ç­‰å¾…ç­–ç•¥</p>
</li>
<li><p>æµ®åŠ¨å¹¿å‘Šå±‚å¯¹ç›®æ ‡å…ƒç´ çš„é®æŒ¡é—®é¢˜</p>
</li>
<li><p>æ»‘å—éªŒè¯ç çš„è¯†åˆ«æ–¹æ¡ˆ</p>
</li>
</ul>
<p>è¿™äº›æŒ‘æˆ˜çš„è§£å†³è¿‡ç¨‹ï¼Œè®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°çˆ¬è™«å¼€å‘ä¸ä»…éœ€è¦æŠ€æœ¯å®åŠ›ï¼Œæ›´éœ€è¦è§£å†³é—®é¢˜çš„è€å¿ƒå’Œåˆ›é€ åŠ›ã€‚æ¯ä¸ªç½‘ç«™éƒ½æœ‰å…¶ç‹¬ç‰¹çš„â€æ€§æ ¼â€ï¼Œåªæœ‰çœŸæ­£ç†è§£å®ƒçš„è¡Œä¸ºæ¨¡å¼ï¼Œæ‰èƒ½è®¾è®¡å‡ºæœ€åˆé€‚çš„çˆ¬å–æ–¹æ¡ˆã€‚</p>
<p><strong>ç»™å¼€å‘è€…çš„å»ºè®®</strong>ï¼š</p>
<ol>
<li><p>ä¸è¦æ‰§ç€äºå•ä¸€æŠ€æœ¯æ–¹æ¡ˆï¼Œæ ¹æ®ç›®æ ‡ç½‘ç«™ç‰¹æ€§çµæ´»é€‰æ‹©å·¥å…·ç»„åˆ</p>
</li>
<li><p>å»ºç«‹å®Œå–„çš„è°ƒè¯•ä½“ç³»ï¼ˆæ—¥å¿—+æˆªå›¾+æ–­ç‚¹ç»­çˆ¬ï¼‰</p>
</li>
<li><p>ä¿æŒå¯¹åçˆ¬æœºåˆ¶çš„æŒç»­å­¦ä¹ ï¼ŒåŠæ—¶æ›´æ–°æŠ€æœ¯å‚¨å¤‡</p>
</li>
<li><p>å§‹ç»ˆéµå®ˆç½‘ç»œé“å¾·è§„èŒƒï¼Œåˆç†æ§åˆ¶çˆ¬å–é¢‘ç‡</p>
</li>
</ol>
<p>çˆ¬è™«å¼€å‘å°±åƒä¸€åœºæ°¸æ— æ­¢å¢ƒçš„æŠ€æœ¯æ¢é™©ï¼Œæ¯ä¸€æ¬¡çªç ´ç“¶é¢ˆéƒ½æ„å‘³ç€èƒ½åŠ›çš„æå‡ã€‚å¸Œæœ›æˆ‘çš„ç»éªŒåˆ†äº«èƒ½ä¸ºåŒè¡Œè€…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸€èµ·æ¢è®¨æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
  </entry>
  <entry>
    <title>å‰è¨€ï¼šæˆ‘ä¸6.S081çš„ä¸¤æ¬¡ç›¸é‡</title>
    <url>/2025/07/28/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MIT%206.s081%E4%BF%AE%E7%82%BC%E7%AC%94%E8%AE%B0/2025-07-28-%E5%89%8D%E8%A8%80%EF%BC%9A%E6%88%91%E4%B8%8E6.S081%E7%9A%84%E4%B8%A4%E6%AC%A1%E7%9B%B8%E9%81%87/</url>
    <content><![CDATA[<h2><span id="chu-shi-yi-chang-chong-man-yi-wai-de-xie-hou">åˆè¯†ï¼šä¸€åœºå……æ»¡æ„å¤–çš„é‚‚é€…</span></h2><p>2023å¹´çš„å¤å¤©ï¼Œè€ƒç ”å¤±åˆ©çš„æˆ‘å†³å®šé‡æ–°å¤¯å®è®¡ç®—æœºåŸºç¡€ã€‚åœ¨æœç´¢â€æœ€å¥½çš„æ“ä½œç³»ç»Ÿè¯¾ç¨‹â€æ—¶ï¼ŒMIT 6.S081è¿™ä¸ªâ€ç½‘çº¢è¯¾â€æ¯«æ— æ‚¬å¿µåœ°å‡ºç°åœ¨æ‰€æœ‰æ¨èåˆ—è¡¨ä¸­ã€‚ä½†é‚£æ—¶çš„æˆ‘è¿˜åœç•™åœ¨â€ä¸‰æ— â€çŠ¶æ€ï¼š</p>
<ul>
<li><p>æ— ç§‘å­¦ä¸Šç½‘èƒ½åŠ›</p>
</li>
<li><p>æ— Gitå®è·µç»éªŒ</p>
</li>
<li><p>æ— GitHubä½¿ç”¨è®¤çŸ¥</p>
</li>
</ul>
<p>å¹¸è¿çš„æ˜¯è¯¾ç¨‹å®˜ç½‘å¯ä»¥ç›´æ¥è®¿é—®ï¼Œè®©æˆ‘å¾—ä»¥ç»•è¿‡ç¬¬ä¸€é“é—¨æ§›ã€‚æŒ‰ç…§æŒ‡å—ï¼Œæˆ‘åœ¨VMwareä¸Šå®‰è£…äº†Ubuntuï¼Œå¼€å§‹äº†ç¬¬ä¸€æ¬¡æ“ä½œç³»ç»Ÿæ¢ç´¢ä¹‹æ—…ã€‚</p>
<h2><span id="ji-zhu-li-xian-ji">æŠ€æœ¯å†é™©è®°</span></h2><h3><span id="wang-luo-kun-jing-yu-po-ju">ç½‘ç»œå›°å¢ƒä¸ç ´å±€</span></h3><p>è¯¾ç¨‹æ‰€éœ€çš„å·¥å…·é“¾ä¸‹è½½æˆäº†ç¬¬ä¸€ä¸ªæ‹¦è·¯è™ã€‚æ„Ÿè°¢å›½å†…æŠ€æœ¯ç¤¾åŒºçš„åˆ†äº«ç²¾ç¥ï¼ŒGiteeä¸Šçš„é•œåƒä»“åº“è®©æˆ‘è·³è¿‡äº†è¿™ä¸ªéšœç¢ã€‚</p>
<h3><span id="kai-fa-huan-jing-you-hua">å¼€å‘ç¯å¢ƒä¼˜åŒ–</span></h3><p>åŸç”Ÿvimç³Ÿç³•çš„æ“ä½œæ•ˆç‡è®©æˆ‘å¾ˆå¿«è½¬å‘äº†VSCodeè¿œç¨‹å¼€å‘æ–¹æ¡ˆã€‚é€šè¿‡é…ç½®Remote-SSHæ’ä»¶ï¼Œç»ˆäºå»ºç«‹äº†èˆ’é€‚çš„å­¦ä¹ ç¯å¢ƒã€‚</p>
<h3><span id="xue-xi-qu-xian-tu-po">å­¦ä¹ æ›²çº¿çªç ´</span></h3><p>ä½œä¸ºç³»ç»Ÿè°ƒç”¨é¢†åŸŸçš„æ–°æ‰‹ï¼Œå‰å‡ ä¸ªå®éªŒçš„éš¾åº¦æ›²çº¿ä»¤äººå´æ­¥ã€‚æˆ‘çš„ç ´å±€æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ol>
<li><p>ç²¾è¯»è¯¾ç¨‹è®²ä¹‰ï¼ˆé‡ç‚¹æ ‡æ³¨ç³»ç»Ÿè°ƒç”¨æœºåˆ¶ï¼‰</p>
</li>
<li><p>äº¤å‰å‚è€ƒã€ŠCä¸“å®¶ç¼–ç¨‹ã€‹ç†è§£å¤æ‚å£°æ˜</p>
</li>
<li><p>é€šè¿‡ã€ŠCå’ŒæŒ‡é’ˆã€‹æŒæ¡åº•å±‚å†…å­˜æ“ä½œ</p>
</li>
<li><p>é€šè¿‡é¢˜è§£ç†è§£é¢˜ç›®èƒŒåçš„åŸç†</p>
</li>
</ol>
<h2><span id="hei-tian-e-shi-jian">é»‘å¤©é¹…äº‹ä»¶</span></h2><p>é‚£ä¸ªçœ‹ä¼¼å¹³å¸¸çš„ä¸‹åˆï¼Œå¼€å‘ç¯å¢ƒçªç„¶å´©æºƒçš„è¿é”ååº”ï¼š</p>
<ol>
<li>VSCode SSHè¿æ¥å¼‚å¸¸ â†’ 2. VMwareè™šæ‹Ÿæœºå¯åŠ¨å¤±è´¥ â†’ 3. ä¸‰æ¬¡é‡å¯å°è¯•æ— æœ â†’ 4. å®éªŒç¯å¢ƒå®Œå…¨ä¸¢å¤±</li>
</ol>
<p>è¿™æ¬¡äº‹æ•…æœ€ç»ˆä¿ƒä½¿æˆ‘è½¬å‘äº†å—å¤§jyyçš„æ“ä½œç³»ç»Ÿè¯¾ç¨‹ï¼Œä½†ä¹ŸåŸ‹ä¸‹äº†é‡å­¦çš„ç§å­ã€‚</p>
<h2><span id="zai-chu-fa-quan-xin-de-zheng-cheng">å†å‡ºå‘ï¼šå…¨æ–°çš„å¾ç¨‹</span></h2><p>2025å¹´æš‘å‡ï¼Œå¸¦ç€è¿™äº›å‡çº§è£…å¤‡é‡æ–°å¯ç¨‹ï¼š</p>
<ul>
<li><p>ğŸ› ï¸ å®Œå–„çš„å¼€å‘å·¥å…·é“¾ï¼ˆç§‘å­¦ä¸Šç½‘ä»¥åŠmac oså¼€å‘ç¯å¢ƒï¼‰</p>
</li>
<li><p>ğŸ§  æ›´å®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼ˆåŒ…æ‹¬ç¼–è¯‘åŸç†å’Œè®¡ç®—æœºä½“ç³»ç»“æ„ï¼‰</p>
</li>
<li><p>ğŸ“ é«˜æ•ˆçš„è¾“å‡ºç³»ç»Ÿï¼ˆHexoåšå®¢+ObsidiançŸ¥è¯†åº“ï¼‰</p>
</li>
</ul>
<p>è¿™æ¬¡å­¦ä¹ æˆ‘å°†é‡ç‚¹å…³æ³¨ï¼š</p>
<ol>
<li><p>å®éªŒç¯å¢ƒçš„ç¾å¤‡æ–¹æ¡ˆ</p>
</li>
<li><p>å…³é”®çŸ¥è¯†ç‚¹çš„å¯è§†åŒ–è®°å½•</p>
</li>
<li><p>é—®é¢˜è§£å†³è¿‡ç¨‹çš„å®Œæ•´å½’æ¡£</p>
</li>
</ol>
<blockquote>
<p>â€œThe only real failure is the failure to learn from failure.â€ â€” Alan Kay</p>
</blockquote>
<p>æ¬¢è¿å„ä½åŒè¡Œè€…é€šè¿‡Issuesæˆ–é‚®ä»¶äº¤æµå­¦ä¹ å¿ƒå¾—ï¼Œè®©æˆ‘ä»¬åœ¨ç³»ç»Ÿç¼–ç¨‹çš„æ·±æµ·ä¸­å…±åŒæ¢ç´¢ã€‚</p>
<p>psï¼šåšä¸»å¯èƒ½æš‚æ—¶è·³è½¦15445äº†</p>
]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
        <category>MIT 6.s081ä¿®ç‚¼ç¬”è®°</category>
      </categories>
  </entry>
  <entry>
    <title>çŸ¥è¯†å›¾è°±é‡è§å¤šæ¨¡æ€å­¦ä¹ ï¼šä¸€é¡¹å…¨é¢è°ƒæŸ¥</title>
    <url>/2025/07/29/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/2025-07-29-%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E9%81%87%E8%A7%81%E5%A4%9A%E6%A8%A1%E6%80%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E4%B8%80%E9%A1%B9%E5%85%A8%E9%9D%A2%E8%B0%83%E6%9F%A5/</url>
    <content><![CDATA[<h1><span id="zhi-shi-tu-pu-yu-jian-duo-mo-tai-xue-xi-yi-xiang-quan-mian-diao-cha">çŸ¥è¯†å›¾è°±é‡è§å¤šæ¨¡æ€å­¦ä¹ ï¼šä¸€é¡¹å…¨é¢è°ƒæŸ¥</span></h1><p>æ ¹æ®æ‘˜è¦ï¼Œæœ¬ç¯‡ç»¼è¿°ä¸»è¦èšç„¦ä¸¤ä¸ªæ–¹é¢ï¼šçŸ¥è¯†å›¾è°±é©±åŠ¨å¤šæ¨¡æ€å­¦ä¹ ä»¥åŠå¤šæ¨¡æ€çŸ¥è¯†å›¾è°±æœ¬èº«ã€‚æ–‡ç« å¯¹çŸ¥è¯†å›¾è°±å’Œå¤šæ¨¡æ€çŸ¥è¯†å›¾è°±ç»™å‡ºäº†å®šä¹‰ä»¥åŠç›¸åº”çš„æ„å»ºæ–¹æ³•ã€‚æ–‡ç« å…³æ³¨äºä¸¤ä¸ªä¸»è¦çš„ä»»åŠ¡ç±»åˆ«ï¼šçŸ¥è¯†å›¾è°±é©±åŠ¨çš„å¤šæ¨¡æ€å­¦ä¹ ä»»åŠ¡ï¼Œå¦‚å›¾åƒåˆ†ç±»å’Œè§†è§‰é—®ç­”ï¼›ä»¥åŠå¤šæ¨¡æ€çŸ¥è¯†å›¾è°±æœ¬èº«çš„ä»»åŠ¡ï¼Œå¦‚å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±è¡¥å…¨å’Œå®ä½“å¯¹é½ã€‚å¯¹äºè¿™äº›ä»»åŠ¡ï¼Œæ–‡ç« ä¸­ä¼šç»™å‡ºå®šä¹‰ã€è¯„ä¼°çš„åŸºå‡†æµ‹è¯•å’Œä¸€äº›é¢å¤–çš„è§è§£ã€‚æœ€åï¼Œæ–‡ç« ä¼šè®¨è®ºå½“å‰çš„æŒ‘æˆ˜å’Œæ–°å…´çš„è¶‹åŠ¿ã€‚</p>
<h3><span id="jing-dian-zhi-shi-tu-pu-de-gou-jian">ç»å…¸çŸ¥è¯†å›¾è°±çš„æ„å»º</span></h3><p>è¿™é‡Œå°†ç»å…¸çŸ¥è¯†å›¾è°±åˆ†ä¸ºä¸¤ç±»ï¼šåŸºäºå®ä½“çš„çŸ¥è¯†å›¾è°±ä¸å¯Œæ–‡æœ¬çš„çŸ¥è¯†å›¾è°±</p>
<h4><span id="1-ji-yu-shi-ti-de-zhi-shi-tu-pu">1ï¼‰åŸºäºå®ä½“çš„çŸ¥è¯†å›¾è°±ï¼š</span></h4><p>åœ¨æ„å»ºè¿™ç§çŸ¥è¯†å›¾è°±æ—¶ï¼Œæœ¬ä½“å’Œæ•°æ®éƒ½éµå¾ªä¸¥æ ¼çš„æ ‡å‡†ã€‚å›¾è°±ä¸­çš„èŠ‚ç‚¹é€šå¸¸ä¸ç°å®ä¸–ç•Œä¸­çš„å®ä½“ä¸€ä¸€å¯¹åº”ã€‚å®ƒä»¬é€šå¸¸åŸºäºæ‰‹åŠ¨å®šä¹‰çš„æœ¬ä½“æ„å»ºï¼Œæä¾›äº†æ¸…æ™°çš„è¯­ä¹‰ï¼Œå®ä½“ç±»å‹å’Œå…³ç³»ä¹‹é—´çš„æ­§ä¹‰å’Œé‡å æœ€å°ã€‚æ„å»ºè¿™äº›å›¾è°±é€šå¸¸æ¶‰åŠä»ç»“æ„åŒ–æ•°æ®æºï¼ˆå¦‚å…³ç³»æ•°æ®åº“ï¼‰å¤„ç†å®ä½“å’Œå…³ç³»ã€‚è€Œä»å„ç§ç»“æ„åŒ–æ•°æ®æºæ•´åˆçŸ¥è¯†éœ€è¦è§£å†³ä¸‰ç§å¼‚æ„æ€§ï¼š</p>
<ul>
<li>æ¨¡å¼å¼‚æ„æ€§ï¼šä¸åŒçš„æ•°æ®æºå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼è¡¨ç¤ºç›¸åŒçš„å®ä½“ç±»å‹å’Œå…³ç³»</li>
<li>å®ä½“å¼‚æ„æ€§ï¼šä¸åŒçš„æºåç§°å¯èƒ½æè¿°ç›¸åŒçš„ç°å®ä¸–ç•Œå®ä½“</li>
<li>å€¼å¼‚æ„æ€§ï¼šä¸åŒçš„æºå¯èƒ½ä¸ºç›¸åŒçš„å®ä½“æä¾›ä¸åŒçš„æˆ–è¿‡æ—¶çš„å±æ€§å€¼</li>
</ul>
<h4><span id="2-fu-wen-ben-de-zhi-shi-tu-pu">2ï¼‰å¯Œæ–‡æœ¬çš„çŸ¥è¯†å›¾è°±</span></h4><p>è¿™ç§çŸ¥è¯†å›¾è°±ä¾§é‡äºä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–çŸ¥è¯†ï¼Œä»¥æ„å»ºåŒ…å«ä¸°å¯Œæ–‡æœ¬æè¿°å’Œè¯­ä¹‰å…³ç³»çš„çŸ¥è¯†å›¾è°±ã€‚ä½†å®ƒåœ¨æå–æ¸…æ™°æ˜ç¡®çš„å®ä½“æ–¹é¢é¢ä¸´æŒ‘æˆ˜ï¼Œè¿™ä½¿å¾—å®ƒä»¬æ›´æ¥è¿‘äºäºŒåˆ†å›¾è€Œéä¼ ç»Ÿçš„è¿é€šå›¾ã€‚ä¹Ÿæ­£åº”å¦‚æ­¤ï¼Œè¿™ç±»å›¾è°±é€šå¸¸èƒ½å®¹å¿æ›´é«˜çš„æ¨¡ç³Šæ€§ï¼Œé€šè¿‡å°†èŠ‚ç‚¹è¡¨ç¤ºä¸ºè‡ªç”±æ–‡æœ¬è€Œéæ˜ç¡®å®šä¹‰çš„å®ä½“ï¼Œä½¿å…¶å¾—ä»¥é€‚é…äºäº§å“å’Œç™¾ç§‘å…¨ä¹¦ç­‰å€¼ä¸ç±»ä¹‹é—´çš„è¯­ä¹‰åŒºåˆ†æœ¬å°±æ¨¡ç³Šé¢†åŸŸã€‚</p>
<h3><span id="duo-mo-tai-zhi-shi-tu-pu-de-gou-jian">å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±çš„æ„å»º</span></h3><p>è¿™é‡Œä¸»è¦ä»‹ç»ä¸¤ç§å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±çš„æ„å»ºèŒƒå¼ï¼šåˆ©ç”¨çŸ¥è¯†å›¾è°±ä¸­çš„ç¬¦å·æ ‡æ³¨å›¾åƒä¸å°†çŸ¥è¯†å›¾è°±ç¬¦å·ä¸å›¾åƒè¿›è¡Œå…³è”</p>
<h4><span id="1-li-yong-zhi-shi-tu-pu-zhong-de-fu-hao-biao-zhu-tu-xiang">1ï¼‰åˆ©ç”¨çŸ¥è¯†å›¾è°±ä¸­çš„ç¬¦å·æ ‡æ³¨å›¾åƒ</span></h4><p>ç¬¬ä¸€ç§èŒƒå¼ç€é‡æå–è§†è§‰å®ä½“ã€å…³ç³»å’Œäº‹ä»¶ä»¥åŠ¨æ€åˆ›å»ºçŸ¥è¯†å›¾è°±ï¼Œä½†åœ¨è¡¨ç¤ºé•¿å°¾å¤šæ¨¡æ€çŸ¥è¯†æ—¶é¢ä¸´æŒ‘æˆ˜ï¼ŒåŸå› åœ¨äºå¸¸è§å®ä½“çš„é‡å¤æç»˜ã€‚æœ‰ç›‘ç£æ–¹æ³•å› ç°æœ‰æ ‡ç­¾èŒƒå›´æœ‰é™è€ŒåŠ å‰§äº†é—®é¢˜ï¼Œä¸”ç³»ç»Ÿéœ€å¤§é‡é¢„å¤„ç†å·¥ä½œï¼Œå­˜åœ¨å¯æ‰©å±•æ€§æŒ‘æˆ˜ã€‚</p>
<h4><span id="2-jiang-zhi-shi-tu-pu-fu-hao-yu-tu-xiang-jin-xing-guan-lian">2ï¼‰å°†çŸ¥è¯†å›¾è°±ç¬¦å·ä¸å›¾åƒè¿›è¡Œå…³è”</span></h4><p>ç¬¬äºŒç§èŒƒå¼ä¸Šå½“å‰å¤šæ•° MMKG æ‰€ä½¿ç”¨çš„ï¼Œå…¶å°†çŸ¥è¯†å›¾è°±ç¬¦å·ä¸å›¾åƒå…³è”ï¼ŒåŒ…æ‹¬å®ä½“ã€æ¦‚å¿µå’Œå…³ç³»å…³è”ã€‚</p>
<p>æ¥ä¸‹æ¥çš„éƒ¨åˆ†å™è¿°äº†å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±çš„æ¼”è¿›è¿‡ç¨‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç§»æ­¥åŸæ–‡è¿›è¡Œé˜…è¯»ã€‚</p>
]]></content>
      <categories>
        <category>çŸ¥è¯†å›¾è°±</category>
        <category>è®ºæ–‡ç²¾è¯»</category>
      </categories>
  </entry>
  <entry>
    <title>ç”¨äºå±é™©åŒ–å­¦å“æ£€æµ‹çš„å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±æ„å»ºæ–¹æ¡ˆ</title>
    <url>/2025/07/31/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E9%A1%B9%E7%9B%AE/2025-07-31-%E7%94%A8%E4%BA%8E%E5%8D%B1%E9%99%A9%E5%8C%96%E5%AD%A6%E5%93%81%E6%A3%80%E6%B5%8B%E7%9A%84%E5%A4%9A%E6%A8%A1%E6%80%81%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h3><span id="1-xu-qiu-fen-xi-yu-chang-jing-ding-yi"><strong>1. éœ€æ±‚åˆ†æä¸åœºæ™¯å®šä¹‰</strong></span></h3><ul>
<li><p><strong>ç›®æ ‡</strong>ï¼šå®ç°å±é™©åŒ–å­¦å“çš„å¿«é€Ÿè¯†åˆ«ã€å±æ€§æŸ¥è¯¢ã€å±å®³è¯„ä¼°ã€åº”æ€¥å¤„ç†æ¨èã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåŒ–å·¥ç”Ÿäº§ã€ä»“å‚¨ç®¡ç†ã€åº”æ€¥å“åº”ã€ç¯å¢ƒç›‘æµ‹ç­‰ã€‚</p>
</li>
<li><p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><p>åŒ–å­¦å“ç‰©ç†&#x2F;åŒ–å­¦å±æ€§æŸ¥è¯¢ï¼ˆå¦‚æ¯’æ€§ã€ç‡ƒç‚¹ã€ååº”æ€§ï¼‰ã€‚</p>
</li>
<li><p>å¤šæ¨¡æ€æ£€ç´¢ï¼ˆé€šè¿‡æ–‡æœ¬ã€åˆ†å­ç»“æ„å›¾ã€å…‰è°±å›¾åƒç­‰æŸ¥è¯¢ï¼‰ã€‚</p>
</li>
<li><p>å±å®³é¢„è­¦ä¸åº”æ€¥å¤„ç†å»ºè®®ã€‚</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3><span id="2-shu-ju-lai-yuan-yu-duo-mo-tai-shu-ju-zheng-he"><strong>2. æ•°æ®æ¥æºä¸å¤šæ¨¡æ€æ•°æ®æ•´åˆ</strong></span></h3><h4><span id="jie-gou-hua-shu-ju"><strong>ç»“æ„åŒ–æ•°æ®</strong></span></h4><ul>
<li><p><strong>æƒå¨æ•°æ®åº“</strong>ï¼š</p>
<ul>
<li><p>PubChemã€ChemSpiderï¼ˆåŒ–å­¦å±æ€§ã€CASå·ï¼‰ã€‚</p>
</li>
<li><p>OSHAå±é™©åŒ–å­¦å“æ•°æ®åº“ï¼ˆå®‰å…¨è§„èŒƒï¼‰ã€‚</p>
</li>
<li><p>MSDSæŸ¥è¯¢ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>æœ¬åœ°æ•°æ®</strong>ï¼šä¼ä¸šåŒ–å­¦å“åº“å­˜è¡¨ã€å®‰å…¨æ•°æ®è¡¨ï¼ˆSDS&#x2F;MSDSï¼‰ã€‚</p>
</li>
</ul>
<h4><span id="fei-jie-gou-hua-shu-ju"><strong>éç»“æ„åŒ–æ•°æ®</strong></span></h4><ul>
<li><p><strong>æ–‡æœ¬</strong>ï¼šç§‘ç ”è®ºæ–‡ï¼ˆPubMedï¼‰ã€å®‰å…¨æ‰‹å†Œã€åº”æ€¥é¢„æ¡ˆã€‚</p>
</li>
<li><p><strong>å›¾åƒ</strong>ï¼šåŒ–å­¦å“æ ‡ç­¾ã€å…‰è°±å›¾ï¼ˆçº¢å¤–&#x2F;Ramanï¼‰ã€åˆ†å­ç»“æ„å›¾ã€‚</p>
</li>
</ul>
<h3><span id="3-zhi-shi-tu-pu-jian-mo-v1"><strong>3. çŸ¥è¯†å›¾è°±å»ºæ¨¡v1</strong></span></h3><h4><span id="ben-ti-she-ji-ontology"><strong>æœ¬ä½“è®¾è®¡ï¼ˆOntologyï¼‰</strong></span></h4><ul>
<li><p><strong>æ ¸å¿ƒå®ä½“</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chemical</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;åŒ–å­¦å“å®ä½“ï¼ˆæ ¸å¿ƒæ ‡è¯†ä¿¡æ¯ï¼‰&quot;&quot;&quot;</span><br>    attributes:<br>        - name: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># ä¸­æ–‡åç§°ï¼ˆå¦‚&quot;ç¡«é…¸&quot;ï¼‰</span><br>        - en_name: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># è‹±æ–‡åç§°ï¼ˆå¦‚&quot;Sulfuric acid&quot;ï¼‰</span><br>        - CAS: <span class="hljs-built_in">str</span>                   <span class="hljs-comment"># CASå·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼Œå¿…é¡»éç©ºï¼‰</span><br>        - UN: <span class="hljs-built_in">str</span>                    <span class="hljs-comment"># UNç¼–å·ï¼ˆå¦‚&quot;1830&quot;ï¼‰  </span><br>        - molecular_formula: <span class="hljs-built_in">str</span>     <span class="hljs-comment"># åˆ†å­å¼ï¼ˆå¦‚&quot;H2SO4&quot;ï¼‰</span><br>        - physical_state: Enum      <span class="hljs-comment"># ç‰©ç†çŠ¶æ€ï¼ˆSOLID/LIQUID/GASï¼‰</span><br>        - aliases: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]         <span class="hljs-comment"># åˆ«åï¼ˆå¦‚&quot;ç”µæ± é…¸&quot;ï¼‰</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hazard</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å±å®³ç±»å‹ï¼ˆGHSæ ‡å‡†ï¼‰&quot;&quot;&quot;</span><br>    attributes:<br>        - code: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># GHSä»£ç ï¼ˆå¦‚&quot;H314&quot;ï¼‰</span><br>        - <span class="hljs-built_in">type</span>: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># åˆ†ç±»ï¼ˆå¦‚&quot;çš®è‚¤è…èš€/åˆºæ¿€&quot;ï¼‰</span><br>        - severity: Enum             <span class="hljs-comment"># å±é™©ç­‰çº§ï¼ˆ1-5çº§ï¼Œå¯¹åº”GHSåˆ†ç±»ï¼‰</span><br>        - icon: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># å›¾æ ‡æ–‡ä»¶åï¼ˆå¦‚&quot;corrosive.png&quot;ï¼‰</span><br>        - signal_word: Enum          <span class="hljs-comment"># ä¿¡å·è¯ï¼ˆDANGER/WARNINGï¼‰</span><br>        - hazard_statements: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] <span class="hljs-comment"># å±é™©è¯´æ˜ï¼ˆå¦‚&quot;é€ æˆä¸¥é‡çš®è‚¤ç¼ä¼¤&quot;ï¼‰</span><br>        - precautionary_statements: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] <span class="hljs-comment"># é˜²èŒƒè¯´æ˜ï¼ˆå¦‚&quot;ç©¿æˆ´é˜²æŠ¤æ‰‹å¥—&quot;ï¼‰</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Property</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;ç‰©ç†åŒ–å­¦å±æ€§ï¼ˆåŠ¨æ€è¡¥å……ï¼‰&quot;&quot;&quot;</span><br>    attributes:<br>        - appearance: <span class="hljs-built_in">str</span>            <span class="hljs-comment"># å¤–è§‚ï¼ˆå¦‚&quot;æ— è‰²æ²¹çŠ¶æ¶²ä½“&quot;ï¼‰</span><br>        - color: <span class="hljs-built_in">str</span>                 <span class="hljs-comment"># é¢œè‰²ï¼ˆå¦‚&quot;æ·¡é»„è‰²&quot;ï¼‰</span><br>        - odor: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># æ°”å‘³ï¼ˆå¦‚&quot;åˆºæ¿€æ€§æ°¨å‘³&quot;ï¼‰</span><br>        - melting_point: <span class="hljs-built_in">float</span>       <span class="hljs-comment"># ç†”ç‚¹ï¼ˆâ„ƒï¼‰</span><br>        - boiling_point: <span class="hljs-built_in">float</span>       <span class="hljs-comment"># æ²¸ç‚¹ï¼ˆâ„ƒï¼‰</span><br>        - flash_point: <span class="hljs-built_in">float</span>         <span class="hljs-comment"># é—ªç‚¹ï¼ˆâ„ƒï¼‰</span><br>        - solubility: <span class="hljs-built_in">str</span>            <span class="hljs-comment"># æº¶è§£åº¦ï¼ˆå¦‚&quot;æ˜“æº¶äºæ°´&quot;ï¼‰</span><br>        - density: <span class="hljs-built_in">float</span>             <span class="hljs-comment"># å¯†åº¦ï¼ˆg/cmÂ³ï¼‰</span><br>        - spectral_data: <span class="hljs-type">Dict</span>        <span class="hljs-comment"># å…‰è°±æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼Œå¦‚&#123;&quot;IR&quot;: &quot;url1&quot;, &quot;Raman&quot;: &quot;url2&quot;&#125;ï¼‰</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmergencyMeasure</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;åº”æ€¥æªæ–½ï¼ˆå®Œæ•´æµç¨‹ï¼‰&quot;&quot;&quot;</span><br>    attributes:<br>        - spill_response: <span class="hljs-built_in">str</span>        <span class="hljs-comment"># æ³„æ¼å¤„ç†ï¼ˆå¦‚&quot;ç”¨ç ‚åœŸå¸é™„&quot;ï¼‰</span><br>        - first_aid: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]  <span class="hljs-comment"># æ€¥æ•‘æªæ–½ï¼ˆæŒ‰æš´éœ²é€”å¾„åˆ†ç±»ï¼‰:</span><br>                                     <span class="hljs-comment">#   - eye_contact: &quot;ç«‹å³ç”¨æ¸…æ°´å†²æ´—15åˆ†é’Ÿ&quot;</span><br>                                     - skin_contact: <span class="hljs-string">&quot;è„±å»æ±¡æŸ“è¡£ç‰©ï¼Œç”¨è‚¥çš‚æ°´å†²æ´—&quot;</span><br>                                     - inhalation: <span class="hljs-string">&quot;è½¬ç§»è‡³ç©ºæ°”æ–°é²œå¤„&quot;</span><br>        - fire_fighting: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]   <span class="hljs-comment"># æ¶ˆé˜²æªæ–½ï¼ˆå¦‚&quot;ä½¿ç”¨å¹²ç²‰ç­ç«å™¨&quot;ï¼‰</span><br>        - special_protection: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] <span class="hljs-comment"># ç‰¹æ®Šé˜²æŠ¤ï¼ˆå¦‚&quot;éœ€è‡ªç»™å¼å‘¼å¸å™¨&quot;ï¼‰</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageRequirement</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å­˜å‚¨ä¸æ“ä½œè¦æ±‚&quot;&quot;&quot;</span><br>    attributes:<br>        - storage_condition: <span class="hljs-built_in">str</span>     <span class="hljs-comment"># å­˜å‚¨æ¡ä»¶ï¼ˆå¦‚&quot;é˜´å‡‰é€šé£ï¼Œè¿œç¦»æ°§åŒ–å‰‚&quot;ï¼‰</span><br>        - incompatible_materials: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] <span class="hljs-comment"># ç¦å¿Œç‰©è´¨ï¼ˆCASå·åˆ—è¡¨ï¼‰</span><br>        - handling_precautions: <span class="hljs-built_in">str</span>   <span class="hljs-comment"># æ“ä½œæ³¨æ„äº‹é¡¹ï¼ˆå¦‚&quot;ä½¿ç”¨é˜²çˆ†å·¥å…·&quot;ï¼‰</span><br><br><span class="hljs-comment"># å¯é€‰</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RegulatoryInfo</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ³•è§„åˆè§„ä¿¡æ¯&quot;&quot;&quot;</span><br>    attributes:<br>        - regulatory_standard: <span class="hljs-built_in">str</span>   <span class="hljs-comment"># æ³•è§„æ ‡å‡†ï¼ˆå¦‚&quot;OSHA 1910.1200&quot;ï¼‰</span><br>        - exposure_limits: <span class="hljs-type">Dict</span>       <span class="hljs-comment"># æš´éœ²é™å€¼ï¼ˆå¦‚&#123;&quot;TWA&quot;: &quot;5 ppm&quot;&#125;ï¼‰</span><br>        - transport_rules: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]  <span class="hljs-comment"># è¿è¾“è§„åˆ™ï¼ˆå¦‚&quot;UNç¼–å·1277, 3ç±»å±é™©å“&quot;ï¼‰</span><br></code></pre></td></tr></table></figure>
<p><strong>å…³ç³»</strong>ï¼š</p>
</li>
<li><p><code>Chemical -[has_property]-&gt; PhysicalProperty</code></p>
</li>
<li><p><code>Chemical -[has_hazard]-&gt; Hazard</code></p>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs cypher">// åˆ›å»ºå®Œæ•´çš„åŒ–å­¦å“èŠ‚ç‚¹åŠå…³ç³»<br>CREATE (c:Chemical &#123;<br>    name: &quot;ç¡«é…¸&quot;,<br>    en_name: &quot;Sulfuric acid&quot;,<br>    CAS: &quot;7664-93-9&quot;,<br>    UN: &quot;1830&quot;<br>&#125;)<br>CREATE (h:Hazard &#123;<br>    code: &quot;H314&quot;,<br>    type: &quot;çš®è‚¤è…èš€/åˆºæ¿€&quot;,<br>    severity: 1,<br>    icon: &quot;corrosive.png&quot;<br>&#125;)<br>CREATE (p:Property &#123;<br>    boiling_point: 337.0,<br>    density: 1.84<br>&#125;)<br>CREATE (e:EmergencyMeasure &#123;<br>    fire_fighting: [&quot;ä½¿ç”¨å¹²ç²‰ç­ç«å™¨&quot;, &quot;ç¦æ­¢ç”¨æ°´&quot;]<br>&#125;)<br>CREATE (s:StorageRequirement &#123;<br>    storage_condition: &quot;ä¸ç¢±ç±»åˆ†å¼€å­˜æ”¾&quot;<br>&#125;)<br>MERGE (c)-[:HAS_HAZARD]-&gt;(h)<br>MERGE (c)-[:HAS_PROPERTY]-&gt;(p)<br>MERGE (c)-[:HAS_EMERGENCY_MEASURE]-&gt;(e)<br>MERGE (c)-[:HAS_STORAGE_REQ]-&gt;(s)<br></code></pre></td></tr></table></figure>

<h4><span id="duo-mo-tai-guan-lian"><strong>å¤šæ¨¡æ€å…³è”</strong></span></h4><ul>
<li><p>ä½¿ç”¨è·¨æ¨¡æ€åµŒå…¥ï¼ˆå¦‚CLIPæ¨¡å‹ï¼‰å°†æ–‡æœ¬æè¿°ä¸å›¾åƒå…³è”ã€‚</p>
</li>
<li><p>åˆ†å­ç»“æ„å›¾é€šè¿‡å›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰åµŒå…¥ä¸ºå‘é‡ï¼Œé“¾æ¥åˆ°åŒ–å­¦å“å®ä½“ã€‚</p>
</li>
<li><p>å°†å›¾åƒè¯†åˆ«ç»“æœï¼ˆå¦‚SMILESï¼‰ä¸æ–‡æœ¬æŠ½å–çš„åŒ–å­¦å“åå¯¹é½</p>
</li>
</ul>
<h3><span id="3-zhi-shi-tu-pu-jian-mo-v2"><strong>3. çŸ¥è¯†å›¾è°±å»ºæ¨¡v2</strong></span></h3><h4><span id="ben-ti-she-ji-ontology"><strong>æœ¬ä½“è®¾è®¡ï¼ˆOntologyï¼‰</strong></span></h4><ul>
<li><p><strong>æ ¸å¿ƒå®ä½“</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chemical</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;åŒ–å­¦å“æ ¸å¿ƒå®ä½“ï¼ˆç»“æ„åŒ–å­˜å‚¨ï¼‰&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span>                      <span class="hljs-comment"># å”¯ä¸€IDï¼ˆCASæˆ–å†…éƒ¨IDï¼‰</span><br>    name: <span class="hljs-built_in">str</span>                    <span class="hljs-comment"># ä¸­æ–‡åç§°</span><br>    en_name: <span class="hljs-built_in">str</span>                 <span class="hljs-comment"># è‹±æ–‡åç§°</span><br>    cas: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]           <span class="hljs-comment"># å…è®¸CASä¸ºç©º</span><br>    un: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]            <br>    molecular_formula: <span class="hljs-built_in">str</span>       <br>    physical_state: Enum         <br>    aliases: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]           <span class="hljs-comment"># åˆ«å</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hazard</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å±å®³ç±»å‹è¯¦æƒ…ï¼ˆæ ‡å‡†åŒ–å­˜å‚¨ï¼‰&quot;&quot;&quot;</span><br>    name: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># å±å®³åç§°ï¼ˆå¦‚&quot;æ˜“ç‡ƒæ¶²ä½“&quot;ï¼‰</span><br>    code: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># GHSä»£ç ï¼ˆå¦‚&quot;H225&quot;ï¼‰</span><br>    severity: <span class="hljs-built_in">int</span>           <span class="hljs-comment"># å±é™©ç­‰çº§ï¼ˆ1-5ï¼‰</span><br>    icon: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># å›¾æ ‡è·¯å¾„</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>2. åŠ¨æ€è¯æ®é“¾è½¬ä¸ºä¸‰å…ƒç»„ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EvidenceTriple</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å¤šæ¨¡æ€è¯æ®ï¼ˆåŠ¨æ€å­˜å‚¨ï¼‰&quot;&quot;&quot;</span><br>    head: <span class="hljs-built_in">str</span>                   <span class="hljs-comment"># å…³è”çš„Chemical/Hazardç­‰å®ä½“çš„ID</span><br>    relation: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># å…³ç³»ç±»å‹ï¼ˆè‡ªç”±å®šä¹‰ï¼‰</span><br>    tail: <span class="hljs-built_in">str</span>                   <span class="hljs-comment"># å€¼æˆ–ç›®æ ‡å®ä½“ID</span><br>    modality: <span class="hljs-built_in">str</span>               <span class="hljs-comment"># text/image</span><br>    source: <span class="hljs-built_in">str</span>                 <span class="hljs-comment"># æ•°æ®æ¥æºï¼ˆURL/æ–‡ä»¶åï¼‰</span><br>    confidence: <span class="hljs-built_in">float</span>           <span class="hljs-comment"># ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰</span><br>    timestamp: datetime         <span class="hljs-comment"># è®°å½•æ—¶é—´</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>3.  å…³ç³»çš„æ ‡å‡†åŒ–è®¾è®¡ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RelationType</span>(<span class="hljs-title class_ inherited__">Enum</span>):<br>    <span class="hljs-comment"># å¯¹è±¡å±æ€§ï¼ˆè¿æ¥å®ä½“ï¼‰</span><br>    HAS_HAZARD = <span class="hljs-string">&quot;hasHazard&quot;</span>            <span class="hljs-comment"># åŒ–å­¦å“â†’å±å®³</span><br>    HAS_COMPONENT = <span class="hljs-string">&quot;hasComponent&quot;</span>      <span class="hljs-comment"># åŒ–å­¦å“â†’æˆåˆ†</span><br>    <span class="hljs-comment"># æ•°æ®å±æ€§ï¼ˆè¿æ¥å®ä½“ä¸å­—é¢é‡ï¼‰</span><br>    HAS_MOLECULAR_WEIGHT = <span class="hljs-string">&quot;molWeight&quot;</span>  <span class="hljs-comment"># åŒ–å­¦å“â†’åˆ†å­é‡ï¼ˆæµ®ç‚¹æ•°ï¼‰</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4><span id="guan-xi-fen-lei-ti-xi-she-ji"><strong>å…³ç³»åˆ†ç±»ä½“ç³»è®¾è®¡</strong></span></h4><p>é’ˆå¯¹åŒ–å­¦å“å®‰å…¨é¢†åŸŸï¼Œé‡‡ç”¨<strong>æ··åˆåˆ†ç±»æ³•</strong>ï¼šç»“åˆé¢†åŸŸæ ‡å‡†ï¼ˆå¦‚GHSï¼‰ä¸é€šç”¨è¯­ä¹‰æ¨¡å‹ï¼ˆå¦‚Schema.orgï¼‰ã€‚</p>
<h5><span id="1-ling-yu-zhuan-yong-guan-xi">1.Â <strong>é¢†åŸŸä¸“ç”¨å…³ç³»</strong></span></h5><table>
<thead>
<tr>
<th>å…³ç³»ç±»å‹</th>
<th>è¯­ä¹‰å®šä¹‰</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>hasHazard</code></td>
<td>åŒ–å­¦å“å…·æœ‰çš„å±å®³ç±»å‹</td>
<td>ä¹™é†‡Â <code>hasHazard</code>Â æ˜“ç‡ƒæ¶²ä½“</td>
</tr>
<tr>
<td><code>hasFirstAid</code></td>
<td>å±å®³å¯¹åº”çš„æ€¥æ•‘æªæ–½</td>
<td>è…èš€æ€§Â <code>hasFirstAid</code>Â ç”¨æ°´å†²æ´—</td>
</tr>
<tr>
<td><code>regulatedUnder</code></td>
<td>å—å“ªäº›æ³•è§„ç›‘ç®¡</td>
<td>é“…Â <code>regulatedUnder</code>Â OSHAæ ‡å‡†</td>
</tr>
</tbody></table>
<h5><span id="2-tong-yong-yu-yi-guan-xi">2.Â <strong>é€šç”¨è¯­ä¹‰å…³ç³»</strong></span></h5><table>
<thead>
<tr>
<th>å…³ç³»ç±»å‹</th>
<th>è¯­ä¹‰å®šä¹‰</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>hasPart</code></td>
<td>ç»„æˆå…³ç³»ï¼ˆæ•´ä½“â†’éƒ¨åˆ†ï¼‰</td>
<td>æ··åˆç‰©Â <code>hasPart</code>Â è‹¯</td>
</tr>
<tr>
<td><code>causes</code></td>
<td>å› æœé“¾å…³ç³»</td>
<td>æ³„æ¼Â <code>causes</code>Â ç¯å¢ƒæ±¡æŸ“</td>
</tr>
<tr>
<td><code>sameAs</code></td>
<td>å®ä½“å¯¹é½</td>
<td>CAS#64-17-5Â <code>sameAs</code>Â ä¹™é†‡</td>
</tr>
</tbody></table>
<h5><span id="3-duo-mo-tai-guan-lian-guan-xi">3.Â <strong>å¤šæ¨¡æ€å…³è”å…³ç³»</strong></span></h5><table>
<thead>
<tr>
<th>å…³ç³»ç±»å‹</th>
<th>ç”¨é€”</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>depictedBy</code></td>
<td>å®ä½“ä¸å›¾åƒ&#x2F;è§†é¢‘çš„å…³è”</td>
<td>ä¹™é†‡Â <code>depictedBy</code>Â GHS02å›¾æ ‡</td>
</tr>
<tr>
<td><code>describedIn</code></td>
<td>å®ä½“ä¸æ–‡æœ¬ç‰‡æ®µçš„å…³è”</td>
<td>çˆ†ç‚¸æ€§Â <code>describedIn</code>Â MSDSç¬¬4èŠ‚</td>
</tr>
</tbody></table>
<h4><span id="hun-he-cun-chu-ce-lue"><strong>æ··åˆå­˜å‚¨ç­–ç•¥</strong></span></h4><h5><span id="1-shu-ju-fen-pei-yuan-ze"><strong>1. æ•°æ®åˆ†é…åŸåˆ™</strong></span></h5><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>å­˜å‚¨ä½ç½®</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å›ºå®šä¸šåŠ¡å­—æ®µ</strong></td>
<td>ç±»ç»“æ„ï¼ˆMongoDB&#x2F;Neo4jï¼‰</td>
<td><code>Chemical.physical_state</code></td>
</tr>
<tr>
<td><strong>å¤šæ¨¡æ€è¯æ®</strong></td>
<td>ä¸‰å…ƒç»„ï¼ˆNeo4jï¼‰</td>
<td><code>&lt;ä¹™é†‡, æ ‡è¯†å›¾æ¡ˆ, GHS02ç«ç„°å›¾æ ‡&gt;</code></td>
</tr>
<tr>
<td><strong>å¤§æ–‡ä»¶ï¼ˆå…‰è°±&#x2F;è§†é¢‘ï¼‰</strong></td>
<td>å¯¹è±¡å­˜å‚¨ï¼ˆMinIO&#x2F;S3ï¼‰</td>
<td>å…‰è°±å›¾URLå­˜å…¥<code>EvidenceTriple.tail</code></td>
</tr>
</tbody></table>
<h5><span id="2-shu-ju-ku-mo-xing-shi-li"><strong>2. æ•°æ®åº“æ¨¡å‹ç¤ºä¾‹</strong></span></h5><p><strong>MongoDBæ–‡æ¡£ï¼ˆç»“æ„åŒ–éƒ¨åˆ†ï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CHEM-64-17-5&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¹™é†‡&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;cas&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;64-17-5&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;boiling_point&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">78.2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;density&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.789</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;hazards&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;H225&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ˜“ç‡ƒæ¶²ä½“&quot;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>Neo4jå›¾å…³ç³»ï¼ˆä¸‰å…ƒç»„éƒ¨åˆ†ï¼‰</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs cypher">// åˆ›å»ºè¯æ®èŠ‚ç‚¹<br>CREATE (e:Evidence &#123;<br>  relation: &quot;æ¶ˆé˜²æªæ–½&quot;,<br>  tail: &quot;ä½¿ç”¨å¹²ç²‰ç­ç«å™¨&quot;,<br>  modality: &quot;text&quot;,<br>  source: &quot;MSDS_ç¬¬5èŠ‚&quot;<br>&#125;)<br><br>// å…³è”åˆ°åŒ–å­¦å“<br>MATCH (c:Chemical &#123;id: &quot;CHEM-64-17-5&quot;&#125;), (e:Evidence)<br>MERGE (c)-[:HAS_EVIDENCE]-&gt;(e)<br></code></pre></td></tr></table></figure>

<h4><span id="guan-jian-gai-zao-dian"><strong>å…³é”®æ”¹é€ ç‚¹</strong></span></h4><h5><span id="1-lei-jie-gou-diao-zheng"><strong>1. ç±»ç»“æ„è°ƒæ•´</strong></span></h5><ul>
<li><strong>ç§»é™¤æ˜“å˜å­—æ®µ</strong>ï¼šå°†<code>icon</code>ã€<code>spectral_data</code>ç­‰è½¬ä¸ºä¸‰å…ƒç»„ï¼š<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸç±»ç»“æ„ä¸­çš„å­—æ®µåˆ é™¤</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hazard</span>:<br>    <span class="hljs-comment"># åˆ é™¤ icon: str  </span><br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Property</span>:<br>    <span class="hljs-comment"># åˆ é™¤ spectral_data: Dict</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<strong>å¢åŠ IDå¼•ç”¨</strong>ï¼šæ‰€æœ‰ç±»æ·»åŠ å”¯ä¸€IDï¼Œç”¨äºå…³è”ä¸‰å…ƒç»„ï¼š<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chemical</span>:<br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span> = Field(default_factory=<span class="hljs-keyword">lambda</span>: <span class="hljs-string">f&quot;CHEM-<span class="hljs-subst">&#123;uuid.uuid4()&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<h5><span id="2-xin-zeng-ying-she-fu-wu"><strong>2. æ–°å¢æ˜ å°„æœåŠ¡</strong></span></h5><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EvidenceMapper</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;åŠ¨æ€å­—æ®µä¸ä¸‰å…ƒç»„çš„è½¬æ¢æœåŠ¡&quot;&quot;&quot;</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">map_icon_to_triple</span>(<span class="hljs-params">chemical_id: <span class="hljs-built_in">str</span>, icon_path: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-keyword">return</span> EvidenceTriple(<br>            head=chemical_id,<br>            relation=<span class="hljs-string">&quot;æ ‡è¯†å›¾æ¡ˆ&quot;</span>,<br>            tail=icon_path,<br>            modality=<span class="hljs-string">&quot;image&quot;</span>,<br>            source=<span class="hljs-string">&quot;GHSå›¾æ ‡åº“&quot;</span><br>        )<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">map_spectral_data</span>(<span class="hljs-params">chemical_id: <span class="hljs-built_in">str</span>, spectra_type: <span class="hljs-built_in">str</span>, url: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-keyword">return</span> EvidenceTriple(<br>            head=chemical_id,<br>            relation=<span class="hljs-string">f&quot;å…‰è°±æ•°æ®_<span class="hljs-subst">&#123;spectra_type&#125;</span>&quot;</span>,<br>            tail=url,<br>            modality=<span class="hljs-string">&quot;image&quot;</span>,<br>            source=<span class="hljs-string">&quot;å®éªŒå®¤æ£€æµ‹&quot;</span><br>        )<br></code></pre></td></tr></table></figure>

<h4><span id="cha-xun-you-hua-fang-an"><strong>æŸ¥è¯¢ä¼˜åŒ–æ–¹æ¡ˆ</strong></span></h4><h5><span id="1-hun-he-cha-xun-shi-li"><strong>1. æ··åˆæŸ¥è¯¢ç¤ºä¾‹</strong></span></h5><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chemical_with_evidence</span>(<span class="hljs-params">cas: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-comment"># 1. ä»MongoDBè·å–ç»“æ„åŒ–æ•°æ®</span><br>    chem = mongo_db.chemicals.find_one(&#123;<span class="hljs-string">&quot;cas&quot;</span>: cas&#125;)<br>    <br>    <span class="hljs-comment"># 2. ä»Neo4jè·å–å…³è”è¯æ®</span><br>    evidences = neo4j.run(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        MATCH (c:Chemical &#123;cas: $cas&#125;)-[:HAS_EVIDENCE]-&gt;(e)</span><br><span class="hljs-string">        RETURN e.relation AS relation, e.tail AS value, e.modality AS type</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>, cas=cas)<br>    <br>    <span class="hljs-comment"># 3. æŒ‰æ¨¡æ€åˆ†ç±»è¯æ®</span><br>    chem[<span class="hljs-string">&quot;evidences&quot;</span>] = &#123;<br>        <span class="hljs-string">&quot;text&quot;</span>: [e <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> evidences <span class="hljs-keyword">if</span> e[<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;text&quot;</span>],<br>        <span class="hljs-string">&quot;image&quot;</span>: [e <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> evidences <span class="hljs-keyword">if</span> e[<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;image&quot;</span>]<br>    &#125;<br>    <span class="hljs-keyword">return</span> chem<br></code></pre></td></tr></table></figure>

<h4><span id="2-huan-cun-ce-lue"><strong>2. ç¼“å­˜ç­–ç•¥</strong></span></h4><ul>
<li><p><strong>ç»“æ„åŒ–æ•°æ®</strong>ï¼šRedisç¼“å­˜<code>Chemical</code>å¯¹è±¡ï¼ˆTTL 1å°æ—¶ï¼‰</p>
</li>
<li><p><strong>ä¸‰å…ƒç»„æ•°æ®</strong>ï¼šæŒ‰éœ€å®æ—¶æŸ¥è¯¢ï¼ˆé«˜é¢‘å…³ç³»å¯é¢„åŠ è½½ï¼‰</p>
</li>
</ul>
<h3><span id="4-zhi-shi-chou-qu-yu-rong-he"><strong>4. çŸ¥è¯†æŠ½å–ä¸èåˆ</strong></span></h3><h4><span id="wen-ben-chu-li"><strong>æ–‡æœ¬å¤„ç†</strong></span></h4><ul>
<li><p><strong>NLPå¤„ç†æµæ°´çº¿</strong>ï¼š</p>
<ul>
<li><p>å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰ï¼šæå–åŒ–å­¦å“åã€å±æ€§ã€å±å®³æœ¯è¯­ï¼ˆç”¨BERT-CRFæ¨¡å‹ï¼‰ã€‚</p>
</li>
<li><p>å…³ç³»æŠ½å–ï¼šåŸºäºè§„åˆ™æˆ–é¢„è®­ç»ƒæ¨¡å‹ï¼ˆå¦‚REBELï¼‰ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è¾“å‡º</strong>ï¼š</p>
<ul>
<li>æ ‡å‡†åŒ–ä¸‰å…ƒç»„ï¼ˆä¸»ä½“-å…³ç³»-å®¢ä½“ï¼‰å­˜å…¥å›¾æ•°æ®åº“</li>
</ul>
</li>
</ul>
<h4><span id="tu-xiang-chu-li"><strong>å›¾åƒå¤„ç†</strong></span></h4><ul>
<li><p><strong>cvå¤„ç†æµæ°´çº¿</strong>ï¼š</p>
<ul>
<li><p><strong>å›¾æ ‡è¯†åˆ«</strong>ï¼šYOLOv8æ£€æµ‹GHSå±é™©å›¾æ ‡ï¼ˆå¦‚ç«ç„°ã€éª·é«…å¤´ï¼‰ã€‚</p>
</li>
<li><p><strong>åˆ†å­ç»“æ„è§£æ</strong>ï¼šRDKit+GNNå°†ç»“æ„å›¾è½¬ä¸ºSMILESè¡¨è¾¾å¼ã€‚</p>
</li>
<li><p><strong>å…‰è°±åŒ¹é…</strong>ï¼šResNetæå–ç‰¹å¾ï¼Œä¸æ•°æ®åº“å…‰è°±å‘é‡ç›¸ä¼¼åº¦æ’åºã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è¾“å‡º</strong>ï¼š</p>
<ul>
<li>å›¾åƒç‰¹å¾å‘é‡ï¼ˆå­˜å…¥Milvusï¼‰ã€å…³è”çš„åŒ–å­¦å“å®ä½“ã€‚</li>
</ul>
</li>
</ul>
<h3><span id="5-zhi-shi-cun-chu-yu-tui-li"><strong>5. çŸ¥è¯†å­˜å‚¨ä¸æ¨ç†</strong></span></h3><ul>
<li><p><strong>å›¾æ•°æ®åº“</strong>ï¼šNeo4jå­˜å‚¨å®ä½“å’Œå…³ç³»ã€‚</p>
<ul>
<li>ç¤ºä¾‹CypheræŸ¥è¯¢ï¼š</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs cypher">MATCH (c:Chemical &#123;name:&quot;ç¡«é…¸&quot;&#125;)-[:has_hazard]-&gt;(h)<br>RETURN h.protection_measures<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>å‘é‡æ•°æ®åº“</strong>ï¼šFAISSå­˜å‚¨åˆ†å­ç»“æ„ã€å…‰è°±åµŒå…¥å‘é‡ï¼Œæ”¯æŒç›¸ä¼¼æ€§æœç´¢ã€‚</p>
</li>
<li><p><strong>æ¨ç†å¼•æ“</strong>ï¼š</p>
<ul>
<li><p>åŸºäºè§„åˆ™çš„æ¨ç†ï¼šIFÂ <code>æ³„æ¼æµ“åº¦ &gt;é˜ˆå€¼</code>Â THENÂ <code>å¯åŠ¨åº”æ€¥æµç¨‹</code>ã€‚</p>
</li>
<li><p>å›¾ç¥ç»ç½‘ç»œæ¨ç†ï¼šé¢„æµ‹æœªçŸ¥åŒ–å­¦å“çš„å±å®³æ€§ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3><span id="6-ying-yong-ceng-shi-xian"><strong>6. åº”ç”¨å±‚å®ç°</strong></span></h3><ul>
<li><p><strong>å¤šæ¨¡æ€æ£€ç´¢</strong>ï¼š</p>
<ul>
<li><p>è¾“å…¥ï¼šä¸Šä¼ å…‰è°±å›¾ â†’ è¿”å›åŒ¹é…åŒ–å­¦å“åŠå®‰å…¨æªæ–½ã€‚</p>
</li>
<li><p>è¾“å…¥ï¼šâ€å“ªäº›åŒ–å­¦å“ä¸æ°¨æ°”ååº”ï¼Ÿâ€ â†’ è¿”å›ååº”åˆ—è¡¨åŠè§†é¢‘æ¼”ç¤ºã€‚</p>
</li>
</ul>
</li>
<li><p><strong>é£é™©è¦ç´ è‡ªåŠ¨æŠ½å–</strong>ï¼š</p>
<ul>
<li><p>è¾“å…¥ï¼šå›¾ç‰‡ + é«˜æ¸©çš„æ–‡å­—æè¿°</p>
</li>
<li><p>è¾“å‡ºï¼šçˆ†ç‚¸é£é™©ï¼šé¿å…çƒ­æº</p>
</li>
</ul>
</li>
</ul>
<h3><span id="7-ji-zhu-zhan"><strong>7. æŠ€æœ¯æ ˆ</strong></span></h3><table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>æŠ€æœ¯é€‰å‹</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ–‡æœ¬å¤„ç†</strong></td>
<td>Spacy+BERT-CRF, REBELå…³ç³»æŠ½å–</td>
<td>åŒ–å­¦å“å&#x2F;é£é™©è¦ç´ æŠ½å–</td>
</tr>
<tr>
<td><strong>å›¾åƒå¤„ç†</strong></td>
<td>YOLOv8ï¼ˆå›¾æ ‡æ£€æµ‹ï¼‰, RDKit+GNNï¼ˆåˆ†å­å›¾è½¬SMILESï¼‰, CLIPï¼ˆè·¨æ¨¡æ€åŒ¹é…ï¼‰</td>
<td>å›¾åƒè§£æä¸å…³è”</td>
</tr>
<tr>
<td><strong>çŸ¥è¯†å­˜å‚¨</strong></td>
<td>Neo4jï¼ˆå›¾è°±ï¼‰, FAISSï¼ˆå‘é‡ï¼‰, MongoDBï¼ˆéç»“æ„åŒ–æ•°æ®ï¼‰</td>
<td>å¤šæ¨¡æ€æ•°æ®å­˜å‚¨</td>
</tr>
<tr>
<td><strong>åç«¯æœåŠ¡</strong></td>
<td>FastAPIï¼ˆPythonï¼‰, GraphQLï¼ˆå›¾è°±æŸ¥è¯¢ï¼‰, Kafkaï¼ˆå®æ—¶æ•°æ®æµï¼‰</td>
<td>æä¾›ç»Ÿä¸€æ¥å£</td>
</tr>
<tr>
<td><strong>å‰ç«¯å¯è§†åŒ–</strong></td>
<td>React + Cytoscape.js + Ketcher + Three.jsï¼ˆ3Dåˆ†å­å±•ç¤ºï¼‰</td>
<td>äº¤äº’å¼çŸ¥è¯†æ¢ç´¢</td>
</tr>
<tr>
<td><strong>éƒ¨ç½²è¿ç»´</strong></td>
<td>Docker + Kubernetes, Prometheusï¼ˆç›‘æ§ï¼‰, Nginxï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</td>
<td>é«˜å¯ç”¨éƒ¨ç½²</td>
</tr>
</tbody></table>
<h3><span id="8-tiao-zhan-yu-jie-jue-fang-an"><strong>8. æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</strong></span></h3><ul>
<li><p><strong>æ•°æ®å¼‚æ„æ€§</strong>ï¼šå®šä¹‰ç»Ÿä¸€JSON-LDæ ¼å¼æ˜ å°„å¤šæ¨¡æ€æ•°æ®ã€‚</p>
</li>
<li><p><strong>å®æ—¶æ€§</strong>ï¼šä½¿ç”¨Kafkaæµå¤„ç†ä¼ æ„Ÿå™¨æ•°æ®ã€‚</p>
</li>
<li><p><strong>å¯è§£é‡Šæ€§</strong>ï¼šç”ŸæˆåŸºäºå­å›¾çš„è§£é‡Šï¼ˆå¦‚æ³„æ¼å¤„ç†æ­¥éª¤çš„æ¨ç†è·¯å¾„ï¼‰ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>çŸ¥è¯†å›¾è°±</category>
        <category>é¡¹ç›®</category>
      </categories>
  </entry>
  <entry>
    <title>æ„å»ºä¸€ä¸ªç®€æ˜“çš„demoéªŒè¯mmkgè®¾è®¡æ–¹æ¡ˆçš„å¯è¡Œæ€§</title>
    <url>/2025/08/01/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E9%A1%B9%E7%9B%AE/2025-08-01-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84demo%E9%AA%8C%E8%AF%81mmkg%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88%E7%9A%84%E5%8F%AF%E8%A1%8C%E6%80%A7/</url>
    <content><![CDATA[<blockquote>
<p>ä¸ºéªŒè¯å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±æœ¬ä½“è®¾è®¡æ˜¯å¦åˆç†ï¼Œæ•°æ®é“¾è·¯æ˜¯å¦é€šç•…ï¼Œåšä¸»å†³å®šè®¾è®¡ä¸€ä¸ªç®€æ˜“çš„demoè¿›è¡ŒéªŒè¯ï¼Œå¹¶ä»¥æ­¤æŒ‡å¯¼åç»­å®Œæ•´å›¾è°±çš„è®¾è®¡ã€‚</p>
</blockquote>
<p>ä¸‹é¢å…ˆä»‹ç»chemical_mmkg_demo-v1çš„ç»„ç»‡ç»“æ„</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><code class="hljs nix">chemical_mmkg_demo<span class="hljs-symbol">/</span><br>â”œâ”€â”€ core<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ ¸å¿ƒé¢†åŸŸæ¨¡å‹</span><br>â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”œâ”€â”€ entities.py            <span class="hljs-comment"># Chemical/Hazardç­‰æ ¸å¿ƒç±»å®šä¹‰</span><br>â”‚   â”œâ”€â”€ relations.py           <span class="hljs-comment"># RelationTypeæšä¸¾åŠå…³ç³»éªŒè¯</span><br>â”‚   â””â”€â”€ exceptions.py          <span class="hljs-comment"># è‡ªå®šä¹‰å¼‚å¸¸ç±»</span><br>â”‚<br>â”œâ”€â”€ data<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ•°æ®ç›¸å…³</span><br>â”‚   â””â”€â”€ sample_data<span class="hljs-symbol">/</span>           <span class="hljs-comment"># æµ‹è¯•ç”¨YAML/JSONæ•°æ®</span><br>â”‚<br>â”œâ”€â”€ services<span class="hljs-symbol">/</span>                  <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘</span><br>â”‚   â””â”€â”€ graph_service.py       <span class="hljs-comment"># å›¾è°±æ„å»º/æŸ¥è¯¢æœåŠ¡</span><br>â”‚<br>â”œâ”€â”€ tests<span class="hljs-symbol">/</span>                     <span class="hljs-comment"># æµ‹è¯•å¥—ä»¶</span><br>â”‚   â””â”€â”€ unit<span class="hljs-symbol">/</span><br>â”‚       â””â”€â”€ test_entities.py<br>â”‚<br>â”œâ”€â”€ demo<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ¼”ç¤ºç”¨ä¾‹</span><br>â”‚   â”œâ”€â”€ setup_sample_graph.py  <span class="hljs-comment"># åˆå§‹åŒ–æµ‹è¯•æ•°æ®</span><br>â”‚   â””â”€â”€ query_examples.py      <span class="hljs-comment"># å…¸å‹æŸ¥è¯¢ç¤ºä¾‹</span><br>â”‚<br>â””â”€â”€ utils<span class="hljs-symbol">/</span><br>	â””â”€â”€ config_loader.py       <span class="hljs-comment"># å›¾è°±æ„å»º/æŸ¥è¯¢æœåŠ¡</span><br></code></pre></td></tr></table></figure>

<p>ä»£ç æ¸…å•ï¼š</p>
<h3><span id="1-he-xin-ling-yu-mo-xing">1. æ ¸å¿ƒé¢†åŸŸæ¨¡å‹</span></h3><h4><span id="core-entities-py"><code>core/entities.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum  <br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>  <br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field, field_validator  <br><span class="hljs-keyword">import</span> re  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PhysicalState</span>(<span class="hljs-built_in">str</span>, Enum):  <br>    SOLID = <span class="hljs-string">&quot;solid&quot;</span>  <br>    LIQUID = <span class="hljs-string">&quot;liquid&quot;</span>  <br>    GAS = <span class="hljs-string">&quot;gas&quot;</span>  <br>    AEROSOL = <span class="hljs-string">&quot;aerosol&quot;</span>  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HazardCategory</span>(<span class="hljs-built_in">str</span>, Enum):  <br>    PHYSICAL = <span class="hljs-string">&quot;physical&quot;</span>  <br>    HEALTH = <span class="hljs-string">&quot;health&quot;</span>  <br>    ENVIRONMENTAL = <span class="hljs-string">&quot;environmental&quot;</span> <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chemical</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;åŒ–å­¦å“æ ¸å¿ƒå®ä½“&quot;&quot;&quot;</span>  <br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">3</span>, description=<span class="hljs-string">&quot;å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆCASæˆ–å†…éƒ¨IDï¼‰&quot;</span>)  <br>    name: <span class="hljs-built_in">str</span> = Field(..., max_length=<span class="hljs-number">100</span>, description=<span class="hljs-string">&quot;ä¸­æ–‡åç§°&quot;</span>)  <br>    en_name: <span class="hljs-built_in">str</span> = Field(..., max_length=<span class="hljs-number">100</span>, description=<span class="hljs-string">&quot;è‹±æ–‡åç§°&quot;</span>)  <br>    cas: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;CASç™»è®°å·&quot;</span>)  <br>    un: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, pattern=<span class="hljs-string">r&#x27;^UN\d&#123;4&#125;$&#x27;</span>, description=<span class="hljs-string">&quot;UNç¼–å·&quot;</span>)  <br>    molecular_formula: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;åˆ†å­å¼&quot;</span>)  <br>    physical_state: PhysicalState = Field(..., description=<span class="hljs-string">&quot;ç‰©ç†çŠ¶æ€&quot;</span>)   <br>  <br><span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&#x27;cas&#x27;</span></span>)  </span><br><span class="hljs-meta">    @classmethod  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_cas</span>(<span class="hljs-params">cls, v: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:  <br>	    <span class="hljs-string">&quot;&quot;&quot;casæ ¼å¼éªŒè¯&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:  <br>            <span class="hljs-keyword">return</span> v  <br>  <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.fullmatch(<span class="hljs-string">r&#x27;^\d&#123;2,7&#125;-\d&#123;2&#125;-\d$&#x27;</span>, v):  <br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid CAS number format&quot;</span>)  <br>  <br>        parts = v.split(<span class="hljs-string">&#x27;-&#x27;</span>)  <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts[<span class="hljs-number">0</span>]) &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(parts[<span class="hljs-number">0</span>]) &gt; <span class="hljs-number">7</span>:  <br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;CAS first segment must be 2-7 digits&quot;</span>)  <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts[<span class="hljs-number">1</span>]) != <span class="hljs-number">2</span>:  <br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;CAS second segment must be 2 digits&quot;</span>)  <br>  <br>        <span class="hljs-keyword">return</span> v  <br><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">dict_for_neo4j</span>(<span class="hljs-params">self</span>):  <br>	    data = <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">dict</span>()  <br>	    <span class="hljs-comment"># å°†æšä¸¾è½¬æ¢ä¸ºå­—ç¬¦ä¸²å€¼  </span><br>	    data[<span class="hljs-string">&quot;physical_state&quot;</span>] = <span class="hljs-variable language_">self</span>.physical_state.value  <br>	    <span class="hljs-keyword">return</span> data<br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hazard</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;å±å®³ç‰¹æ€§å®ä½“&quot;&quot;&quot;</span>  <br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;å±å®³å”¯ä¸€ID&quot;</span>)<br>    name: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;å±å®³åç§°&quot;</span>)  <br>    code: <span class="hljs-built_in">str</span> = Field(..., pattern=<span class="hljs-string">r&#x27;^(GHS|H)\d+$&#x27;</span>, description=<span class="hljs-string">&quot;GHS/Hä»£ç &quot;</span>)  <br>    severity: <span class="hljs-built_in">int</span> = Field(<span class="hljs-number">1</span>, ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">5</span>, description=<span class="hljs-string">&quot;å±é™©ç­‰çº§&quot;</span>)  <br>    category: HazardCategory = Field(..., description=<span class="hljs-string">&quot;å±å®³ç±»åˆ«&quot;</span>)<br>    icon: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;å›¾æ ‡è·¯å¾„&quot;</span>)  <br>  <br><span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&#x27;severity&#x27;</span></span>)  </span><br><span class="hljs-meta">	@classmethod  </span><br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_severity</span>(<span class="hljs-params">cls, v: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:  <br>	    <span class="hljs-keyword">if</span> v &gt; <span class="hljs-number">3</span>:  <br>	        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è­¦å‘Šï¼šé«˜é£é™©ç­‰çº§ <span class="hljs-subst">&#123;v&#125;</span>ï¼éœ€è¦ç‰¹æ®Šå¤„ç†&quot;</span>)  <br>	    <span class="hljs-keyword">return</span> v<br></code></pre></td></tr></table></figure>

<h4><span id="core-relations-py"><code>core/relations.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum  <br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>  <br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field, field_validator    <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RelationType</span>(<span class="hljs-title class_ inherited__">Enum</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;æ ‡å‡†å…³ç³»ç±»å‹æšä¸¾&quot;&quot;&quot;</span>  <br>    HAS_HAZARD = <span class="hljs-string">&quot;hasHazard&quot;</span>  <br>    HAS_COMPONENT = <span class="hljs-string">&quot;hasComponent&quot;</span>  <br>    DEPICTED_BY = <span class="hljs-string">&quot;depictedBy&quot;</span>  <span class="hljs-comment"># ä¿®æ­£æ‹¼å†™é”™è¯¯  </span><br>    HAS_MOLECULAR_WEIGHT = <span class="hljs-string">&quot;molWeight&quot;</span>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EvidenceTriple</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;å¤šæ¨¡æ€è¯æ®ä¸‰å…ƒç»„&quot;&quot;&quot;</span>  <br>    head: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;å¤´å®ä½“ID&quot;</span>)  <br>    relation: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;å…³ç³»ç±»å‹&quot;</span>)  <br>    tail: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;å°¾å®ä½“IDæˆ–å€¼&quot;</span>)  <br>    modality: <span class="hljs-built_in">str</span> = Field(..., pattern=<span class="hljs-string">&quot;^(text|image|video)$&quot;</span>)  <span class="hljs-comment"># ä¿®æ”¹è¿™é‡Œ  </span><br>    source: <span class="hljs-built_in">str</span> = Field(..., description=<span class="hljs-string">&quot;æ•°æ®æ¥æº&quot;</span>)  <br>    confidence: <span class="hljs-built_in">float</span> = Field(<span class="hljs-number">0.9</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">1</span>)  <br>    timestamp: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;æ—¶é—´æˆ³&quot;</span>)  <br>  <br><span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&#x27;relation&#x27;</span></span>)</span><br><span class="hljs-meta">    @classmethod  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_relation</span>(<span class="hljs-params">cls, v</span>):  <br>        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [t.value <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> RelationType]:  <br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;æ— æ•ˆå…³ç³»ç±»å‹: <span class="hljs-subst">&#123;v&#125;</span>&quot;</span>)  <br>        <span class="hljs-keyword">return</span> v<br></code></pre></td></tr></table></figure>

<h4><span id="core-exceptions-py"><code>core/exceptions.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChemicalKGError</span>(<span class="hljs-title class_ inherited__">Exception</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;åŸºç¡€å¼‚å¸¸ç±»&quot;&quot;&quot;</span>  <br>    <span class="hljs-keyword">pass</span>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InvalidCASError</span>(<span class="hljs-title class_ inherited__">ChemicalKGError</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;CASå·æ ¼å¼é”™è¯¯&quot;&quot;&quot;</span>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cas: <span class="hljs-built_in">str</span>, message: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>):  <br>        <span class="hljs-variable language_">self</span>.cas = cas  <br>        <span class="hljs-variable language_">self</span>.message = message <span class="hljs-keyword">or</span> <span class="hljs-string">f&quot;æ— æ•ˆçš„CASå·æ ¼å¼: <span class="hljs-subst">&#123;cas&#125;</span>&quot;</span>  <br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-variable language_">self</span>.message)<br></code></pre></td></tr></table></figure>

<h3><span id="2-shu-ju-fu-wu-ceng">2. æ•°æ®æœåŠ¡å±‚</span></h3><h4><span id="services-graph-service-py"><code>services/graph_service.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span> <br><span class="hljs-keyword">from</span> neo4j <span class="hljs-keyword">import</span> AsyncGraphDatabase<br><span class="hljs-keyword">from</span> core.entities <span class="hljs-keyword">import</span> Chemical, Hazard  <br><span class="hljs-keyword">from</span> core.relations <span class="hljs-keyword">import</span> EvidenceTriple, RelationType  <br><span class="hljs-keyword">from</span> core.exceptions <span class="hljs-keyword">import</span> ChemicalKGError  <br><span class="hljs-keyword">import</span> logging<br><br>logger = logging.getLogger(__name__)<br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChemicalGraphService</span>:  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-comment"># ç¡®ä¿åˆå§‹åŒ–äº†æ•°æ®åº“è¿æ¥  </span><br>        <span class="hljs-variable language_">self</span>.driver = AsyncGraphDatabase.driver(<span class="hljs-string">&quot;http://localhost:7687&quot;</span>, auth=(<span class="hljs-string">&quot;neo4j&quot;</span>, <span class="hljs-string">&quot;12345678&quot;</span>))  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">self</span>.driver.close()  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_chemical</span>(<span class="hljs-params">self, chemical: Chemical</span>) -&gt; <span class="hljs-built_in">bool</span>:  <br>        <span class="hljs-string">&quot;&quot;&quot;åˆ›å»ºæˆ–è·å–åŒ–å­¦å“èŠ‚ç‚¹&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">        MERGE (c:Chemical &#123;id: $id&#125;)        </span><br><span class="hljs-string">        ON CREATE SET            </span><br><span class="hljs-string">	        c.name = $name,            </span><br><span class="hljs-string">	        c.en_name = $en_name,            </span><br><span class="hljs-string">	        c.cas = $cas,            </span><br><span class="hljs-string">	        c.un = $un,            </span><br><span class="hljs-string">	        c.molecular_formula = $molecular_formula,            </span><br><span class="hljs-string">	        c.physical_state = $physical_state        </span><br><span class="hljs-string">	    RETURN c        </span><br><span class="hljs-string">	    &quot;&quot;&quot;</span>        <br>	    <span class="hljs-keyword">try</span>:  <br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>                result = <span class="hljs-keyword">await</span> session.run(query, **chemical.dict_for_neo4j())  <br>                record = <span class="hljs-keyword">await</span> result.single()  <br>                <span class="hljs-keyword">if</span> record:  <br>                    logger.info(<span class="hljs-string">f&quot;å·²å­˜åœ¨æˆ–åˆ›å»ºåŒ–å­¦å“: <span class="hljs-subst">&#123;chemical.name&#125;</span>&quot;</span>)  <br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>            logger.error(<span class="hljs-string">f&quot;åŒ–å­¦å“æ“ä½œå¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_hazard</span>(<span class="hljs-params">self, hazard: Hazard</span>) -&gt; <span class="hljs-built_in">bool</span>:  <br>        <span class="hljs-string">&quot;&quot;&quot;åˆ›å»ºæˆ–è·å–å±å®³èŠ‚ç‚¹&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">        MERGE (h:Hazard &#123;id: $id&#125;)        </span><br><span class="hljs-string">        ON CREATE SET            </span><br><span class="hljs-string">	        h.name = $name,            </span><br><span class="hljs-string">	        h.code = $code,            </span><br><span class="hljs-string">	        h.severity = $severity,            </span><br><span class="hljs-string">	        h.category = $category        </span><br><span class="hljs-string">	    RETURN h        </span><br><span class="hljs-string">	    &quot;&quot;&quot;</span>        <br>	    <span class="hljs-keyword">try</span>:  <br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>                result = <span class="hljs-keyword">await</span> session.run(query, **hazard.<span class="hljs-built_in">dict</span>())  <br>                record = <span class="hljs-keyword">await</span> result.single()  <br>                <span class="hljs-keyword">if</span> record:  <br>                    logger.info(<span class="hljs-string">f&quot;å·²å­˜åœ¨æˆ–åˆ›å»ºå±å®³: <span class="hljs-subst">&#123;hazard.name&#125;</span>&quot;</span>)  <br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>            logger.error(<span class="hljs-string">f&quot;å±å®³æ“ä½œå¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_relationship</span>(<span class="hljs-params">  </span><br><span class="hljs-params">            self,  </span><br><span class="hljs-params">            source_id: <span class="hljs-built_in">str</span>,  </span><br><span class="hljs-params">            target_id: <span class="hljs-built_in">str</span>,  </span><br><span class="hljs-params">            relation_type: RelationType,  </span><br><span class="hljs-params">            evidence: <span class="hljs-type">List</span>[<span class="hljs-built_in">dict</span>] = <span class="hljs-literal">None</span>,  </span><br><span class="hljs-params">            **properties  </span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-built_in">bool</span>:  <br>        <span class="hljs-string">&quot;&quot;&quot;åˆ›å»ºæˆ–æ›´æ–°èŠ‚ç‚¹é—´å…³ç³»ï¼ˆå¹‚ç­‰æ“ä½œï¼‰&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">        MATCH (a &#123;id: $source_id&#125;), (b &#123;id: $target_id&#125;)        </span><br><span class="hljs-string">        MERGE (a)-[r:%s]-&gt;(b)        </span><br><span class="hljs-string">        SET r += $rel_properties        </span><br><span class="hljs-string">        RETURN r        </span><br><span class="hljs-string">        &quot;&quot;&quot;</span> % relation_type.value  <br>  <br>        rel_properties = &#123;&#125;  <br>        <span class="hljs-keyword">if</span> evidence:  <br>            <span class="hljs-keyword">import</span> json  <br>            rel_properties[<span class="hljs-string">&quot;evidence_json&quot;</span>] = json.dumps(evidence, ensure_ascii=<span class="hljs-literal">False</span>)  <br>        rel_properties.update(properties)  <br>  <br>        <span class="hljs-keyword">try</span>:  <br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>                result = <span class="hljs-keyword">await</span> session.run(query,  <br>                                           source_id=source_id,  <br>                                           target_id=target_id,  <br>                                           rel_properties=rel_properties  <br>                                           )  <br>                record = <span class="hljs-keyword">await</span> result.single()  <br>                <span class="hljs-keyword">if</span> record:  <br>                    logger.info(<span class="hljs-string">f&quot;å…³ç³»å·²å­˜åœ¨æˆ–æ›´æ–°: <span class="hljs-subst">&#123;source_id&#125;</span>-[<span class="hljs-subst">&#123;relation_type.value&#125;</span>]-&gt;<span class="hljs-subst">&#123;target_id&#125;</span>&quot;</span>)  <br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>            logger.error(<span class="hljs-string">f&quot;å…³ç³»æ“ä½œå¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <br>  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_chemical_by_cas</span>(<span class="hljs-params">self, cas: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[Chemical]:  <br>        <span class="hljs-string">&quot;&quot;&quot;é€šè¿‡CASå·æŸ¥è¯¢åŒ–å­¦å“&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">                MATCH (c:Chemical &#123;cas: $cas&#125;)                </span><br><span class="hljs-string">                RETURN c                </span><br><span class="hljs-string">                &quot;&quot;&quot;</span>        <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>            <span class="hljs-keyword">try</span>:  <br>                result = <span class="hljs-keyword">await</span> session.run(query, cas=cas)  <br>                record = <span class="hljs-keyword">await</span> result.single()  <br>                <span class="hljs-keyword">return</span> record[<span class="hljs-string">&quot;c&quot;</span>] <span class="hljs-keyword">if</span> record <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>  <br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢åŒ–å­¦å“å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chemical_hazards</span>(<span class="hljs-params">self, chemical_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Hazard]:  <br>        <span class="hljs-string">&quot;&quot;&quot;è·å–åŒ–å­¦å“çš„æ‰€æœ‰å±å®³ï¼ˆå»é‡ï¼‰&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">        MATCH (c:Chemical &#123;id: $chemical_id&#125;)-[:HAS_HAZARD]-&gt;(h:Hazard)        </span><br><span class="hljs-string">        RETURN DISTINCT properties(h) as hazard        </span><br><span class="hljs-string">        &quot;&quot;&quot;</span>        <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>            result = <span class="hljs-keyword">await</span> session.run(query, chemical_id=chemical_id)  <br>            <span class="hljs-keyword">return</span> [Hazard(**record[<span class="hljs-string">&quot;hazard&quot;</span>]) <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> result]  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_incompatible_chemicals</span>(<span class="hljs-params">self, chemical_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Chemical]:  <br>        <span class="hljs-string">&quot;&quot;&quot;æŸ¥æ‰¾ä¸ç›¸å®¹åŒ–å­¦å“ï¼ˆå»é‡ï¼‰&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">        MATCH (c1:Chemical &#123;id: $chemical_id&#125;)-[:INCOMPATIBLE_WITH]-&gt;(c2:Chemical)        </span><br><span class="hljs-string">        RETURN DISTINCT properties(c2) as chemical        </span><br><span class="hljs-string">        &quot;&quot;&quot;</span>        <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>            result = <span class="hljs-keyword">await</span> session.run(query, chemical_id=chemical_id)  <br>            <span class="hljs-keyword">return</span> [Chemical(**record[<span class="hljs-string">&quot;chemical&quot;</span>]) <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> result]  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_related_entities</span>(<span class="hljs-params">self, entity_id: <span class="hljs-built_in">str</span>, relation_type: RelationType</span>) -&gt; <span class="hljs-built_in">list</span>:  <br>        <span class="hljs-string">&quot;&quot;&quot;è·å–æŒ‡å®šå…³ç³»çš„æ‰€æœ‰å…³è”å®ä½“&quot;&quot;&quot;</span>  <br>        query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">                MATCH (source &#123;id: $entity_id&#125;)-[r:%s]-&gt;(target)                </span><br><span class="hljs-string">                RETURN properties(target) as entity                </span><br><span class="hljs-string">                &quot;&quot;&quot;</span> % relation_type.value  <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>            result = <span class="hljs-keyword">await</span> session.run(query, entity_id=entity_id)  <br>            <span class="hljs-keyword">return</span> [record[<span class="hljs-string">&quot;entity&quot;</span>] <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> result]  <br>  <br>  <br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chemical_evidence</span>(<span class="hljs-params">  </span><br><span class="hljs-params">            self,  </span><br><span class="hljs-params">            chemical_id: <span class="hljs-built_in">str</span>,  </span><br><span class="hljs-params">            relation_type: <span class="hljs-type">Optional</span>[RelationType] = <span class="hljs-literal">None</span>  </span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">dict</span>]:  <br>        <span class="hljs-string">&quot;&quot;&quot;è·å–åŒ–å­¦å“çš„ç›¸å…³è¯æ®ï¼ˆæ”¯æŒJSONè§£æï¼‰&quot;&quot;&quot;</span>  <br>        <span class="hljs-keyword">import</span> json  <br>  <br>        <span class="hljs-keyword">if</span> relation_type:  <br>            query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">            MATCH (c &#123;id: $chemical_id&#125;)-[r]-&gt;()            </span><br><span class="hljs-string">            WHERE type(r) = $relation_type AND r.evidence_json IS NOT NULL            </span><br><span class="hljs-string">            RETURN r.evidence_json as evidence_json            </span><br><span class="hljs-string">            &quot;&quot;&quot;</span>            <br>            params = &#123;<span class="hljs-string">&quot;chemical_id&quot;</span>: chemical_id, <span class="hljs-string">&quot;relation_type&quot;</span>: relation_type.value&#125;  <br>        <span class="hljs-keyword">else</span>:  <br>            query = <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">            MATCH (c &#123;id: $chemical_id&#125;)-[r]-&gt;()            </span><br><span class="hljs-string">            WHERE r.evidence_json IS NOT NULL            </span><br><span class="hljs-string">            RETURN r.evidence_json as evidence_json            </span><br><span class="hljs-string">            &quot;&quot;&quot;</span>            <br>            params = &#123;<span class="hljs-string">&quot;chemical_id&quot;</span>: chemical_id&#125;  <br>  <br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.driver.session() <span class="hljs-keyword">as</span> session:  <br>            result = <span class="hljs-keyword">await</span> session.run(query, **params)  <br>            evidence = []  <br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> result:  <br>                <span class="hljs-keyword">if</span> record[<span class="hljs-string">&quot;evidence_json&quot;</span>]:  <br>                    <span class="hljs-keyword">try</span>:  <br>                        evidence.extend(json.loads(record[<span class="hljs-string">&quot;evidence_json&quot;</span>]))  <br>                    <span class="hljs-keyword">except</span> json.JSONDecodeError:  <br>                        logger.error(<span class="hljs-string">f&quot;è¯æ®JSONè§£æå¤±è´¥: <span class="hljs-subst">&#123;record[<span class="hljs-string">&#x27;evidence_json&#x27;</span>]&#125;</span>&quot;</span>)  <br>            <span class="hljs-keyword">return</span> evidence<br></code></pre></td></tr></table></figure>

<h3><span id="3-ce-shi-yong-li">3. æµ‹è¯•ç”¨ä¾‹</span></h3><h4><span id="tests-unit-test-entities-py"><code>tests/unit/test_entities.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest  <br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> ValidationError  <br><span class="hljs-keyword">from</span> core.entities <span class="hljs-keyword">import</span> Chemical, Hazard, PhysicalState  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestChemicalEntity</span>:  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_valid_chemical</span>(<span class="hljs-params">self</span>):  <br>        chem = Chemical(  <br>            <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CHEM001&quot;</span>,  <br>            name=<span class="hljs-string">&quot;ç¡«é…¸&quot;</span>,  <br>            en_name=<span class="hljs-string">&quot;Sulfuric Acid&quot;</span>,  <br>            cas=<span class="hljs-string">&quot;7664-93-9&quot;</span>,  <br>            un=<span class="hljs-string">&quot;UN1830&quot;</span>,  <br>            molecular_formula=<span class="hljs-string">&quot;H2SO4&quot;</span>,  <br>            physical_state=PhysicalState.LIQUID  <br>        )  <br>        <span class="hljs-keyword">assert</span> chem.cas == <span class="hljs-string">&quot;7664-93-9&quot;</span>  <br>        <span class="hljs-keyword">assert</span> chem.physical_state == PhysicalState.LIQUID  <br>  <br><span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;cas_num, is_valid&quot;</span>, [  </span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;7732-18-5&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># æ°´çš„CASå·  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;64-17-5&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># ä¹™é†‡  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;123-45-6&quot;</span>, <span class="hljs-literal">True</span></span>),  <span class="hljs-comment"># æ ¼å¼æ­£ç¡®ï¼ˆè™½ç„¶å¯èƒ½ä¸å­˜åœ¨ï¼‰  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;1-23-4&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬ä¸€éƒ¨åˆ†å¤ªçŸ­  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;12345678-90-1&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬ä¸€éƒ¨åˆ†å¤ªé•¿  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;123-456-7&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># ç¬¬äºŒéƒ¨åˆ†åº”ä¸º2ä½  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;abc-de-f&quot;</span>, <span class="hljs-literal">False</span></span>),  <span class="hljs-comment"># åŒ…å«éæ•°å­—å­—ç¬¦  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-literal">None</span>, <span class="hljs-literal">True</span></span>)  <span class="hljs-comment"># å…è®¸ä¸ºç©º  </span></span></span><br><span class="hljs-params"><span class="hljs-meta">    ]</span>)  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_cas_validation</span>(<span class="hljs-params">self, cas_num, is_valid</span>):  <br>        <span class="hljs-keyword">if</span> is_valid:  <br>            chem = Chemical(  <br>                <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;TEST&quot;</span>,  <br>                name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                en_name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                cas=cas_num,  <br>                molecular_formula=<span class="hljs-string">&quot;X&quot;</span>,  <br>                physical_state=PhysicalState.SOLID  <br>            )  <br>            <span class="hljs-keyword">assert</span> chem.cas == cas_num  <br>        <span class="hljs-keyword">else</span>:  <br>            <span class="hljs-keyword">with</span> pytest.raises(ValidationError):  <br>                Chemical(  <br>                    <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;TEST&quot;</span>,  <br>                    name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                    en_name=<span class="hljs-string">&quot;Test&quot;</span>,  <br>                    cas=cas_num,  <br>                    molecular_formula=<span class="hljs-string">&quot;X&quot;</span>,  <br>                    physical_state=PhysicalState.SOLID  <br>                )  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestHazardEntity</span>:  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_hazard_severity_warning</span>(<span class="hljs-params">self, capsys</span>):  <br>        hazard = Hazard(name=<span class="hljs-string">&quot;çˆ†ç‚¸æ€§&quot;</span>, code=<span class="hljs-string">&quot;H204&quot;</span>, severity=<span class="hljs-number">4</span>)  <br>        captured = capsys.readouterr()  <br>        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;è­¦å‘Šï¼šé«˜é£é™©ç­‰çº§ 4&quot;</span> <span class="hljs-keyword">in</span> captured.out<br></code></pre></td></tr></table></figure>

<h3><span id="4-yan-shi-jiao-ben">4. æ¼”ç¤ºè„šæœ¬</span></h3><h4><span id="demo-setup-sample-graph-py"><code>demo/setup_sample_graph.py</code></span></h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio  <br><span class="hljs-keyword">from</span> core.entities <span class="hljs-keyword">import</span> Chemical, PhysicalState, Hazard  <br><span class="hljs-keyword">from</span> core.relations <span class="hljs-keyword">import</span> RelationType  <br><span class="hljs-keyword">from</span> services.graph_service <span class="hljs-keyword">import</span> ChemicalGraphService  <br>  <br>  <br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_sample_data</span>(<span class="hljs-params">service</span>):  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¼€å§‹åˆå§‹åŒ–åŒ–å­¦å“å’Œå±å®³æ•°æ®...&quot;</span>)  <br>  <br>    <span class="hljs-comment"># 1. åˆ›å»ºåŒ–å­¦å“èŠ‚ç‚¹  </span><br>    ethanol = Chemical(  <br>        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CAS64-17-5&quot;</span>,  <br>        name=<span class="hljs-string">&quot;ä¹™é†‡&quot;</span>,  <br>        en_name=<span class="hljs-string">&quot;Ethanol&quot;</span>,  <br>        cas=<span class="hljs-string">&quot;64-17-5&quot;</span>,  <br>        un=<span class="hljs-string">&quot;UN1170&quot;</span>,  <br>        molecular_formula=<span class="hljs-string">&quot;C2H5OH&quot;</span>,  <br>        physical_state=PhysicalState.LIQUID  <br>    )  <br>    oxygen = Chemical(  <br>        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;CAS7782-44-7&quot;</span>,  <br>        name=<span class="hljs-string">&quot;æ°§æ°”&quot;</span>,  <br>        en_name=<span class="hljs-string">&quot;Oxygen&quot;</span>,  <br>        cas=<span class="hljs-string">&quot;7782-44-7&quot;</span>,  <br>        un=<span class="hljs-string">&quot;UN1072&quot;</span>,  <br>        molecular_formula=<span class="hljs-string">&quot;O2&quot;</span>,  <br>        physical_state=PhysicalState.GAS  <br>    )  <br>  <br>    <span class="hljs-comment"># 2. åˆ›å»ºå±å®³èŠ‚ç‚¹  </span><br>    flammability = Hazard(  <br>        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;GHS02&quot;</span>,  <br>        name=<span class="hljs-string">&quot;æ˜“ç‡ƒæ¶²ä½“&quot;</span>,  <br>        code=<span class="hljs-string">&quot;GHS02&quot;</span>,  <br>        severity=<span class="hljs-number">3</span>,  <br>        category=<span class="hljs-string">&quot;physical&quot;</span>  <br>    )  <br>    oxidizer = Hazard(  <br>        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;GHS03&quot;</span>,  <br>        name=<span class="hljs-string">&quot;æ°§åŒ–æ€§æ°”ä½“&quot;</span>,  <br>        code=<span class="hljs-string">&quot;GHS03&quot;</span>,  <br>        severity=<span class="hljs-number">2</span>,  <br>        category=<span class="hljs-string">&quot;physical&quot;</span>  <br>    )  <br>  <br>    <span class="hljs-comment"># ä¿å­˜èŠ‚ç‚¹  </span><br>    <span class="hljs-keyword">await</span> service.create_chemical(ethanol)  <br>    <span class="hljs-keyword">await</span> service.create_chemical(oxygen)  <br>    <span class="hljs-keyword">await</span> service.add_hazard(flammability)  <br>    <span class="hljs-keyword">await</span> service.add_hazard(oxidizer)  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸºç¡€èŠ‚ç‚¹åˆ›å»ºå®Œæˆ&quot;</span>)  <br>  <br>    <span class="hljs-comment"># 3. å»ºç«‹å…³ç³»  </span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nå¼€å§‹å»ºç«‹å…³ç³»...&quot;</span>)  <br>    <span class="hljs-comment"># ä¿®æ”¹è¯æ®æ•°æ®æ ¼å¼ï¼ˆç¡®ä¿æ‰€æœ‰å€¼ä¸ºåŸºæœ¬ç±»å‹ï¼‰  </span><br>    evidence_data = [&#123;  <br>        <span class="hljs-string">&quot;head&quot;</span>: ethanol.<span class="hljs-built_in">id</span>,  <br>        <span class="hljs-string">&quot;relation&quot;</span>: RelationType.HAS_HAZARD.value,  <br>        <span class="hljs-string">&quot;tail&quot;</span>: flammability.<span class="hljs-built_in">id</span>,  <br>        <span class="hljs-string">&quot;modality&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,  <br>        <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;GHSæ ‡å‡†&quot;</span>,  <br>        <span class="hljs-string">&quot;confidence&quot;</span>: <span class="hljs-number">0.95</span>  <span class="hljs-comment"># æ·»åŠ æ•°å€¼ç±»å‹ç¤ºä¾‹  </span><br>    &#125;]  <br>  <br>    <span class="hljs-comment"># åŒ–å­¦å“-å±å®³å…³ç³»  </span><br>    <span class="hljs-keyword">await</span> service.create_relationship(  <br>        source_id=ethanol.<span class="hljs-built_in">id</span>,  <br>        target_id=flammability.<span class="hljs-built_in">id</span>,  <br>        relation_type=RelationType.HAS_HAZARD,  <br>        evidence=evidence_data  <br>    )  <br>  <br>    <span class="hljs-comment"># ä¸ç›¸å®¹å…³ç³»ç¤ºä¾‹  </span><br>    <span class="hljs-keyword">await</span> service.create_relationship(  <br>        source_id=ethanol.<span class="hljs-built_in">id</span>,  <br>        target_id=oxygen.<span class="hljs-built_in">id</span>,  <br>        relation_type=RelationType.INCOMPATIBLE_WITH,  <br>        evidence=[&#123;  <br>            <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;å®éªŒå®¤å®‰å…¨æ‰‹å†Œ&quot;</span>,  <br>            <span class="hljs-string">&quot;reason&quot;</span>: <span class="hljs-string">&quot;æ˜“ç‡ƒç‰©ä¸æ°§åŒ–å‰‚æ¥è§¦å¯èƒ½å¼•å‘ç«ç¾&quot;</span>,  <br>            <span class="hljs-string">&quot;reference&quot;</span>: <span class="hljs-string">&quot;ISO-12345&quot;</span>  <br>        &#125;]  <br>    )  <br>  <br>  <br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_relationships</span>(<span class="hljs-params">service</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;éªŒè¯å…³ç³»ï¼ˆæ˜¾ç¤ºä¸é‡å¤çš„ç»“æœï¼‰&quot;&quot;&quot;</span>  <br>    hazards = <span class="hljs-keyword">await</span> service.get_chemical_hazards(<span class="hljs-string">&quot;CAS64-17-5&quot;</span>)  <br>    incompatibles = <span class="hljs-keyword">await</span> service.find_incompatible_chemicals(<span class="hljs-string">&quot;CAS64-17-5&quot;</span>)  <br>  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¹™é†‡çš„å±å®³å±æ€§: <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>([h.name <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> hazards]))&#125;</span>&quot;</span>)  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¹™é†‡ä¸ç›¸å®¹çš„åŒ–å­¦å“: <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>([c.name <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> incompatibles]))&#125;</span>&quot;</span>)  <br>  <br>  <br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():  <br>    service = ChemicalGraphService()  <br>    <span class="hljs-keyword">try</span>:  <br>        <span class="hljs-keyword">await</span> setup_sample_data(service)  <br>        <span class="hljs-keyword">await</span> verify_relationships(service)  <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¨‹åºå‡ºé”™: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)  <br>    <span class="hljs-keyword">finally</span>:  <br>        <span class="hljs-keyword">await</span> service.close()  <br>  <br>  <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:  <br>    asyncio.run(main())<br></code></pre></td></tr></table></figure>

<h3><span id="5-zong-jie">5.æ€»ç»“</span></h3><p>è‡³æ­¤ï¼Œdemoå·²ç»æ­å»ºå®Œæ¯•ï¼Œæˆ‘ä»¬æˆåŠŸåœ¨neo4jæ•°æ®åº“ä¸Šæ„å»ºäº†ä¸€ä¸ªç®€æ˜“çš„çŸ¥è¯†å›¾è°±ã€‚</p>
<p>æ¥ä¸‹æ¥çš„å·¥ä½œï¼š</p>
<ol>
<li>å°†çˆ¬å–åˆ°çš„æ‰¹é‡çš„æ•°æ®è‡ªåŠ¨åŒ–ç”ŸæˆèŠ‚ç‚¹å’Œå…³ç³»å¹¶æ’å…¥å›¾ç‰‡</li>
<li>ç ”ç©¶å¦‚ä½•å°†å¤šæ¨¡æ€ä¿¡æ¯åŠ å…¥å›¾è°±</li>
</ol>
]]></content>
      <categories>
        <category>çŸ¥è¯†å›¾è°±</category>
        <category>é¡¹ç›®</category>
      </categories>
  </entry>
  <entry>
    <title>Channel</title>
    <url>/2025/08/09/Golang/2025-08-09-Channel/</url>
    <content><![CDATA[<blockquote>
<p>å¯¹äºè¿›ç¨‹é—´é€šä¿¡ä¸èµ„æºäº¤æ¢è¿™ä¸€é—®é¢˜ï¼ŒGo ä½¿ç”¨äº† channel è¿™ä¸€ç±»å‹å®‰å…¨çš„æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç†ã€‚chan æ§åˆ¶ goroutines äº¤äº’çš„èƒ½åŠ›ä»è€Œåˆ›å»ºäº† Go åŒæ­¥æœºåˆ¶ã€‚åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå®¹é‡å¤§å°æ¥åˆ›å»ºæ— ç¼“å†²é€šé“ä¸ç¼“å†²é€šé“ã€‚<br>ä¸‹é¢ï¼Œå°†å¯¹è¿™ä¸¤ç§é€šé“è¿›è¡Œä»‹ç»ï¼Œå¹¶ç»™å‡ºå¸¸è§çš„ä½¿ç”¨æ¨¡å¼</p>
</blockquote>
<h3><span id="unbuffered-channels-wu-huan-chong-tong-dao">Unbuffered Channels ï¼ˆæ— ç¼“å†²é€šé“ï¼‰</span></h3><p>æ— ç¼“å†² chan æ²¡æœ‰å®¹é‡ï¼Œå› æ­¤åœ¨è¿›è¡Œä»»ä½•äº¤æ¢å‰éƒ½éœ€è¦ä¸¤ä¸ª goroutine <strong>åŒæ—¶</strong>å‡†å¤‡å¥½ã€‚è‹¥éå¦‚æ­¤ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li><p>å½“ goroutine è¯•å›¾å°†ä¸€ä¸ªèµ„æºå‘é€åˆ°ä¸€ä¸ªæ— ç¼“å†²çš„é€šé“ï¼ŒåŒæ—¶æ²¡æœ‰ goroutine ç­‰å¾…æ¥æ”¶è¯¥èµ„æºæ—¶ï¼šè¯¥é€šé“å°†é”ä½å‘é€ goroutine å¹¶ä½¿å…¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰ä¸€ä¸ª goroutine å¯¹é€šé“è¿›è¡Œæ¥æ”¶æ“ä½œã€‚</p>
</li>
<li><p>å½“ goroutine å°è¯•ä»æ— ç¼“å†²é€šé“æ¥æ”¶ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸€ä¸ª goroutine ç­‰å¾…å‘é€èµ„æºæ—¶ï¼šè¯¥é€šé“å°†é”ä½æ¥æ”¶ goroutine å¹¶ä½¿å…¶ç­‰å¾…ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ª goroutine å‡†å¤‡å°†ä¸€ä¸ªèµ„æºå‘é€åˆ°é€šé“ã€‚</p>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢çš„ä¸¤ç§æƒ…å†µå¯ä»¥çœ‹å‡ºï¼Œå‘é€å’Œæ¥æ”¶çš„ goroutine ä¸­çš„ä»»æ„ä¸€æ–¹å‡†å¤‡å¥½æ—¶ï¼Œéƒ½å¿…é¡»ç­‰å¾…å¯¹æ–¹ä¹Ÿå‡†å¤‡å¥½æ‰èƒ½è¿›è¡Œèµ„æºçš„äº¤æ¢ã€‚å› æ­¤ï¼Œæ— ç¼“å†²é€šé“çš„æœ¬è´¨æ˜¯<strong>ä¿è¯åŒæ–¹çš„åŒæ­¥</strong>ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼šå¯¹äºæ— ç¼“å†²é€šé“ï¼Œå‘é€æ–¹å°†æŒç»­é˜»å¡ç›´åˆ°æ¥æ”¶æ–¹ä»é€šé“ä¸­æ¥æ”¶åˆ°äº†ä¼ å…¥çš„å€¼ã€‚è¿™ä¿è¯äº†æ¥æ”¶ä¸€å®šå…ˆäºå‘é€å‘ç”Ÿï¼Œç”±æ­¤å¯ä»¥ 100 % ä¿è¯ä¼ å…¥çš„å€¼è¢«æ”¶åˆ°ï¼Œä½†ä»£ä»·æ˜¯æ— æ³•é¢„æµ‹é˜»å¡ï¼ˆå»¶è¿Ÿï¼‰çš„æ—¶é—´ã€‚</p>
<h3><span id="buffered-channels-huan-chong-tong-dao">Buffered Channelsï¼ˆç¼“å†²é€šé“ï¼‰</span></h3><p>ä¸æ— ç¼“å†²é€šé“ç›¸æ¯”ï¼Œç¼“å†²é€šé“å…·æœ‰å®¹é‡ï¼Œå› æ­¤æƒ…å†µä¹Ÿä¼šæœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li><p>å½“ goroutine è¯•å›¾å°†èµ„æºå‘é€åˆ°ç¼“å†²é€šé“ï¼Œä¸”è¯¥é€šé“å·²æ»¡æ—¶ï¼šè¯¥é€šé“å°†é”ä½ goroutine å¹¶ä½¿å…¶ç­‰å¾…ï¼Œç›´åˆ°ç¼“å†²åŒºé‡æ–°æœ‰å¯ç”¨ç©ºé—´ï¼Œï¼ˆæœ‰ goroutine æ¶ˆè´¹äº†é€šé“ä¸­å·²æœ‰çš„èµ„æºï¼‰æ­¤æ—¶å‘é€å¯ç«‹å³è¿›è¡Œï¼Œä¹‹å‰è¢«é”ä½çš„ goroutine å¯ä»¥ç»§ç»­å‘é€šé“å‘é€èµ„æºï¼Œç›´åˆ°é€šé“ç©ºé—´å†æ¬¡è£…æ»¡ã€‚</p>
</li>
<li><p>å½“ goroutine å°è¯•ä»ç¼“å†²é€šé“æ¥æ”¶æ•°æ®ï¼Œè€Œé€šé“ä¸ºç©ºæ—¶ï¼šè¯¥é€šé“å°†é”ä½ goroutine å¹¶ä½¿å…¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰èµ„æºè¢«å‘é€è¿›è¿™ä¸ªé€šé“ã€‚</p>
</li>
</ul>
<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨ chan åˆ›å»ºè¿‡ç¨‹ä¸­å®šä¹‰çš„ç¼“å†²åŒºå¤§å°å¯èƒ½ä¼šæå¤§çš„å½±å“ç¨‹åºæ€§èƒ½ã€‚æ­¤æ—¶é€šå¸¸éœ€è¦ä½¿ç”¨ Benchmark å¯¹ä¸åŒå¤§å°çš„ç¼“å†²åŒºåšä¸€ä¸ªåŸºå‡†æµ‹è¯•ï¼Œæ¥é€‰å–å¤§å°åˆé€‚çš„ç¼“å†²åŒºï¼ˆå¹¶ä¸æ˜¯è¯´ buffer è¶Šå¤§ï¼Œç¨‹åºçš„æ€§èƒ½ä¸€å®šè¶Šå¥½ï¼Œè¿™è§†å‘é€ä¸æ¥æ”¶æ–¹çš„æƒ…å†µè€Œå®šï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸æ— ç¼“å†²é€šé“ç›¸æ¯”ï¼Œç¼“å†²é€šé“çš„å‘é€å…ˆäºæ¥æ”¶å‘ç”Ÿã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å»¶è¿Ÿæ›´å°ï¼Œè€Œä»£ä»·æ˜¯ä¸èƒ½ä¿è¯æ•°æ®åˆ°è¾¾ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼šè¶Šå¤§çš„ bufferï¼Œè¶Šå°çš„ä¿éšœåˆ°è¾¾ã€‚</p>
<h3><span id="shi-yong-tong-dao-de-chang-jian-mo-shi">ä½¿ç”¨é€šé“çš„å¸¸è§æ¨¡å¼</span></h3><h4><span id="1-timing-out">1. Timing out</span></h4><p>ä½¿ç”¨ channels åšä¸€ä¸ªè¶…æ—¶æ§åˆ¶ï¼Œå®˜æ–¹æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><code class="hljs golang">timeout := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>	time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>	timeout &lt;- <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>æˆ‘ä»¬å¸Œæœ›ä»ç®¡é“ ch ä¸­æ¥æ”¶æ•°æ®ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¸Œæœ›æœ€å¤šç­‰å¾…1ç§’é’Ÿã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨å°†æ•°æ®å‘é€åˆ° ch å‰å…ˆåˆ›å»ºä¸€ä¸ªä¿¡å·çš„ç®¡é“ï¼Œå¹¶ä¸”è¿è¡Œä¸€ä¸ª goroutine è¿›è¡Œ1ç§’é’Ÿçš„ä¼‘çœ ã€‚</p>
</blockquote>
<figure class="highlight golang"><table><tr><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ch:<br>	<span class="hljs-comment">// a read from ch has occurred</span><br><span class="hljs-keyword">case</span> &lt;-timeout:<br>	<span class="hljs-comment">// the read from ch has time out</span><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ select è¯­å¥æ¥æ¥æ”¶æ¥è‡ª ch æˆ–è€… timeout çš„æ•°æ®ã€‚å¦‚æœåœ¨1ç§’åæ²¡æœ‰æ•°æ®åˆ°è¾¾ chï¼Œåˆ™ case timeout å°†è¢«é€‰æ‹©å¹¶ä¸”è®¤ä¸ºä» ch è¯»å–æ•°æ®çš„æ“ä½œå¤±è´¥äº†ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œtimeout æ˜¯ä¸€ä¸ªç¼“å†²åŒºå¤§å°ä¸º1çš„ç®¡é“ï¼Œå®ƒå…è®¸è¶…æ—¶çš„ goroutine å‘è¿™ä¸ªç®¡é“å‘é€ä¿¡æ¯å¹¶ç»ˆæ­¢ã€‚ï¼ˆè¿™ä¸ª goroutineï¼‰</p>
</blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://go.dev/blog/concurrency-timeouts">https://go.dev/blog/concurrency-timeouts</a></p>
<h4><span id="2-moving-on">2. Moving on</span></h4><p>è¿™ä¸ªæ¡ˆä¾‹çš„èƒŒæ™¯æ˜¯åŒæ—¶å‘ä¸€ä¸ªæ•°æ®åº“çš„å¤šä¸ªåˆ†è¡¨è¿›è¡Œå¹¶å‘æŸ¥è¯¢ï¼Œè€Œç¨‹åºåªéœ€è¦å…¶ä¸­ä»»ä¸€æŸ¥è¯¢ç»“æœï¼Œå› æ­¤åº”è¯¥æ¥æ”¶æœ€å…ˆåˆ°è¾¾çš„ç»“æœã€‚åŒæ—¶ï¼Œåœ¨æ¥æ”¶åˆ°æŸ¥è¯¢ç»“æœååº”è¯¥å–æ¶ˆå…¶ä»–è¿›è¡Œä¸­çš„æŸ¥è¯¢ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•° Query æ¥æ”¶ä¸€ä¸ªæ•°æ®åº“è¿æ¥çš„åˆ‡ç‰‡å’Œè¦æŸ¥è¯¢çš„å­—ç¬¦ä¸²ã€‚ç„¶åå®ƒå¹¶è¡Œçš„å¯¹æ¯ä¸€ä¸ªæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å¹¶è¿”å›æ¥æ”¶åˆ°çš„æœ€å…ˆå“åº”çš„ç»“æœã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Query</span><span class="hljs-params">(conns []Conn, query <span class="hljs-type">string</span>)</span></span> Result &#123;<br>	ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result)<br>	<span class="hljs-keyword">for</span> _, conn := <span class="hljs-keyword">range</span> conns &#123;<br>		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c Conn)</span></span>&#123;<br>			<span class="hljs-keyword">select</span> &#123;<br>			<span class="hljs-keyword">case</span> ch &lt;- c.DoQuery(query):<br>			defult:<br>			&#125;<br>		&#125;(conn)<br>	&#125;<br>	<span class="hljs-keyword">return</span> &lt;-ch<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>å½“ç¬¬ä¸€ä¸ªæŸ¥è¯¢ç»“æœè¢«å‘é€è¿› ch åï¼Œå…¶ä»–çš„æŸ¥è¯¢å°†ä¼šé€šè¿‡ select è¯­å¥çš„ default é€€å‡ºã€‚</p>
</blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://go.dev/blog/concurrency-timeouts">https://go.dev/blog/concurrency-timeouts</a></p>
<h4><span id="3-pipeline">3. Pipeline</span></h4><p>Go å®˜æ–¹åšå®¢å¯¹äºæµæ°´çº¿çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>æµæ°´çº¿æ˜¯é€šè¿‡ channel è¿æ¥çš„ä¸€ç³»åˆ—é˜¶æ®µï¼Œæ¯ä¸€ä¸ªé˜¶æ®µæ˜¯ä¸€ç»„ goroutine è¿è¡Œçš„ç›¸åŒçš„å‡½æ•°ï¼š</p>
<ul>
<li>é€šè¿‡ç»‘å®šçš„ç®¡é“ä»ä¸Šæ¸¸æ¥æ”¶æ•°æ®</li>
<li>å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¸€èˆ¬æ˜¯ç”Ÿæˆæ–°çš„æ•°æ®</li>
<li>å°†å¤„ç†åçš„æ•°æ®é€šè¿‡ç®¡é“å‘é€åˆ°ä¸‹æ¸¸</li>
</ul>
<p>æµæ°´çº¿æ¨¡å¼æœ€ç»å…¸çš„ä¾‹å­åº”è¯¥å°±æ˜¯ç´ æ•°ç­›äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”Ÿæˆä»2å¼€å§‹çš„è‡ªç„¶æ•°åºåˆ—</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generate</span><span class="hljs-params">()</span></span> &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span> &#123;<br>	ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		<span class="hljs-keyword">for</span> i := <span class="hljs-number">2</span>; i ++ &#123;<br>			ch &lt;- i<br>		&#125;<br>	&#125;()<br>	<span class="hljs-keyword">return</span> ch<br>&#125;<br><br><span class="hljs-comment">// è¿‡æ»¤å™¨ï¼Œå°†å¯ä»¥è¢« prime æ•´é™¤çš„æ•°è¿‡æ»¤</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filter</span><span class="hljs-params">(in &lt;- <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, prime <span class="hljs-type">int</span>)</span></span> &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span> &#123;<br>	out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		<span class="hljs-keyword">for</span> &#123; <br>			num := &lt;- in<br>			<span class="hljs-keyword">if</span> num % prime != <span class="hljs-number">0</span>&#123;<br>				out &lt;- num	<br>			&#125;<br>		&#125;<br>	&#125;()<br>	<span class="hljs-keyword">return</span> out<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sieve</span><span class="hljs-params">()</span></span> &lt;- <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span> &#123;<br>	out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		ch := generate()<br>		<span class="hljs-keyword">for</span> &#123;<br>			prime := &lt;-ch<br>			out &lt;- prime<br>			ch = filter(ch, prime) <span class="hljs-comment">// ç”¨å½“å‰ç´ æ•°è¿‡æ»¤è¾“å…¥æµ</span><br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	primes := sieve()<br>	<span class="hljs-comment">// æ‰“å°å‡ºå‰100ä¸ªç´ æ•°</span><br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i ++ &#123;<br>		fmt.Println(&lt;- primes)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ sieve å‡½æ•°ä¸­ï¼Œprime ä»ä¸Šæ¸¸ç®¡é“æ¥æ”¶ç”Ÿæˆå™¨æ„é€ çš„è‡ªç„¶æ•°ï¼Œå°†å…¶è¿›è¡Œè¿‡æ»¤åä¼ è¾“ç»™ä¸‹æ¸¸ã€‚</p>
</blockquote>
<h4><span id="4-fan-out-fan-in">4. Fan-out, Fan-in</span></h4><h4><span id="5-cancellation">5. Cancellation</span></h4><h4><span id="6-contex">6. Contex</span></h4><h3><span id="she-ji-yuan-ze">è®¾è®¡åŸåˆ™</span></h3><ul>
<li><p>å¦‚æœä»»æ„ä¸€ä¸ªå‘é€šé“çš„å‘é€å¯ä»¥å¯¼è‡´å‘é€ goroutine è¢«é˜»å¡ï¼Œä½ éœ€è¦è€ƒè™‘ï¼š</p>
<ul>
<li>ä¸èƒ½ä½¿ç”¨ç¼“å†²æ•°å¤§äº1çš„é€šé“ï¼ˆå¦‚æœéœ€è¦ï¼Œä½ å¿…é¡»èƒ½è¯´æ˜è¿™æ ·åšçš„ç†ç”±ï¼‰</li>
<li>å¿…é¡»çŸ¥é“å½“å‘é€ goroutine è¢«é˜»å¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼ˆæ˜¯å¦éœ€è¦å¤„ç† &#x2F; æ€ä¹ˆå¤„ç† &#x2F; æ˜¯å¦ç¬¦åˆé¢„æœŸï¼‰</li>
</ul>
</li>
<li><p>å¦‚æœä»»æ„ä¸€ä¸ªå‘é€šé“çš„å‘é€ä¸ä¼šå¯¼è‡´å‘é€ goroutine è¢«é˜»å¡ï¼Œä½ éœ€è¦è€ƒè™‘ï¼š</p>
<ul>
<li>ä½ ä¸ºæ¯ä¸€ä¸ªå‘é€è®¾æœ‰é¢å¤–çš„ç¼“å†²åŒºï¼ˆæ¯”å¦‚ Fan Out æ¨¡å¼ï¼‰</li>
<li>ä½ èƒ½å¯¹å¤„äºæœ€å¤§å®¹é‡çš„ç¼“å†²åŒºè¿›è¡Œç›¸åº”çš„å¤„ç†ï¼ˆæ˜¯å°†æ•°æ®ä¸¢å¼ƒè¿˜æ˜¯ç»§ç»­ç­‰å¾…ï¼‰</li>
</ul>
</li>
<li><p>å¯¹äºç¼“å†²æ¥è¯´ï¼Œå°‘å³æ˜¯å¤šï¼ˆLess is moreï¼‰ï¼š</p>
<ul>
<li>ä¸è¦å°†ç¼“å†²çš„å¤§å°ä¸æ€§èƒ½æŒ‚é’©</li>
<li>ç¼“å†²å¯ä»¥å‡å°‘ goroutine å”¤é†’çš„æˆæœ¬</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>SwissMap</title>
    <url>/2025/09/17/Golang/2025-09-17-SwissMap/</url>
    <content><![CDATA[<blockquote>
<p>Go 1.23 åœ¨<code>runtime</code>åŒ…ä¸­å¼•å…¥äº†æ–°çš„ SwissMap å®ç°ï¼Œè¿™æ˜¯ Go å›¢é˜ŸåŸºäº Google çš„ SwissTable è®¾è®¡ç†å¿µå¼€å‘çš„æ–°å“ˆå¸Œè¡¨å®ç°ï¼Œæ—¨åœ¨æä¾›æ›´å¥½çš„æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚</p>
</blockquote>
<h3><span id="go-swissmap-he-xin-shu-ju-jie-gou">Go SwissMap æ ¸å¿ƒæ•°æ®ç»“æ„</span></h3><h4><span id="1-ding-ceng-ha-xi-biao-jie-gou-hmap">1.é¡¶å±‚å“ˆå¸Œè¡¨ç»“æ„-hmap</span></h4><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> hmap <span class="hljs-keyword">struct</span> &#123;<br>    count     <span class="hljs-type">int</span>       <span class="hljs-comment">// å½“å‰å…ƒç´ æ•°é‡</span><br>    flags     <span class="hljs-type">uint8</span>     <span class="hljs-comment">// çŠ¶æ€æ ‡å¿—ä½</span><br>    B         <span class="hljs-type">uint8</span>     <span class="hljs-comment">// æ¡¶æ•°é‡çš„å¯¹æ•° (2^B ä¸ªæ¡¶)</span><br>    noverflow <span class="hljs-type">uint16</span>    <span class="hljs-comment">// æº¢å‡ºæ¡¶æ•°é‡</span><br>    hash0     <span class="hljs-type">uint32</span>    <span class="hljs-comment">// å“ˆå¸Œç§å­</span><br>    <br>    <span class="hljs-comment">// SwissMap æ–°å¢çš„æ ¸å¿ƒå­—æ®µ</span><br>    metadata  unsafe.Pointer <span class="hljs-comment">// æŒ‡å‘å…ƒæ•°æ®æ•°ç»„çš„æŒ‡é’ˆ</span><br>    buckets   unsafe.Pointer <span class="hljs-comment">// æŒ‡å‘æ¡¶æ•°ç»„çš„æŒ‡é’ˆ</span><br>    oldbuckets unsafe.Pointer <span class="hljs-comment">// æ‰©å®¹æ—¶çš„æ—§æ¡¶æ•°ç»„</span><br>    nevacuate  <span class="hljs-type">uintptr</span>       <span class="hljs-comment">// æ‰©å®¹è¿›åº¦è®¡æ•°å™¨</span><br>    <br>    <span class="hljs-comment">// SIMD ç›¸å…³å­—æ®µ</span><br>    groupSize <span class="hljs-type">uintptr</span>       <span class="hljs-comment">// SIMD ç»„å¤§å°ï¼ˆé€šå¸¸æ˜¯16ï¼‰</span><br>    ctrlBytes []<span class="hljs-type">byte</span>        <span class="hljs-comment">// æ§åˆ¶å­—èŠ‚æ•°ç»„</span><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºæ™®é€šçš„ Mapï¼ŒSwissMap æ–°å¢äº†ä¸€ä¸ªæŒ‡å‘å…ƒæ•°æ®æ•°ç»„çš„æŒ‡é’ˆ<code>metadata</code>å’Œç”¨äº SIMD æŸ¥è¯¢çš„ç›¸å…³å­—æ®µ</p>
</blockquote>
<h4><span id="2-yuan-shu-ju-kong-zhi-jie-gou">2.å…ƒæ•°æ®æ§åˆ¶ç»“æ„</span></h4><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æ§åˆ¶å­—èŠ‚çš„è¯­ä¹‰ï¼ˆæ¯ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªæ§½ä½ï¼‰</span><br><span class="hljs-keyword">const</span> (<br>    ctrlEmpty   = <span class="hljs-number">0x00</span> <span class="hljs-comment">// ç©ºæ§½ä½</span><br>    ctrlDeleted = <span class="hljs-number">0xFE</span> <span class="hljs-comment">// å·²åˆ é™¤æ§½ä½</span><br>    ctrlSentinel = <span class="hljs-number">0xFF</span> <span class="hljs-comment">// å“¨å…µå€¼ï¼ˆç”¨äºSIMDï¼‰</span><br>    <span class="hljs-comment">// å…¶ä»–å€¼: å“ˆå¸Œå€¼çš„é«˜7ä½</span><br>)<br><br><span class="hljs-comment">// å…ƒæ•°æ®ç»„ï¼ˆç¼“å­˜è¡Œå¯¹é½ï¼‰</span><br><span class="hljs-keyword">type</span> metadataGroup <span class="hljs-keyword">struct</span> &#123;<br>    ctrl [<span class="hljs-number">16</span>]<span class="hljs-type">uint8</span>  <span class="hljs-comment">// 16å­—èŠ‚çš„æ§åˆ¶ä¿¡æ¯ï¼ˆSIMDå‹å¥½ï¼‰</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4><span id="3-tong-jie-gou-bmap">3.æ¡¶ç»“æ„-bmap</span></h4><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> bmap <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">// å…ƒæ•°æ®éƒ¨åˆ†ï¼ˆå•ç‹¬å­˜å‚¨ä»¥æé«˜ç¼“å­˜æ•ˆç‡ï¼‰</span><br>    tophash [bucketCnt]<span class="hljs-type">uint8</span> <span class="hljs-comment">// æ—§ç‰ˆå…¼å®¹å­—æ®µ</span><br>    <br>    <span class="hljs-comment">// é”®å€¼å¯¹æ•°æ®ï¼ˆå®é™…å­˜å‚¨æ—¶å¯èƒ½åˆ†å¼€ï¼‰</span><br>    keys   [bucketCnt]keytype   <span class="hljs-comment">// é”®æ•°ç»„</span><br>    values [bucketCnt]valuetype <span class="hljs-comment">// å€¼æ•°ç»„</span><br>    <br>    <span class="hljs-comment">// æº¢å‡ºæ¡¶æŒ‡é’ˆ</span><br>    overflow *bmap<br>&#125;<br></code></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>syncåŒ…</title>
    <url>/2025/09/29/Golang/2025-09-29-sync%E5%8C%85/</url>
    <content><![CDATA[<blockquote>
<p>Go æ ‡å‡†åº“çš„syncåŒ…æä¾›äº†é’ˆå¯¹ä¼ ç»ŸåŸºäºå…±äº«å†…å­˜å¹¶å‘æ¨¡å‹çš„åŸºæœ¬åŒæ­¥åŸè¯­ï¼ŒåŒ…æ‹¬äº’æ–¥é”ï¼ˆsync.Mutexï¼‰ã€è¯»å†™é”ï¼ˆsync.RWMutexï¼‰ã€æ¡ä»¶å˜é‡ï¼ˆsync.Condï¼‰ç­‰å·¥å…·ã€‚</p>
</blockquote>
<h3><span id="sync-mutex-de-ding-yi">sync.Mutex çš„å®šä¹‰ï¼š</span></h3><figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Mutex <span class="hljs-keyword">struct</span> &#123;<br>	state <span class="hljs-type">int32</span><br>	sema  <span class="hljs-type">uint32</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>stateï¼šè¡¨ç¤ºå½“å‰äº’æ–¥é”çš„çŠ¶æ€</li>
<li>semaï¼šç”¨äºæ§åˆ¶é”çŠ¶æ€çš„ä¿¡å·é‡</li>
</ul>
<p>ç”± Mutex çš„å®šä¹‰ï¼Œä¸‹é¢å¼•å‡ºåœ¨ä½¿ç”¨ sync åŒ…æ—¶éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<p><strong>ä¸è¦åœ¨é¦–æ¬¡ä½¿ç”¨ sync åŒ…ä¸­å®šä¹‰çš„ç»“æ„ç±»å‹åå¯¹å…¶è¿›è¡Œå¤åˆ¶æ“ä½œ</strong></p>
<blockquote>
<p>è¿™æ ·ä¼šå°†ä½¿ç”¨è¿‡çš„é”çš„çŠ¶æ€ä¸€åŒå¤åˆ¶ï¼Œå¯èƒ½ä¼šé€ æˆæ­»é”ç­‰ä¸å¯é¢„æœŸçš„ç»“æœã€‚<br>å› æ­¤åœ¨ä½¿ç”¨ sync åŒ…ä¸­ç±»å‹æ—¶ï¼Œæ›´åº”è¯¥é€šè¿‡<strong>é—­åŒ…</strong>æˆ–<strong>ä¼ é€’æŒ‡é’ˆ</strong>çš„æ–¹å¼è¿›è¡Œã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[å¤ç›˜]æ··åˆæ¶æ„ï¼šä»é›¶æ„å»ºChimera-RAGï¼ˆv0.1.0ï¼‰å¼€å‘å¤ç›˜</title>
    <url>/2025/12/26/%E9%A1%B9%E7%9B%AE%E5%A4%8D%E7%9B%98/Chimera-RAG/2025-12-26-%5B%E5%A4%8D%E7%9B%98%5D%E6%B7%B7%E5%90%88%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BAChimera-RAG%EF%BC%88v0.1.0%EF%BC%89%E5%BC%80%E5%8F%91%E5%A4%8D%E7%9B%98/</url>
    <content><![CDATA[<blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šåœ¨ EHS å®‰å…¨åˆè§„é¢†åŸŸï¼Œå¦‚ä½•è®© AI çœŸæ­£â€œè¯»æ‡‚â€æ™¦æ¶©çš„æ³•è§„æ–‡æ¡£ï¼Ÿæœ¬æ–‡è®°å½•äº†æˆ‘åŸºäº <strong>Go (ç½‘å…³) + Python (å¤§è„‘)</strong> æ··åˆæ¶æ„ï¼Œç»“åˆ <strong>Qdrant</strong> ä¸ <strong>DeepSeek</strong>ï¼Œæ„å»º RAG ç³»ç»Ÿçš„å…¨è¿‡ç¨‹ã€‚ä» gRPC çš„ 4MB é™åˆ¶åˆ°ä¸Šä¸‹æ–‡çª—å£çš„è°ƒä¼˜ï¼Œå¤ç›˜ v0.1.0 ç‰ˆæœ¬çš„å…³é”®æŠ€æœ¯å†³ç­–ä¸å®æˆ˜è¸©å‘ã€‚</p>
</blockquote>
<h2><span id="1-yuan-qi-dang-go-de-kuai-yu-shang-python-de-zhi">1. ç¼˜èµ·ï¼šå½“ Go çš„å¿«é‡ä¸Š Python çš„æ™º</span></h2><p>åœ¨æ„å»ºä¸€ä¸ªå‚ç›´é¢†åŸŸçš„ RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) ç³»ç»Ÿæ—¶ï¼ŒæŠ€æœ¯é€‰å‹å¾€å¾€é¢ä¸´ä¸¤éš¾ï¼š</p>
<ul>
<li><p><strong>å…¨ Python æ ˆ</strong>ï¼ˆå¦‚ LangChain ç”Ÿæ€ï¼‰ï¼šAI ç»„ä»¶å¼€ç®±å³ç”¨ï¼Œä½†åœ¨å¤„ç†é«˜å¹¶å‘ HTTP è¯·æ±‚ã€å¤§æ–‡ä»¶ I&#x2F;O ååæ—¶ï¼Œæ€§èƒ½ä¸èµ„æºå ç”¨å¾€å¾€æˆä¸ºç“¶é¢ˆã€‚</p>
</li>
<li><p><strong>å…¨ Go æ ˆ</strong>ï¼šæ‹¥æœ‰æè‡´çš„å¹¶å‘æ€§èƒ½å’Œæä½çš„éƒ¨ç½²æˆæœ¬ï¼Œä½†ç¼ºä¹æˆç†Ÿçš„ PDF æ·±åº¦è§£æã€Agent ç¼–æ’ç­‰ AI ç”Ÿæ€ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†å…¼é¡¾æ€§èƒ½ä¸ç”Ÿæ€ï¼Œæˆ‘å†³å®šé‡‡ç”¨<strong>å¼‚æ„æ··åˆæ¶æ„</strong>æ¥æ„å»º <strong>Chimera-RAG</strong>ï¼ˆå¥‡ç¾æ‹‰ï¼‰ã€‚ <strong>Chimera</strong> å¯“æ„ç€é›†å„å®¶æ‰€é•¿çš„æ··åˆä½“â€”â€”åˆ©ç”¨ <strong>Go</strong> å¤„ç†é«˜å¹¶å‘ç½‘å…³ä¸ä»»åŠ¡è°ƒåº¦ï¼Œåˆ©ç”¨ <strong>Python</strong> å¤„ç†å¤æ‚çš„æ–‡æ¡£è§£æä¸æ¨ç†ï¼Œä¸¤è€…é€šè¿‡ <strong>gRPC</strong> ç´§å¯†åä½œï¼Œå–é•¿è¡¥çŸ­ã€‚</p>
<hr>
<h2><span id="2-jia-gou-shen-du-jie-xi-v0-1-0">2. æ¶æ„æ·±åº¦è§£æ (v0.1.0)</span></h2><p>Chimera-RAG ä¸æ˜¯ä¸€ä¸ªå•ä½“åº”ç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¸å‹çš„å¾®æœåŠ¡æ¶æ„ã€‚æˆ‘ä»¬å°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå››ä¸ªæ ¸å¿ƒå±‚çº§ï¼Œæ¯ä¸€å±‚å„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<p><img src="https://oss-pai-ou3opkiglu3o9cspyq-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/blog/Chimera-%20RAG%20v0.1.0.png" alt="Chimera- RAG v0.1.0.png"></p>
<h4><span id="2-1-jie-ru-ceng-gateway-layer-go-de-zhu-chang">2.1 æ¥å…¥å±‚ (Gateway Layer) - Go çš„ä¸»åœº</span></h4><ul>
<li><p><strong>æŠ€æœ¯æ ˆ</strong>: Go (Gin) + SSE (Server-Sent Events)</p>
</li>
<li><p><strong>èŒè´£</strong>:</p>
<ul>
<li><p>ä½œä¸ºç³»ç»Ÿçš„â€œå®ˆé—¨å‘˜â€ï¼Œå¤„ç†æ‰€æœ‰ HTTP è¯·æ±‚ã€é‰´æƒä¸æµæ§ã€‚</p>
</li>
<li><p><strong>é›¶æ‹·è´ä¸Šä¼ </strong>: æ¥æ”¶å‰ç«¯çš„å¤§æ–‡ä»¶æµï¼Œç›´æ¥Pipeåˆ° MinIO å¯¹è±¡å­˜å‚¨ï¼Œæœ€å°åŒ–å†…å­˜å ç”¨ã€‚</p>
</li>
<li><p><strong>é•¿è¿æ¥ç®¡ç†</strong>: ç»´æŒä¸å‰ç«¯çš„ SSE è¿æ¥ï¼Œåƒâ€œæ‰“å­—æœºâ€ä¸€æ ·å®æ—¶æ¨é€ AI çš„æ€è€ƒè¿‡ç¨‹ä¸å›ç­”ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è®¾è®¡æ€è€ƒ</strong>: è¿™ä¸€å±‚é€‰ Go æ˜¯æ— æ¯”æ­£ç¡®çš„ã€‚Goroutine æä½çš„åˆ‡æ¢æˆæœ¬ï¼Œä½¿å…¶åœ¨å¤„ç†æµ·é‡å¹¶å‘è¿æ¥å’Œ I&#x2F;O å¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œæ€§èƒ½è¿œè¶… Python çš„ asyncio æˆ–çº¿ç¨‹æ± æ–¹æ¡ˆã€‚ä¹‹åæœ‰æ—¶é—´ä¼šè€ƒè™‘åšä¸ªbenchmarkè¿›è¡Œç²¾ç»†å¯¹æ¯”ã€‚</p>
</li>
</ul>
<h4><span id="2-2-ren-wu-diao-du-ceng-scheduling-layer-yi-bu-jie-ou">2.2 ä»»åŠ¡è°ƒåº¦å±‚ (Scheduling Layer) - å¼‚æ­¥è§£è€¦</span></h4><ul>
<li><p><strong>æŠ€æœ¯æ ˆ</strong>: Redis (List&#x2F;PubSub) + Go Worker Pool</p>
</li>
<li><p><strong>èŒè´£</strong>:</p>
<ul>
<li><p>å®ç°<strong>ç”¨æˆ·ä½“éªŒä¸ç¹é‡è®¡ç®—çš„è§£è€¦</strong>ã€‚å‰ç«¯ä¸Šä¼ æ–‡ä»¶åï¼ŒGo ç½‘å…³å¹¶ä¸ç­‰å¾…è§£æå®Œæˆï¼Œè€Œæ˜¯å°†ä»»åŠ¡ä¸¢è¿› Redis é˜Ÿåˆ—å¹¶ç«‹å³è¿”å›â€œä¸Šä¼ æˆåŠŸâ€ã€‚</p>
</li>
<li><p>åå°çš„ Go Worker é»˜é»˜æ¶ˆè´¹ä»»åŠ¡ï¼Œè´Ÿè´£åè°ƒæ•°æ®çš„æµåŠ¨ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è®¾è®¡æ€è€ƒ</strong>: å¦‚æœæ²¡æœ‰è¿™ä¸€å±‚ï¼Œè§£æä¸€ä¸ª 500 é¡µçš„ PDF ä¼šå¯¼è‡´æµè§ˆå™¨é•¿æ—¶é—´è½¬åœˆç­‰å¾…ã€‚å¼‚æ­¥åŒ–æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®ä¸€æ­¥ã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨æ—¶ä¹Ÿæš´éœ²äº†æ–°çš„é—®é¢˜ï¼šæ²¡æœ‰åšæ‰¹é‡ä¸Šä¼ å’Œæ–‡æ¡£å½’ç±»ï¼Œä¼šè€ƒè™‘åœ¨åç»­è¿›è¡Œä¼˜åŒ–ã€‚</p>
</li>
</ul>
<h4><span id="2-3-ren-zhi-ji-suan-ceng-cognitive-layer-python-de-wu-tai">2.3 è®¤çŸ¥è®¡ç®—å±‚ (Cognitive Layer) - Python çš„èˆå°</span></h4><ul>
<li><p><strong>æŠ€æœ¯æ ˆ</strong>: Python + gRPC + PyMuPDF + SentenceTransformers</p>
</li>
<li><p><strong>èŒè´£</strong>:</p>
<ul>
<li><p>å®ƒæ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£â€œè„æ´»ç´¯æ´»â€ã€‚æ¥æ”¶ Go ä¼ æ¥çš„æ–‡ä»¶æµï¼Œåˆ©ç”¨ <code>PyMuPDF</code> å°† PDFâ€œåš¼ç¢â€æˆæ–‡æœ¬åˆ‡ç‰‡ï¼Œå†è°ƒç”¨ Embedding æ¨¡å‹å°†å…¶å‘é‡åŒ–ã€‚</p>
</li>
<li><p>é€šè¿‡ <strong>gRPC Server</strong> æš´éœ²å†…éƒ¨èƒ½åŠ›ï¼Œä¾› Go Worker è°ƒç”¨ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è®¾è®¡æ€è€ƒ</strong>: é€‰æ‹© gRPC è€Œä¸æ˜¯ HTTP RESTfulï¼Œæ˜¯ä¸ºäº†åˆ©ç”¨ Protobuf çš„é«˜æ•ˆåºåˆ—åŒ–å’Œ HTTP&#x2F;2 çš„å¤šè·¯å¤ç”¨ç‰¹æ€§ï¼Œç¡®ä¿åœ¨å†…éƒ¨æœåŠ¡é—´ä¼ è¾“å¤§æ–‡æœ¬å’Œå‘é‡æ•°æ®æ—¶çš„é«˜æ€§èƒ½ã€‚</p>
</li>
</ul>
<h4><span id="2-4-ji-yi-yu-sheng-cheng-ceng-memory-amp-generation">2.4 è®°å¿†ä¸ç”Ÿæˆå±‚ (Memory &amp; Generation)</span></h4><ul>
<li><p><strong>æŠ€æœ¯æ ˆ</strong>: Qdrant + DeepSeek V3 API</p>
</li>
<li><p><strong>èŒè´£</strong>:</p>
<ul>
<li><p><strong>Qdrant</strong>: å­˜å‚¨å‘é‡åŒ–çš„â€œé•¿æœŸè®°å¿†â€ã€‚æˆ‘ä»¬åœ¨ Payload ä¸­å­˜å‚¨äº† PageNumber å’ŒåŸæ–‡ç‰‡æ®µï¼Œè¿™æ˜¯å®ç°â€œå¼•ç”¨æº¯æºâ€çš„åŸºç¡€ã€‚</p>
</li>
<li><p><strong>DeepSeek</strong>: æœ€ç»ˆçš„â€œè¡¨è¾¾è€…â€ã€‚å®ƒåŸºäºæˆ‘ä»¬æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œç»„ç»‡è¯­è¨€å›ç­”ç”¨æˆ·ï¼Œå¹¶æ”¯æŒ Markdown æ ¼å¼è¾“å‡ºã€‚</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2><span id="3-guan-jian-ji-zhu-tiao-zhan-yu-cai-keng-shi-lu">3. å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸â€œè¸©å‘â€å®å½•</span></h2><p>v0.1.0 çš„å¼€å‘å¹¶éä¸€å¸†é£é¡ºï¼Œä»¥ä¸‹æ˜¯ä¸‰ä¸ªå°è±¡æœ€æ·±åˆ»çš„æŠ€æœ¯å¡ç‚¹ä¸è§£å†³æ–¹æ¡ˆã€‚</p>
<h3><span id="3-1-grpc-de-4mb-yin-xing-qiang">3.1 gRPC çš„â€œ4MBâ€éšå½¢å¢™</span></h3><ul>
<li><p><strong>ç°è±¡</strong>ï¼šåœ¨æµ‹è¯•ä¸Šä¼ æˆ‘çš„ç¡•å£«å¼€é¢˜æŠ¥å‘Šï¼ˆçº¦ 8.5MBï¼‰æ—¶ï¼ŒPython gRPC Server æŠ›å‡ºäº† <code>ResourceExhausted</code> é”™è¯¯ï¼Œæ‹’ç»æ¥æ”¶ã€‚</p>
</li>
<li><p><strong>æ ¹å› </strong>ï¼šgRPC é»˜è®¤é™åˆ¶å•æ¬¡æ¶ˆæ¯å¤§å°ä¸º 4MB (4,194,304 bytes)ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„å¾®æœåŠ¡é€šä¿¡é™·é˜±ã€‚</p>
</li>
<li><p><strong>è§£å†³</strong>ï¼šéœ€è¦åœ¨ Python Server ç«¯å’Œ Go Client ç«¯åŒæ—¶ä¿®æ”¹é…ç½®ã€‚</p>
<ul>
<li><p><strong>Go Client</strong>: åœ¨ <code>grpc.Dial</code> æ—¶æ·»åŠ  <code>grpc.WithDefaultCallOptions(grpc.MaxCallRecvMsgSize(100*1024*1024), ...)</code>ã€‚</p>
</li>
<li><p><strong>Python Server</strong>: åœ¨ <code>grpc.server</code> åˆå§‹åŒ–æ—¶æ·»åŠ  <code>options=[(&#39;grpc.max_receive_message_length&#39;, 100*1024*1024), ...]</code>ã€‚</p>
</li>
<li><p>å°†é˜ˆå€¼ç»Ÿä¸€æå‡è‡³ 100MBï¼Œä»¥é€‚åº”æœªæ¥çš„é«˜æ¸…æ‰«æä»¶éœ€æ±‚ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3><span id="3-2-huan-jue-zhi-li-yu-shang-xia-wen-chuang-kou-diao-you">3.2 â€œå¹»è§‰â€æ²»ç†ä¸ä¸Šä¸‹æ–‡çª—å£è°ƒä¼˜</span></h3><ul>
<li><p><strong>ç°è±¡</strong>ï¼šèµ·åˆï¼Œå¯¹äºä¸€äº›ç»†èŠ‚é—®é¢˜ï¼ŒDeepSeek çš„å›ç­”éå¸¸ç©ºæ³›ï¼Œç”šè‡³æç¤ºâ€œæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ— æ³•å›ç­”â€ã€‚</p>
</li>
<li><p><strong>æ ¹å› </strong>ï¼š</p>
<ol>
<li><p><strong>æ£€ç´¢é‡ä¸è¶³</strong>ï¼šä¸ºäº†çœ Tokenï¼Œæœ€åˆåªæ£€ç´¢äº† <code>TopK=3</code> ä¸ªåˆ‡ç‰‡ï¼Œå¯¼è‡´å…³é”®ä¿¡æ¯é—æ¼ã€‚</p>
</li>
<li><p><strong>Prompt ç»“æ„å•ä¸€</strong>ï¼šåªå–‚ç»™äº†æ¨¡å‹çº¯æ–‡æœ¬ï¼Œæ²¡æœ‰åŒ…å«é¡µç ç­‰å…ƒæ•°æ®ï¼Œæ¨¡å‹æ— æ³•å»ºç«‹ç©ºé—´æ„Ÿã€‚</p>
</li>
</ol>
</li>
<li><p><strong>è§£å†³</strong>ï¼š</p>
<ol>
<li><p><strong>æ‰©å¤§è§†é‡</strong>ï¼šå……åˆ†åˆ©ç”¨ DeepSeek V3 çš„é•¿ä¸Šä¸‹æ–‡èƒ½åŠ›å’Œä½æˆæœ¬ä¼˜åŠ¿ï¼Œå°† <code>TopK</code> æå‡è‡³ 15ã€‚</p>
</li>
<li><p><strong>ç»“æ„åŒ– Prompt</strong>ï¼šé‡æ„æç¤ºè¯æ¨¡æ¿ï¼Œæ˜¾å¼æ³¨å…¥ç»“æ„åŒ–ä¿¡æ¯ï¼š</p>
 <figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli">èƒŒæ™¯çŸ¥è¯†ï¼š<br>[ç‰‡æ®µ1] <span class="hljs-params">(ç¬¬5é¡µ)</span>: <span class="hljs-string">...</span>åŸæ–‡å†…å®¹<span class="hljs-string">...</span><br>[ç‰‡æ®µ2] <span class="hljs-params">(ç¬¬8é¡µ)</span>: <span class="hljs-string">...</span>åŸæ–‡å†…å®¹<span class="hljs-string">...</span><br><span class="hljs-string">...</span><br>ç”¨æˆ·é—®é¢˜ï¼šxxx<br></code></pre></td></tr></table></figure>
<p> è¿™æ˜¾è‘—æå‡äº†å›ç­”çš„å‡†ç¡®ç‡å’Œâ€œå¼•ç”¨æ„Ÿâ€ã€‚</p>
</li>
</ol>
</li>
</ul>
<h3><span id="3-3-ji-su-qian-duan-yan-zheng-bi-huan">3.3 æé€Ÿå‰ç«¯ï¼šéªŒè¯é—­ç¯</span></h3><ul>
<li><p><strong>èƒŒæ™¯</strong>ï¼šç”±äºåç«¯è¿›åº¦è¿‡å¿«ï¼Œä¸ºäº†éªŒè¯å…¨é“¾è·¯é—­ç¯ï¼Œéœ€è¦å¿«é€Ÿæ­å»ºä¸€ä¸ªå‰ç«¯ç•Œé¢ã€‚</p>
</li>
<li><p><strong>è§£å†³</strong>ï¼šåŸºäº <strong>Vite + Vue 3 + Arco Design</strong>ï¼Œå®Œæˆäº†ä¸€ä¸ªå•é¡µåº”ç”¨ã€‚åˆ©ç”¨ <code>@microsoft/fetch-event-source</code> åº“å®Œç¾å¤„ç†äº†åç«¯çš„ SSE æµå¼å“åº”ï¼Œé…åˆ <code>markdown-it</code> å®ç°äº†ç±»ä¼¼ ChatGPT çš„é€å­—æ‰“å°æ¸²æŸ“æ•ˆæœã€‚è¿™è¯æ˜äº†å…¨æ ˆèƒ½åŠ›åœ¨å¿«é€ŸåŸå‹éªŒè¯ä¸­çš„é‡è¦æ€§ã€‚</p>
</li>
</ul>
<hr>
<h2><span id="4-cheng-guo">4. æˆæœ</span></h2><p>ç›®å‰ï¼ŒChimera-RAG çš„ v0.1.0 ç‰ˆæœ¬å·²ç»å…·å¤‡äº†â€œçœŸå®é˜…è¯»èƒ½åŠ›â€ã€‚å®ƒä¸å†æ˜¯ç®€å•åœ°æ ¹æ®æ–‡ä»¶åçŒœç­”æ¡ˆï¼Œè€Œæ˜¯èƒ½ç²¾å‡†å®šä½åˆ° PDF æ–‡æ¡£ä¸­çš„å…·ä½“æ®µè½ï¼Œå¹¶ç»“åˆä¸Šä¸‹æ–‡è¿›è¡Œæ¨ç†ã€‚</p>
<hr>
<h2><span id="5-zhan-wang-v0-2-0">5. å±•æœ› v0.2.0</span></h2><p>v0.1.0 çš„æˆåŠŸéªŒè¯äº†å¼‚æ„æ¶æ„çš„å¯è¡Œæ€§ï¼Œä½†ä¹Ÿæš´éœ²äº† MVP ä¸ä¼ä¸šçº§äº§å“ä¹‹é—´çš„å·®è·ã€‚ä¸ºäº†æ„å»ºæ›´å¼ºå¤§ã€æ›´å®‰å…¨çš„çŸ¥è¯†åº“å¹³å°ï¼Œv0.2.0 çš„æŠ€æœ¯æ¼”è¿›è·¯çº¿å·²è§„åˆ’å®Œæ¯•ï¼š</p>
<ul>
<li><p><strong>æ•°æ®åŸºåº§å‡çº§</strong>ï¼š</p>
<ul>
<li><p>å¼•å…¥ <strong>PostgreSQL</strong>ï¼šå­˜å‚¨ç”¨æˆ·ä½“ç³»ã€ç»„ç»‡æ¶æ„åŠæ–‡ä»¶å¤¹ç›®å½•æ ‘ï¼Œå®ç° RBAC æƒé™æ§åˆ¶ã€‚</p>
</li>
<li><p>å¼•å…¥ <strong>NebulaGraph</strong>ï¼šæ„å»ºé¢†åŸŸçŸ¥è¯†å›¾è°±ï¼Œå®ç° GraphRAGï¼Œæå‡å¯¹å¤æ‚å®ä½“å…³ç³»çš„æ¨ç†èƒ½åŠ›ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è§£æèƒ½åŠ›è¿›åŒ–</strong>ï¼š</p>
<ul>
<li>é’ˆå¯¹ç›®å‰ PyMuPDF å¯¹è¡¨æ ¼å’Œå¤šæ æ’ç‰ˆæ”¯æŒä¸ä½³çš„é—®é¢˜ï¼Œè®¡åˆ’åˆ‡æ¢è‡³ SOTA æ–¹æ¡ˆ <strong>Docling</strong> æˆ– <strong>Unstructured</strong>ï¼Œå®ç°æ–‡æ¡£çš„ç»“æ„åŒ–é«˜ä¿çœŸè§£æã€‚</li>
</ul>
</li>
<li><p><strong>å¤šæ™ºèƒ½ä½“ç¼–æ’</strong>ï¼š</p>
<ul>
<li>Python ç«¯å°†å¼•å…¥ <strong>LangGraph</strong>ï¼Œå°†å½“å‰çš„å•ä½“é€»è¾‘æ‹†åˆ†ä¸º Routerã€Retrieverã€Critic ç­‰å¤šä¸ª Agentï¼Œå®ç°è‡ªæˆ‘ä¿®æ­£ä¸åæ€èƒ½åŠ›ã€‚</li>
</ul>
</li>
<li><p><strong>å…¨é“¾è·¯å¯è§‚æµ‹æ€§</strong>ï¼š</p>
<ul>
<li>æ¥å…¥ <strong>Langfuse</strong>ï¼Œå®ç°å¯¹ Prompt ä¼ è¾“ã€Token æ¶ˆè€—å’Œå“åº”å»¶è¿Ÿçš„å…¨é“¾è·¯è¿½è¸ªä¸è°ƒè¯•ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2><span id="6-jie-yu">6. ç»“è¯­</span></h2><p>Chimera-RAG çš„ v0.1.0 ç‰ˆæœ¬æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„å¼€å§‹ã€‚å®ƒè¯æ˜äº† <strong>â€œGo å·¥ç¨‹åº•åº§ + Python AI å¼•æ“â€</strong> è¿™ä¸€æ··åˆèŒƒå¼åœ¨æ„å»ºé«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–åº”ç”¨æ—¶çš„å·¨å¤§æ½œåŠ›ã€‚</p>
<p>æœªæ¥çš„ v0.2.0ï¼Œæˆ‘ä»¬å°†è‡´åŠ›äºè®©å®ƒä»ä¸€ä¸ªâ€œèªæ˜çš„å·¥å…·â€è¿›åŒ–ä¸ºä¸€ä¸ªâ€œä¸“ä¸šçš„å¹³å°â€ã€‚</p>
<p>ä»£ç å·²å¼€æºï¼Œæ¬¢è¿ Star ä¸ PRï¼</p>
<blockquote>
<p>Project Repo: [<a href="https://github.com/stack-echo/Chimera-RAG]">https://github.com/stack-echo/Chimera-RAG]</a></p>
</blockquote>
]]></content>
      <categories>
        <category>é¡¹ç›®å¤ç›˜</category>
        <category>Chimera-RAG</category>
      </categories>
  </entry>
  <entry>
    <title>[å¤ç›˜]æ··åˆæ¶æ„ï¼šä»é›¶æ„å»ºChimera-RAGï¼ˆv0.2.0ï¼‰å¼€å‘å¤ç›˜</title>
    <url>/2025/12/27/%E9%A1%B9%E7%9B%AE%E5%A4%8D%E7%9B%98/Chimera-RAG/2025-12-27-%5B%E5%A4%8D%E7%9B%98%5D%E6%B7%B7%E5%90%88%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BAChimera-RAG%EF%BC%88v0.2.0%EF%BC%89%E5%BC%80%E5%8F%91%E5%A4%8D%E7%9B%98/</url>
    <content><![CDATA[<h2><span id="qian-yan-cong-neng-pao-dao-hao-yong">å‰è¨€ï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¥½ç”¨â€</span></h2><p>åœ¨ v0.1.0 ç‰ˆæœ¬ä¸­ï¼ŒChimera-RAG å·²ç»æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„åŸå‹ï¼šæˆ‘ä»¬ä½¿ç”¨grpcåšé€šä¿¡ï¼Œéƒ¨ç½²äº† Redisã€Qdrantã€minioï¼Œæ”»å…‹äº† SSE æµå¼ä¼ è¾“çš„è·¨åŸŸé—®é¢˜ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„å‰ç«¯é¡µé¢éªŒè¯ç³»ç»Ÿã€‚ç³»ç»Ÿè·‘é€šäº†ï¼Œé€»è¾‘ä¹Ÿæ˜¯è‡ªæ´½çš„ã€‚</p>
<p>ä½†ä½œä¸ºä¸€ä¸ªè¿½æ±‚é•¿æœŸæ¼”è¿›çš„ç³»ç»Ÿï¼Œv0.1.0 ä¾ç„¶é¢ä¸´ç€â€œæˆé•¿çš„çƒ¦æ¼â€ï¼š</p>
<ul>
<li><p><strong>æ•°æ®å­¤å²›</strong>ï¼šè™½ç„¶æœ‰ Redisï¼Œä½†ç¼ºä¹å…³ç³»å‹æ•°æ®åº“ï¼Œç”¨æˆ·æ•°æ®æ— æ³•æŒä¹…åŒ–ï¼Œæ–‡ä»¶ä¸ç”¨æˆ·çš„ç»‘å®šå…³ç³»è–„å¼±ã€‚</p>
</li>
<li><p><strong>åŒæ­¥ç“¶é¢ˆ</strong>ï¼šRedis è™½ç„¶åœ¨åœºï¼Œä½†å°šæœªå‘æŒ¥å…¶ä½œä¸ºâ€œå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—â€çš„å…¨éƒ¨æ½œåŠ›ï¼Œå¤§æ–‡ä»¶å¤„ç†ä¾ç„¶å®¹æ˜“é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</li>
<li><p><strong>ä»£ç ç†µå¢</strong>ï¼šPython ç«¯çš„é€»è¾‘éšç€åŠŸèƒ½å¢åŠ å¼€å§‹å †å ï¼Œæ€¥éœ€ä¸€åœºæ¶æ„å±‚é¢çš„â€œæ–­èˆç¦»â€ã€‚</p>
</li>
</ul>
<p>åœ¨ v0.2.0 æˆ‘ä»¬å¯¹ç³»ç»Ÿè¿›è¡Œäº†å¤§é‡çš„ä¿®æ”¹ã€‚æˆ‘ä»¬ä¸æ˜¯åœ¨å †ç Œæ–°åŠŸèƒ½ï¼Œè€Œæ˜¯åœ¨<strong>æ·±åŒ–åŸºç¡€è®¾æ–½çš„åº”ç”¨ï¼Œå¹¶é‡å¡‘ä»£ç çš„éª¨æ¶ã€‚</strong></p>
<h2><span id="yi-ji-chu-she-shi-de-shen-hua-ying-yong">ä¸€ã€ åŸºç¡€è®¾æ–½çš„æ·±åŒ–åº”ç”¨</span></h2><h3><span id="1-redis-cong-huan-cun-dao-shi-jian-qu-dong">1. Redisï¼šä»â€œç¼“å­˜â€åˆ°â€œäº‹ä»¶é©±åŠ¨â€</span></h3><p>åœ¨ v0.1.0 ä¸­ï¼ŒRedis å¯èƒ½æ›´å¤šå……å½“ç¼“å­˜æˆ–ç®€å•å­˜å‚¨ã€‚åœ¨ v0.2.0 ä¸­ï¼Œæˆ‘ä»¬å°†å…¶å‡çº§ä¸º <strong>ETL æµç¨‹çš„ç¥ç»ä¸­æ¢</strong>ã€‚</p>
<ul>
<li><p><strong>å˜é©</strong>ï¼šæ„å»ºäº†æ ‡å‡†çš„ <strong>Producer-Consumerï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼‰</strong> æ¨¡å‹ã€‚</p>
</li>
<li><p><strong>æ•ˆæœ</strong>ï¼šGo åç«¯ï¼ˆç”Ÿäº§è€…ï¼‰åªè´Ÿè´£å°† <code>Upload</code> äº‹ä»¶æ¨å…¥ <code>task:parse_pdf</code> é˜Ÿåˆ—ï¼Œè€—æ—¶ä»…æ¯«ç§’çº§ï¼›åå° Workerï¼ˆæ¶ˆè´¹è€…ï¼‰å¼‚æ­¥æ‹‰å–ä»»åŠ¡ã€‚è¿™ç§è§£è€¦è®©ç³»ç»Ÿååé‡æœ‰äº†è´¨çš„é£è·ƒã€‚</p>
</li>
</ul>
<h3><span id="2-yin-ru-postgresql-bu-quan-shu-ju-pin-tu">2. å¼•å…¥ PostgreSQLï¼šè¡¥å…¨æ•°æ®æ‹¼å›¾</span></h3><p>ä¸ºäº†æ”¯æ’‘å¤šç”¨æˆ·ä½“ç³»ï¼Œæˆ‘ä»¬å¼•å…¥äº† PostgreSQLã€‚</p>
<ul>
<li><strong>ä»·å€¼</strong>ï¼šåˆ©ç”¨ GORM å®šä¹‰äº† <code>User</code>ã€<code>Document</code>ã€<code>KnowledgeBase</code> æ¨¡å‹ã€‚è¿™æ ‡å¿—ç€ç³»ç»Ÿä»â€œä¸´æ—¶ä¼šè¯â€èµ°å‘äº†â€œæŒä¹…åŒ–èµ„äº§ç®¡ç†â€ã€‚</li>
</ul>
<h2><span id="er-hou-duan-jia-gou-de-gui-fan-hua-go">äºŒã€ åç«¯æ¶æ„çš„è§„èŒƒåŒ– (Go)</span></h2><p>v0.1.0 è™½ç„¶å·²æœ‰ Middleware æ€æƒ³ï¼Œä½† v0.2.0 å°†å…¶<strong>ä½“ç³»åŒ–</strong>äº†ã€‚</p>
<h3><span id="1-jian-quan-ti-xi-de-luo-di">1. é‰´æƒä½“ç³»çš„è½åœ°</span></h3><ul>
<li><p><strong>JWT + DB</strong>ï¼šæˆ‘ä»¬å°†åŸæœ‰çš„é‰´æƒæœºåˆ¶å‡çº§ä¸ºåŸºäºæ•°æ®åº“çš„ JWT éªŒè¯ã€‚</p>
</li>
<li><p><strong>ä¸­é—´ä»¶æ ‡å‡†åŒ–</strong>ï¼šé‡å†™äº† Gin ä¸­é—´ä»¶ï¼Œä½¿å…¶ä¸ä»…è´Ÿè´£æ‹¦æˆªï¼Œè¿˜è´Ÿè´£<strong>ä¸Šä¸‹æ–‡æ³¨å…¥</strong>ï¼ˆ<code>c.Set(&quot;userID&quot;, ...)</code>ï¼‰ã€‚è¿™è®©åç»­çš„ Controller å±‚å®Œå…¨ä¸éœ€è¦å…³å¿ƒâ€œè§£æ Tokenâ€è¿™ç§è„æ´»ï¼Œä¸“æ³¨äºä¸šåŠ¡ã€‚</p>
</li>
</ul>
<h3><span id="2-clean-architecture-zheng-ji-jia-gou">2. Clean Architecture (æ•´æ´æ¶æ„)</span></h3><p>æˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œäº†åˆ†å±‚é‡æ„ï¼š</p>
<ul>
<li><p><strong>Data å±‚</strong>ï¼šæ”¶æ•›äº†æ‰€æœ‰çš„ DBã€Redisã€MinIO æ“ä½œã€‚</p>
</li>
<li><p><strong>Service å±‚</strong>ï¼šåªå…³æ³¨ä¸šåŠ¡ç¼–æ’ã€‚</p>
</li>
<li><p><strong>Handler å±‚</strong>ï¼šåªå…³æ³¨ HTTP åè®®è§£æã€‚ è¿™ç§åˆ†å±‚è®©å•å…ƒæµ‹è¯•å’Œåç»­ç»´æŠ¤å˜å¾—å¼‚å¸¸è½»æ¾ã€‚</p>
</li>
</ul>
<h2><span id="san-ai-nei-he-de-mo-kuai-hua-python">ä¸‰ã€ AI å†…æ ¸çš„æ¨¡å—åŒ– (Python)</span></h2><p>è¿™æ˜¯ v0.2.0 å˜åŠ¨æœ€å¤§çš„éƒ¨åˆ†ã€‚ä¸ºäº†è¿æ¥æœªæ¥çš„å¤šæ¨¡æ€å’Œ Agent æ¶æ„ï¼Œæˆ‘ä»¬åºŸå¼ƒäº†å•è„šæœ¬æ¨¡å¼ã€‚</p>
<ul>
<li><p><strong>Core å±‚</strong>ï¼šå°è£… LLMã€Embeddingã€Splitter ç­‰åŸå­èƒ½åŠ›ã€‚</p>
</li>
<li><p><strong>Tools å±‚</strong>ï¼šå°† PDF è§£æï¼ˆPyMuPDFï¼‰ç‹¬ç«‹ä¸ºå·¥å…·ã€‚è¿™ä¸º v0.3.0 æ›¿æ¢ä¸º Docling åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p>
</li>
<li><p><strong>Service å±‚</strong>ï¼šçº¯ç²¹çš„ gRPC èƒ¶æ°´å±‚ã€‚</p>
</li>
</ul>
<p>ç°åœ¨çš„ Python æœåŠ¡ï¼Œå·²ç»åšå¥½äº†è¢«æœªæ¥ Agent è°ƒç”¨çš„å‡†å¤‡ã€‚</p>
<h2><span id="si-qian-duan-gong-cheng-hua-vue-3">å››ã€ å‰ç«¯å·¥ç¨‹åŒ– (Vue 3)</span></h2><p>æˆ‘ä»¬å®Œå–„äº†å‰ç«¯çš„â€œæœ€åä¸€å—æ‹¼å›¾â€ï¼š</p>
<ul>
<li><p>**çŠ¶æ€ç®¡ç† (Pinia)**ï¼šæŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·çŠ¶æ€ï¼Œä¸ v0.1.0 å·²æœ‰çš„ SSE é‰´æƒæœºåˆ¶å®Œç¾å¯¹æ¥ã€‚</p>
</li>
<li><p><strong>äº¤äº’é—­ç¯</strong>ï¼šæ–°å¢ç™»å½•&#x2F;æ³¨å†Œé¡µï¼Œé…åˆ Axios æ‹¦æˆªå™¨ï¼Œå®ç°äº†ç”¨æˆ·æ— æ„ŸçŸ¥çš„ Token åˆ·æ–°ä¸æºå¸¦ã€‚</p>
</li>
</ul>
<h2><span id="wu-xia-yi-bu-v0-3-0-yu-gao">äº”ã€ ä¸‹ä¸€æ­¥ï¼šv0.3.0 é¢„å‘Š</span></h2><p>éšç€æ¶æ„åœ°åŸºçš„å¤¯å®ï¼Œv0.2.0 å·²ç»æ˜¯ä¸€ä¸ªå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æŠŠç²¾åŠ›é›†ä¸­åœ¨ <strong>RAG çš„æ ¸å¿ƒæ•ˆæœ</strong>ä¸Šã€‚</p>
<p><strong>v0.3.0 ç›®æ ‡ï¼šAI çš„è§‰é†’</strong></p>
<ul>
<li><p><strong>Docling æ¥å…¥</strong>ï¼šç”¨ AI è§†è§‰æŠ€æœ¯æ›¿ä»£ä¼ ç»Ÿçš„æ–‡æœ¬æå–ï¼Œè¯»æ‡‚è¡¨æ ¼å’Œå¸ƒå±€ã€‚</p>
</li>
<li><p><strong>è¯­ä¹‰åˆ‡åˆ†</strong>ï¼šåŸºäº Markdown æ ‡é¢˜çš„æ™ºèƒ½åˆ†å—ï¼Œä¸å†æš´åŠ›æˆªæ–­ä¸Šä¸‹æ–‡ã€‚</p>
</li>
<li><p><strong>çŸ¥è¯†å›¾è°±</strong>ï¼šæ¢ç´¢ NebulaGraphï¼Œå‘ GraphRAG è¿›å‘ã€‚</p>
</li>
</ul>
<p>ä»£ç å·²å¼€æºï¼Œæ¬¢è¿ Star ä¸ PRï¼</p>
<blockquote>
<p>Project Repo: [<a href="https://github.com/stack-echo/Chimera-RAG]">https://github.com/stack-echo/Chimera-RAG]</a></p>
</blockquote>
]]></content>
  </entry>
</search>
